{"mappings":"YA+BA,IAAIA,EACoB,oBAAfC,WACHA,WACgB,oBAATC,KACPA,KACkB,oBAAXC,OACPA,OACkB,oBAAXC,OACPA,OACA,GC1BFC,EAAW,WAWb,OAVAA,EAAWC,OAAOC,QAAU,SAAkBC,GAC5C,IAAK,IAAIC,EAAGC,EAAI,EAAGC,EAAIC,UAAUC,OAAQH,EAAIC,EAAGD,IAG9C,IAAK,IAAII,KAFTL,EAAIG,UAAUF,GAEOJ,OAAOS,UAAUC,eAAeC,KAAKR,EAAGK,KAAIN,EAAEM,GAAKL,EAAEK,IAG5E,OAAON,IAGOU,MAAMC,KAAMP;A;A;A;A;A;A;A;A;A;A;A;A;A;gFAG9B,SAASQ,EAAOX,EAAGY,GACjB,IAAIb,EAAI,GAER,IAAK,IAAIM,KAAKL,EAAOH,OAAOS,UAAUC,eAAeC,KAAKR,EAAGK,IAAMO,EAAEC,QAAQR,GAAK,IAAGN,EAAEM,GAAKL,EAAEK,IAE9F,GAAS,MAALL,GAAqD,mBAAjCH,OAAOiB,sBAA2C,CAAA,IAAIb,EAAI,EAAb,IAAgBI,EAAIR,OAAOiB,sBAAsBd,GAAIC,EAAII,EAAED,OAAQH,IAClIW,EAAEC,QAAQR,EAAEJ,IAAM,GAAKJ,OAAOS,UAAUS,qBAAqBP,KAAKR,EAAGK,EAAEJ,MAAKF,EAAEM,EAAEJ,IAAMD,EAAEK,EAAEJ,KAEhG,OAAOF,EAGT,SAASiB,EAASC,GAChB,IAAIC,EAAsB,mBAAXC,QAAyBF,EAAEE,OAAOC,UAC7CnB,EAAI,EACR,OAAIiB,EAAUA,EAAEV,KAAKS,GACd,CACLI,KAAM,WAEJ,OADIJ,GAAKhB,GAAKgB,EAAEb,SAAQa,OAAI,GACrB,CACLK,MAAOL,GAAKA,EAAEhB,KACdsB,MAAON,KAMf,SAASO,EAAOP,EAAGf,GACjB,IAAIgB,EAAsB,mBAAXC,QAAyBF,EAAEE,OAAOC,UACjD,IAAKF,EAAG,OAAOD,EACf,IACIQ,EAEAb,EAHAX,EAAIiB,EAAEV,KAAKS,GAEXS,EAAK,GAGT,IACE,WAAc,IAANxB,GAAgBA,KAAM,MAAQuB,EAAIxB,EAAEoB,QAAQE,MAAMG,EAAGC,KAAKF,EAAEH,OACpE,MAAOM,GACPhB,EAAI,CACFgB,MAAOA,GAJX,QAOE,IACMH,IAAMA,EAAEF,OAASL,EAAIjB,EAAC,SAAaiB,EAAEV,KAAKP,GADhD,QAGE,GAAIW,EAAG,MAAMA,EAAEgB,OAInB,OAAOF,EAGT,SAASG,IACP,IAAK,IAAIH,EAAK,GAAIzB,EAAI,EAAGA,EAAIE,UAAUC,OAAQH,IAAKyB,EAAKA,EAAGI,OAAON,EAAOrB,UAAUF,KAEpF,OAAOyB,EClFT,IACIK,EAAqB,GACrBC,EAAqB,eCEzB,SAASC,EAAKX,GACZ,OAAOzB,OAAOoC,KAAKX,GAGrB,SAASY,EAAaC,EAAeC,EAAcC,QAC/B,IAAdA,IACFA,EDVkB,KCapB,IAAIC,EAAmBC,EAAaJ,EAAeE,GAC/CG,EAAkBD,EAAaH,EAAcC,GAEjD,OAAII,EAASD,KACPC,EAASH,IACJE,IAAoBF,EAO3BG,EAASH,GACJA,KAAoBE,EAGtBP,EAAKK,GAAkBI,OAAM,SAAUC,GAC5C,OAAMA,KAAOH,GAINN,EAAaI,EAAiBK,GAAMH,EAAgBG,OAI/D,SAASC,EAAaC,GACpB,IACE,OAAOJ,EAASI,IAA2B,iBAAVA,EAAqB,GAAKA,EAAQA,EAAMC,KACzE,MAAOlC,GACP,MAAM,IAAImC,MAAM,yEAIpB,SAASC,EAAYC,EAASZ,GAC5B,IACE,OAAIa,EAAQD,GACHA,EAGFA,EAAQE,WAAWC,MAAMf,GAChC,MAAOzB,GACP,MAAM,IAAImC,MAAM,IAAME,EAAU,iCAQpC,SAASV,EAAac,EAAYhB,GAChC,MAJwB,iBADLiB,EAKHD,IAJoB,UAAWC,GAAS,YAAaA,GAAS,UAAWA,GAAS,WAAYA,EAKrGD,EAAW/B,MAGhB4B,EAAQG,GACHE,EAAiBF,GAGA,iBAAfA,EACFA,EAIFE,EADSP,EAAYK,EAAYhB,IAjB1C,IAAqBiB,EAqBrB,SAASC,EAAiBC,GACxB,GAAyB,IAArBA,EAAUpD,OACZ,OAAOoD,EAAU,GAMnB,IAHA,IAAIlC,EAAQ,GACRmC,EAASnC,EAEJrB,EAAI,EAAGA,EAAIuD,EAAUpD,OAAS,EAAGH,IACpCA,IAAMuD,EAAUpD,OAAS,EAC3BqD,EAAOD,EAAUvD,IAAMuD,EAAUvD,EAAI,IAErCwD,EAAOD,EAAUvD,IAAM,GACvBwD,EAASA,EAAOD,EAAUvD,KAI9B,OAAOqB,EAGT,SAASoC,EAAUC,EAAYC,GAI7B,IAHA,IAAIC,EAAS,GACTC,EAAiB7B,EAAK0B,GAEjB1D,EAAI,EAAGA,EAAI6D,EAAe1D,OAAQH,IAAK,CAC9C,IAAI0C,EAAMmB,EAAe7D,GACzB4D,EAAOlB,GAAOiB,EAASD,EAAWhB,GAAMA,EAAKgB,EAAY1D,GAG3D,OAAO4D,EAGT,SAASE,EAAgBJ,EAAYC,EAAUI,GAC7C,IAAIC,EAAKC,EAELL,EAAS,GAEb,IACE,IAAK,IAAIM,EAAKC,EAASnC,EAAK0B,IAAcU,EAAKF,EAAG9C,QAASgD,EAAG9C,KAAM8C,EAAKF,EAAG9C,OAAQ,CAClF,IAAIsB,EAAM0B,EAAG/C,MACTgD,EAAOX,EAAWhB,GAEjBqB,EAAUM,KAIfT,EAAOlB,GAAOiB,EAASU,EAAM3B,EAAKgB,KAEpC,MAAOY,GACPN,EAAM,CACJrC,MAAO2C,GAbX,QAgBE,IACMF,IAAOA,EAAG9C,OAAS2C,EAAKC,EAAGK,SAASN,EAAG1D,KAAK2D,GADlD,QAGE,GAAIF,EAAK,MAAMA,EAAIrC,OAIvB,OAAOiC,EAQT,IAAIY,EAAO,SAAUC,GACnB,OAAO,SAAUC,GACf,IAAIC,EAAKV,EAELL,EAASc,EAEb,IACE,IAAK,IAAIE,EAAUT,EAASM,GAAQI,EAAYD,EAAQxD,QAASyD,EAAUvD,KAAMuD,EAAYD,EAAQxD,OAAQ,CAE3GwC,EAASA,EADEiB,EAAUxD,QAGvB,MAAOyD,GACPH,EAAM,CACJhD,MAAOmD,GAPX,QAUE,IACMD,IAAcA,EAAUvD,OAAS2C,EAAKW,EAAQL,SAASN,EAAG1D,KAAKqE,GADrE,QAGE,GAAID,EAAK,MAAMA,EAAIhD,OAIvB,OAAOiC,IAoCX,SAASmB,EAAa3B,GACpB,OAAKA,EAIDZ,EAASY,GACJ,CAAC,CAACA,IAGE4B,EAAQhD,EAAKoB,GAAY6B,KAAI,SAAUvC,GAClD,IAAIwC,EAAgB9B,EAAWV,GAE/B,MAA6B,iBAAlBwC,GAAgCA,GAAkBtF,OAAOoC,KAAKkD,GAAe/E,OAIjF4E,EAAa3B,EAAWV,IAAMuC,KAAI,SAAUE,GACjD,MAAO,CAACzC,GAAKb,OAAOsD,MAJb,CAAC,CAACzC,QAXJ,CAAC,IAqBZ,SAASsC,EAAQI,GACf,IAAInB,EAEJ,OAAQA,EAAK,IAAIpC,OAAOrB,MAAMyD,EAAIoB,EAASD,IAG7C,SAASE,EAAcjE,GACrB,OAAI4B,EAAQ5B,GACHA,EAGF,CAACA,GAGV,SAASkE,EAAQlE,GACf,YAAcmE,IAAVnE,EACK,GAGFiE,EAAcjE,GAGvB,SAASoE,EAAWC,EAAQC,EAASC,GACnC,IAAIC,EAAK5B,EAET,GAAI6B,EAAWJ,GACb,OAAOA,EAAOC,EAASC,EAAOG,MAGhC,IAAInC,EAAS,GAEb,IACE,IAAK,IAAIM,EAAKC,EAASvE,OAAOoC,KAAK0D,IAAUtB,EAAKF,EAAG9C,QAASgD,EAAG9C,KAAM8C,EAAKF,EAAG9C,OAAQ,CACrF,IAAIsB,EAAM0B,EAAG/C,MACT2E,EAAYN,EAAOhD,GAEnBoD,EAAWE,GACbpC,EAAOlB,GAAOsD,EAAUL,EAASC,EAAOG,MAExCnC,EAAOlB,GAAOsD,GAGlB,MAAOC,GACPJ,EAAM,CACJlE,MAAOsE,GAbX,QAgBE,IACM7B,IAAOA,EAAG9C,OAAS2C,EAAKC,EAAGK,SAASN,EAAG1D,KAAK2D,GADlD,QAGE,GAAI2B,EAAK,MAAMA,EAAIlE,OAIvB,OAAOiC,EAOT,SAASsC,EAAc7E,GACrB,OAAIA,aAAiB8E,WAKP,OAAV9E,IAAmByE,EAAWzE,IAA2B,iBAAVA,IAAuByE,EAAWzE,EAAM+E,OAO7F,SAASC,EAAUC,EAAOvC,GACxB,IAAIwC,EAAKtC,EAELC,EAAKsC,EAAO,CAAC,GAAI,IAAK,GACtBC,EAASvC,EAAG,GACZwC,EAAQxC,EAAG,GAEf,IACE,IAAK,IAAIyC,EAAUxC,EAASmC,GAAQM,EAAYD,EAAQvF,QAASwF,EAAUtF,KAAMsF,EAAYD,EAAQvF,OAAQ,CAC3G,IAAIiD,EAAOuC,EAAUvF,MAEjB0C,EAAUM,GACZoC,EAAO/E,KAAK2C,GAEZqC,EAAMhF,KAAK2C,IAGf,MAAOwC,GACPN,EAAM,CACJ5E,MAAOkF,GAZX,QAeE,IACMD,IAAcA,EAAUtF,OAAS2C,EAAK0C,EAAQpC,SAASN,EAAG1D,KAAKoG,GADrE,QAGE,GAAIJ,EAAK,MAAMA,EAAI5E,OAIvB,MAAO,CAAC8E,EAAQC,GAGlB,SAASI,EAAoBC,EAAM3D,GACjC,OAAOK,EAAUsD,EAAKC,QAAQ,SAAUC,EAASvE,GAC/C,GAAKuE,EAAL,CAIA,IAAI/B,GAAiB1C,EAASY,QAAcoC,EAAYpC,EAAWV,MAAUuE,EAAUA,EAAQC,aAAU1B,GAEzG,GAAKN,EAIL,MAAO,CACLgC,QAAShC,EACT8B,OAAQF,EAAoBG,EAAS/B,QA+E3C,SAASjC,EAAQ5B,GACf,OAAO8F,MAAMlE,QAAQ5B,GAIvB,SAASyE,EAAWzE,GAClB,MAAwB,mBAAVA,EAGhB,SAASmB,EAASnB,GAChB,MAAwB,iBAAVA,EAchB,SAAS+F,EAAQC,EAAWC,GAC1B,GAAKD,EAIL,OAAI7E,EAAS6E,GACJ,CACLxE,KAAI0E,EACJC,KAAMH,EACNtD,UAAWuD,EAAWA,EAASD,QAAa7B,GAI5CM,EAAWuB,GACN,CACLxE,KAAI0E,EACJC,KAAMH,EAAUG,KAChBzD,UAAWsD,GAIRA,EAGT,SAASI,EAAapG,GACpB,IACE,MAAO,cAAeA,GAASyE,EAAWzE,EAAMqG,WAChD,MAAO/G,GACP,OAAO,GAIX,IAAIgH,EAAgC,WAClC,MAAyB,mBAAXzG,QAAyBA,OAAO0G,YAAc,eAD1B,GAIpC,SAASC,EAAUxG,GACjB,IACE,MAAO,iBAAkBA,EACzB,MAAOV,GACP,OAAO,GAIX,IChfImH,EAEOA,EAuBPC,EAEOA,ED6dX,SAASC,EAAcpF,EAAOqF,GAE5B,OAAIzF,EAASI,IAA2B,iBAAVA,EACrBsF,EAAS,CACdrF,KAAMD,GACLqF,GAGErF,EAGT,SAASuF,EAAavF,EAAOwF,GAC3B,IAAK5F,EAASI,IAAU,WAAYA,GAA0B,UAAjBA,EAAMyF,OACjD,OAAOzF,EAGT,IAAI0F,EAAcN,EAAcpF,GAChC,OAAOsF,EAAS,CACdV,KAAMc,EAAYzF,KAClBkD,KAAMuC,EACND,OAAQ,QACRxF,KAAM,YACLuF,GAGL,SAASG,EAAwB3F,EAAO4F,GAatC,OAZkBlD,EAAckD,GAAYvD,KAAI,SAAUwD,GACxD,YAA8B,IAAnBA,GAA4D,iBAAnBA,GAA+BZ,EAAUY,GACpF,CACLC,OAAQD,EACR7F,MAAOA,GAIJsF,EAASA,EAAS,GAAIO,GAAiB,CAC5C7F,MAAOA,OA6Bb,SAAS+F,EAAcC,EAASC,EAAOlD,EAASC,EAAQvC,GACtD,IAAIyF,EAASF,EAAQG,QAAQD,OACzBE,EAAY,CACd3F,MAAOA,EACP4F,KAAMJ,EACNjD,OAAQA,GAGV,GAAIiD,EAAMhG,OAAN0E,EACF,OAAOsB,EAAM9E,UAAU4B,EAASC,EAAOG,KAAMiD,GAG/C,IAAIE,EAASJ,EAAOD,EAAMhG,MAE1B,IAAKqG,EACH,MAAM,IAAIpG,MAAM,UAAY+F,EAAMhG,KAAO,oCAAsC+F,EAAQO,GAAK,MAG9F,OAAOD,EAAOvD,EAASC,EAAOG,KAAMiD,GAGtC,SAASI,EAAeC,GACtB,MAAmB,iBAARA,EACF,CACLxG,KAAMwG,GAIHA,GCllBEvB,EAqBRA,IAAgBA,EAAc,KApBpB,MAAY,eACvBA,EAAW,KAAW,cACtBA,EAAW,MAAY,eACvBA,EAAW,KAAW,cACtBA,EAAW,OAAa,gBACxBA,EAAW,UAAgB,GAC3BA,EAAW,OAAa,gBACxBA,EAAW,MAAY,eACvBA,EAAW,UAAgB,aAC3BA,EAAW,WAAiB,cAC5BA,EAAW,IAAU,aACrBA,EAAW,KAAW,cACtBA,EAAW,OAAa,gBACxBA,EAAW,eAAqB,kBAChCA,EAAW,mBAAyB,sBACpCA,EAAW,cAAoB,iBAC/BA,EAAW,YAAkB,eAC7BA,EAAW,OAAa,gBACxBA,EAAW,KAAW,cACtBA,EAAW,OAAa,iBAKfC,EAGRA,IAAmBA,EAAiB,KAFvB,OAAa,WAC3BA,EAAc,SAAe,aC3B/B,IAAIuB,EAAQC,EAAYC,MACpBC,EAAOF,EAAYG,KACnBC,EAAQJ,EAAYK,MACpBC,EAAON,EAAYO,KACnBC,EAASR,EAAYS,OACrBC,EAAYV,EAAYW,UACxBrK,EAAS0J,EAAYY,OAGrBC,GAFQb,EAAYc,MACRd,EAAYe,UAClBf,EAAYgB,KAClBC,EAAOjB,EAAYkB,KACnBC,EAASnB,EAAYoB,OAErBC,GADiBrB,EAAYsB,eACbtB,EAAYuB,eAC5BnJ,EAAQ4H,EAAYwB,YACpBC,EAASzB,EAAY0B,OACrBC,GAAS3B,EAAY4B,OACrBC,GAAO7B,EAAY8B,KCdnBC,GAAyBC,EAAa,CACxC1I,KAAI2I,IAGN,SAASC,GAAkBC,EAAYC,GACrC,OAAOA,GAAoBA,EAAkBD,SAA2BlG,EAG1E,SAASoG,GAAeC,EAAQF,GAC9B,IAAIG,EAEJ,GAAIC,EAASF,IAA6B,iBAAXA,EAAqB,CAClD,IAAIG,EAAOP,GAAkBI,EAAQF,GAGnCG,EADEG,EAAWD,GACE,CACbnJ,KAAMgJ,EACNG,KAAMA,GAECA,GAGM,CACbnJ,KAAMgJ,EACNG,UAAMxG,QAGL,GAAIyG,EAAWJ,GACpBC,EAAe,CAEbjJ,KAAMgJ,EAAOrE,MAAQqE,EAAO3I,WAC5B8I,KAAMH,OAEH,CAGL,GAAII,EAFAD,EAAOP,GAAkBI,EAAOhJ,KAAM8I,IAGxCG,EAAe5D,EAASA,EAAS,GAAI2D,GAAS,CAC5CG,KAAMA,SAEH,GAAIA,EAAM,CACf,IAAIN,EAAaM,EAAKnJ,MAAQgJ,EAAOhJ,KACrCiJ,EAAe5D,EAASA,EAASA,EAAS,GAAI8D,GAAOH,GAAS,CAC5DhJ,KAAM6I,SAGRI,EAAeD,EAWnB,OAPAjM,OAAOsM,eAAeJ,EAAc,WAAY,CAC9CzK,MAAO,WACL,OAAOyK,EAAajJ,MAEtBsJ,YAAY,EACZC,cAAc,IAETN,EAGT,IAAIO,GAAkB,SAAUR,EAAQF,GACtC,OAAKE,GAISS,EAAQT,GAAUA,EAAS,CAACA,IAC3B5G,KAAI,SAAUsH,GAC3B,OAAOX,GAAeW,EAAWZ,MAL1B,IASX,SAASa,GAAqBX,GAC5B,IAAIC,EAAeF,GAAeC,GAClC,OAAO3D,EAASA,EAAS,CACvBiB,GAAI4C,EAASF,GAAUA,EAASC,EAAa3C,IAC5C2C,GAAe,CAChBjJ,KAAMiJ,EAAajJ,OAWvB,SAAS8G,GAAM/G,GACb,OAAKmJ,EAASnJ,GAMP,CACLC,KAAI4J,EACJ7J,MAAOA,GAPAiH,GAAKjH,EAAO,CACjB8J,GAAIC,EAAeC,WA4BzB,SAAS/C,GAAKjH,EAAOmG,GACnB,MAAO,CACL2D,GAAI3D,EAAUA,EAAQ2D,QAAKlH,EAC3B3C,KAAIgK,EACJjK,MAAOqJ,EAAWrJ,GAASA,EAAQkK,EAAclK,GACjDmK,MAAOhE,EAAUA,EAAQgE,WAAQvH,EACjC2D,GAAIJ,QAA0BvD,IAAfuD,EAAQI,GAAmBJ,EAAQI,GAAK8C,EAAWrJ,GAASA,EAAM4E,KAAOwF,EAAapK,IAwJzG,IAAI/C,GAAS,SAAUoN,GACrB,MAAO,CACLpK,KAAIqK,EACJD,WAAYA,IAyBhB,SAAS3L,GAAK6H,EAAIpD,GAChB,IAAIlD,EAAO0G,EAAYe,UAAY,IAAMnB,EACrCb,EAAc,CAChBzF,KAAMA,EACNkD,KAAMA,EAGRuC,SAAuB,WACrB,OAAOzF,IAGT,OAAOyF,EAaT,SAAS6E,GAAWhE,EAAIpD,GACtB,IAAIlD,EAAO0G,EAAY6D,WAAa,IAAMjE,EACtCb,EAAc,CAChBzF,KAAMA,EACNkD,KAAMA,EAGRuC,SAAuB,WACrB,OAAOzF,IAGT,OAAOyF,EAGT,SAAS3G,GAAMwH,EAAIpD,GACjB,IAAIlD,EAAO0G,EAAYuB,cAAgB,IAAM3B,EACzCb,EAAc,CAChBzF,KAAMA,EACNkD,KAAMA,EAGRuC,SAAuB,WACrB,OAAOzF,IAGT,OAAOyF,EAmDT,SAAS+E,GAAezE,EAAS0E,EAAcC,EAAgB3H,EAAQ4H,GACrE,IAAIvJ,EAAKuC,EAAOiH,EAAUD,GAAS,SAAU3B,GAC3C,OAAOA,EAAOhJ,OAAPqK,KACL,GACAQ,EAAgBzJ,EAAG,GACnB0J,EAAe1J,EAAG,GAElB2J,EAAiBF,EAAcvN,OHvDrC,SAAuBwF,EAASC,EAAQ8H,EAAerK,GAwCrD,OAnCqBsC,EAAU+H,EAAcG,QAAO,SAAUC,EAAKC,GACjE,IAAIC,EAAK/J,EAELgJ,EAAac,EAAad,WAC1BgB,EAAO,CACT5K,MAAOA,EACPwI,OAAQkC,EACRnI,OAAQA,GAENsI,EAAgB,GAEpB,GAAIpI,EAAWmH,GACbiB,EAAgBjB,EAAWa,EAAKlI,EAAOG,KAAMkI,QAE7C,IACE,IAAK,IAAI/J,EAAKC,EAASnC,EAAKiL,IAAc7I,EAAKF,EAAG9C,QAASgD,EAAG9C,KAAM8C,EAAKF,EAAG9C,OAAQ,CAClF,IAAIsB,EAAM0B,EAAG/C,MACT8M,EAAiBlB,EAAWvK,GAChCwL,EAAcxL,GAAOoD,EAAWqI,GAAkBA,EAAeL,EAAKlI,EAAOG,KAAMkI,GAAQE,GAE7F,MAAOC,GACPJ,EAAM,CACJrM,MAAOyM,GARX,QAWE,IACMhK,IAAOA,EAAG9C,OAAS2C,EAAKC,EAAGK,SAASN,EAAG1D,KAAK2D,GADlD,QAGE,GAAI8J,EAAK,MAAMA,EAAIrM,OAKzB,OAAO/B,OAAOC,OAAO,GAAIiO,EAAKI,KAC7BvI,GAAWA,EGgB8B0I,CAAcd,EAAgB3H,EAAQ8H,EAAeJ,GAAgBC,EAwDjH,MAAO,CAvDee,EAAQX,EAAa1I,KAAI,SAAU6G,GACvD,IAAI7H,EAEJ,OAAQ6H,EAAajJ,MACnB,KAAA4J,EACE,MA5TC,CACL5J,KAAI4J,EACJ7G,OAAQ2F,EA0TgBO,EA1TIlJ,QA4T1B,KAAAiK,EACE,IAAI0B,EApSZ,SAAqB1C,EAAQ2C,EAAK5I,EAAQ6I,GACxC,IAKIC,EALAT,EAAO,CACTrI,OAAQA,GAGN+I,EAAgBpD,EAAaU,EAAWJ,EAAOjJ,OAASiJ,EAAOjJ,MAAM4L,EAAK5I,EAAOG,KAAMkI,GAAQpC,EAAOjJ,OAG1G,GAAImJ,EAASF,EAAOkB,OAAQ,CAC1B,IAAI6B,EAAcH,GAAaA,EAAU5C,EAAOkB,OAChD2B,EAAgBzC,EAAW2C,GAAeA,EAAYJ,EAAK5I,EAAOG,KAAMkI,GAAQW,OAEhFF,EAAgBzC,EAAWJ,EAAOkB,OAASlB,EAAOkB,MAAMyB,EAAK5I,EAAOG,KAAMkI,GAAQpC,EAAOkB,MAG3F,IAAI8B,EAAiB5C,EAAWJ,EAAOa,IAAMb,EAAOa,GAAG8B,EAAK5I,EAAOG,KAAMkI,GAAQpC,EAAOa,GACxF,OAAOxE,EAASA,EAAS,GAAI2D,GAAS,CACpCa,GAAImC,EACJjJ,OAAQ+I,EACR/L,MAAO+L,EAAc5I,KACrBgH,MAAO2B,IAgRcI,CAAYhD,EAAc8B,EAAgBhI,EAAQgD,EAAQG,QAAQgG,QAQnF,OAAOR,EAET,KAAAS,EACE,OAtNS,SAAUnD,EAAQ2C,EAAK5I,GACtC,OAAOsC,EAASA,EAAS,GAAI2D,GAAS,CACpCxK,MAAO0K,EAASF,EAAOoD,MAAQpD,EAAOoD,KAAOpD,EAAOoD,KAAKT,EAAK5I,EAAOG,KAAM,CACzEH,OAAQA,MAmNCsJ,CAAWpD,EAAc8B,EAAgBhI,GAElD,KAAAuJ,GAQI,KALIC,EAGI,QAHcnL,EADH6H,EACqBuD,MAAMC,MAAK,SAAUjI,GAC3D,IAAIwB,EAAQ0G,EAAQlI,EAAU4B,KAAML,EAAQG,QAAQD,QACpD,OAAQD,GAAS2G,EAAc5G,EAASC,EAAO+E,EAAgBhI,EAAQ0H,aAClD,IAAPrJ,OAAgB,EAASA,EAAGuJ,SAG1C,MAAO,GAGT,IAAIiC,EAAWpC,GAAezE,EAAS0E,EAAcM,EAAgBhI,EAAQyG,GAAgBqD,EAAQN,GAAiBxG,EAAQG,QAAQyE,UAEtI,OADAI,EAAiB6B,EAAS,GACnBA,EAAS,GAGpB,KAAAE,GAEI,IAAIP,EAEJ,KAFIA,EAAiBtD,EAAa8D,IAAIhC,EAAgBhI,EAAOG,OAG3D,MAAO,GAGL0J,EAAWpC,GAAezE,EAAS0E,EAAcM,EAAgBhI,EAAQyG,GAAgBqD,EAAQN,GAAiBxG,EAAQG,QAAQyE,UAEtI,OADAI,EAAiB6B,EAAS,GACnBA,EAAS,GAGpB,QACE,OAAO7D,GAAeE,EAAclD,EAAQG,QAAQyE,cAGjCI,GCrd3B,IAAIiC,GAAa,SAAUC,GACzB,MAA0B,WAAnBA,EAAUjN,MAAwC,UAAnBiN,EAAUjN,MAGlD,SAASkN,GAAYD,GACnB,OAAOE,EAAKF,EAAU9I,QAAQ/B,KAAI,SAAUvC,GAC1C,OAAOoN,EAAU9I,OAAOtE,MAI5B,SAASuN,GAAiBH,GACxB,IAAII,EAAa,CAACJ,GAElB,OAAID,GAAWC,GACNI,EAGFA,EAAWrO,OAAOyM,EAAQyB,GAAYD,GAAW7K,IAAIgL,MAG9D,SAASE,GAAiBC,EAAgBF,GACxC,IAAIlM,EAAKC,EAAIU,EAAKT,EAAImM,EAAKjM,EAAIkM,EAAKC,EAGhCC,EAAcC,GADM,IAAIC,IAAIN,IAE5BO,EAAgB,IAAID,IAAIR,GAE5B,IAEE,IAAK,IAAIU,EAAkBzM,EAASwM,GAAgBE,EAAoBD,EAAgBxP,QAASyP,EAAkBvP,KAAMuP,EAAoBD,EAAgBxP,OAI3J,IAHA,IACIH,GADAlB,EAAI8Q,EAAkBxP,OAChByP,OAEH7P,IAAM0P,EAAcI,IAAI9P,IAC7B0P,EAAcK,IAAI/P,GAClBA,EAAIA,EAAE6P,OAGV,MAAOxM,GACPN,EAAM,CACJrC,MAAO2C,GAbX,QAgBE,IACMuM,IAAsBA,EAAkBvP,OAAS2C,EAAK2M,EAAgBrM,SAASN,EAAG1D,KAAKqQ,GAD7F,QAGE,GAAI5M,EAAK,MAAMA,EAAIrC,OAIvB,IAAIsP,EAAUR,GAAWE,GAEzB,IAEE,IAAK,IAAIO,EAAkB/M,EAASwM,GAAgBQ,EAAoBD,EAAgB9P,QAAS+P,EAAkB7P,KAAM6P,EAAoBD,EAAgB9P,OAAQ,CAGnK,GAAe,cAFXrB,EAAIoR,EAAkB9P,OAEpBwB,MAAyBoO,EAAQrB,IAAI7P,IAAOkR,EAAQrB,IAAI7P,GAAGI,QAW/D,GAAe,aAAXJ,EAAE8C,KACJ,IACE,IAAK,IAAIuO,GAAMf,OAAM,EAAQlM,EAAS4L,GAAYhQ,KAAMsR,EAAKD,EAAGhQ,QAASiQ,EAAG/P,KAAM+P,EAAKD,EAAGhQ,OAAQ,CAChG,IAAIkQ,EAAQD,EAAGhQ,MAEI,YAAfiQ,EAAMzO,OAIL8N,EAAcI,IAAIO,KACrBX,EAAcK,IAAIM,GAEdd,EAAYZ,IAAI0B,GAClBd,EAAYZ,IAAI0B,GAAOC,SAAQ,SAAUC,GACvC,OAAOb,EAAcK,IAAIQ,MAG3BF,EAAMG,kBAAkBF,SAAQ,SAAUC,GACxC,OAAOb,EAAcK,IAAIQ,SAKjC,MAAOE,GACPrB,EAAM,CACJ1O,MAAO+P,GAxBX,QA2BE,IACML,IAAOA,EAAG/P,OAAS8C,EAAKgN,EAAG7M,SAASH,EAAG7D,KAAK6Q,GADlD,QAGE,GAAIf,EAAK,MAAMA,EAAI1O,aAzCrB6O,EAAYZ,IAAI7P,GAClByQ,EAAYZ,IAAI7P,GAAGwR,SAAQ,SAAUC,GACnC,OAAOb,EAAcK,IAAIQ,MAG3BzR,EAAE0R,kBAAkBF,SAAQ,SAAUC,GACpC,OAAOb,EAAcK,IAAIQ,OAyCjC,MAAO1M,GACPH,EAAM,CACJhD,MAAOmD,GAvDX,QA0DE,IACMqM,IAAsBA,EAAkB7P,OAAS4C,EAAKgN,EAAgB3M,SAASL,EAAG3D,KAAK2Q,GAD7F,QAGE,GAAIvM,EAAK,MAAMA,EAAIhD,OAIvB,IAEE,IAAK,IAAIgQ,EAAkBxN,EAASwM,GAAgBiB,EAAoBD,EAAgBvQ,QAASwQ,EAAkBtQ,KAAMsQ,EAAoBD,EAAgBvQ,OAC3J,CAAA,IAAIrB,EAGJ,IAFIkB,GADAlB,EAAI6R,EAAkBvQ,OAChByP,OAEH7P,IAAM0P,EAAcI,IAAI9P,IAC7B0P,EAAcK,IAAI/P,GAClBA,EAAIA,EAAE6P,QAGV,MAAOe,GACPvB,EAAM,CACJ3O,MAAOkQ,GAbX,QAgBE,IACMD,IAAsBA,EAAkBtQ,OAASiP,EAAKoB,EAAgBpN,SAASgM,EAAGhQ,KAAKoR,GAD7F,QAGE,GAAIrB,EAAK,MAAMA,EAAI3O,OAIvB,OAAOgP,EA6BT,SAASF,GAAWE,GAClB,IAAI9K,EAAK5B,EAELgN,EAAU,IAAIa,IAElB,IACE,IAAK,IAAIC,EAAkB5N,EAASwM,GAAgBqB,EAAoBD,EAAgB3Q,QAAS4Q,EAAkB1Q,KAAM0Q,EAAoBD,EAAgB3Q,OAAQ,CACnK,IAAIrB,EAAIiS,EAAkB3Q,MAErB4P,EAAQF,IAAIhR,IACfkR,EAAQgB,IAAIlS,EAAG,IAGbA,EAAE+Q,SACCG,EAAQF,IAAIhR,EAAE+Q,SACjBG,EAAQgB,IAAIlS,EAAE+Q,OAAQ,IAGxBG,EAAQrB,IAAI7P,EAAE+Q,QAAQpP,KAAK3B,KAG/B,MAAOkG,GACPJ,EAAM,CACJlE,MAAOsE,GAlBX,QAqBE,IACM+L,IAAsBA,EAAkB1Q,OAAS2C,EAAK8N,EAAgBxN,SAASN,EAAG1D,KAAKwR,GAD7F,QAGE,GAAIlM,EAAK,MAAMA,EAAIlE,OAIvB,OAAOsP,EAGT,SAASiB,GAASC,EAAUxB,GAE1B,OAhEF,SAASyB,EAAgBC,EAAUpB,GACjC,IAAIqB,EAAkBrB,EAAQrB,IAAIyC,GAElC,IAAKC,EACH,MAAO,GAGT,GAAsB,aAAlBD,EAASxP,KAAqB,CAChC,IAAI0P,EAAiBD,EAAgB,GAErC,IAAIC,EAKF,MAAO,GAJP,GAAI1C,GAAW0C,GACb,OAAOA,EAAe7P,IAO5B,IAAIU,EAAa,GAIjB,OAHAkP,EAAgBf,SAAQ,SAAUiB,GAChCpP,EAAWoP,EAAI9P,KAAO0P,EAAgBI,EAAKvB,MAEtC7N,EAyCAgP,CAAgBD,EAAU1B,GADpBN,GAAiB,CAACgC,GAAWxB,KAI5C,SAASI,GAAI0B,EAAUpO,GACrB,OAAI8C,MAAMlE,QAAQwP,GACTA,EAASC,MAAK,SAAUC,GAC7B,OAAOA,IAAWtO,KAIlBoO,aAAoB/B,KACf+B,EAAS1B,IAAI1M,GAYxB,SAASuO,GAAejC,EAAeb,GACrC,MAAuB,aAAnBA,EAAUjN,KACLkN,GAAYD,GAAW4C,MAAK,SAAU3S,GAC3C,MAAkB,UAAXA,EAAE8C,MAAoBkO,GAAIJ,EAAe5Q,MAI7B,aAAnB+P,EAAUjN,MACLkN,GAAYD,GAAWrN,OAAM,SAAU+O,GAC5C,OAAOoB,GAAejC,EAAea,MChM3C,IAAIqB,GAIJ,WAaE,SAASA,EAAMC,GACb,IAAIC,EAAQtS,KAEZA,KAAK+M,QAAU,GACf/M,KAAKuS,WAALC,EACAxS,KAAKwN,KAAO,GACZxN,KAAKyS,OAAS,GACdzS,KAAKY,MAAQyR,EAAOzR,MACpBZ,KAAKkF,QAAUmN,EAAOnN,QACtBlF,KAAKmF,OAASkN,EAAOlN,OACrBnF,KAAK0S,WAAaL,EAAOK,WACzB1S,KAAKmC,MAAQnC,KAAKmF,OAAOG,KACzBtF,KAAK2S,aAAeN,EAAOM,aAC3B3S,KAAK4S,QAAUP,EAAOO,QACtB5S,KAAK+M,QAAUsF,EAAOtF,SAAW,GACjC/M,KAAKuS,WAAaF,EAAOE,YAAPC,EAClBxS,KAAKwN,KAAO6E,EAAO7E,MAAQ,GAC3BxN,KAAKyS,OAASJ,EAAOI,QAAU,GAC/BzS,KAAK6S,QAAU7S,KAAK6S,QAAQC,KAAK9S,MACjCA,KAAK+S,UAAY/S,KAAK+S,UAAUD,KAAK9S,MACrCA,KAAKkQ,cAAgBmC,EAAOnC,cAC5BlQ,KAAKgT,YAAcX,EAAOW,YAC1BhT,KAAKiT,SAAWZ,EAAOY,SACvBjT,KAAKa,OAASwR,EAAOxR,KACrB1B,OAAOsM,eAAezL,KAAM,aAAc,CACxCmP,IAAK,WACH,ODsIYe,ECtIMoC,EAAMpC,cDuIvBrC,EAAQjJ,EAAS,IAAIqL,IAAIC,EAAc1L,KAAI,SAAUuM,GAC1D,OAAOA,EAAGmC,gBAFd,IAAoBhD,KCIlB,OA/HAkC,EAAMe,KAAO,SAAUxQ,EAAYuC,GACjC,OAAIvC,aAAsByP,EACpBzP,EAAWuC,UAAYA,EAClB,IAAIkN,EAAM,CACfxR,MAAO+B,EAAW/B,MAClBsE,QAASA,EACTC,OAAQxC,EAAWwC,OACnBuN,WAAY,KACZC,aAAchQ,EAAWgQ,aACzBC,QAASjQ,EAAWiQ,QACpB7F,QAAS,GACTwF,WAAY5P,EAAW4P,WACvB/E,KAAM,GACNiF,OAAQ,GACRvC,cAAe,GACf8C,YAAa,GACbC,SAAU,KAIPtQ,EAIF,IAAIyP,EAAM,CACfxR,MAAO+B,EACPuC,QAASA,EACTC,OAJQiO,GAKRV,WAAY,KACZC,kBAAc5N,EACd6N,aAAS7N,EACTgI,QAAS,GACTwF,gBAAYxN,EACZyI,UAAMzI,EACN0N,OAAQ,GACRvC,cAAe,GACf8C,YAAa,GACbC,SAAU,MASdb,EAAMiB,OAAS,SAAUhB,GACvB,OAAO,IAAID,EAAMC,IASnBD,EAAMkB,MAAQ,SAAU3Q,EAAYuC,GAClC,GAAIvC,aAAsByP,EAAO,CAC/B,IAAKzP,EAAWoK,QAAQrN,OACtB,OAAOiD,EAGT,IAAIwC,EAAMiO,GACV,OAAO,IAAIhB,EAAM,CACfxR,MAAO+B,EAAW/B,MAClBsE,QAASA,EACTC,OAAQA,EACRuN,WAAY,KACZC,aAAchQ,EAAWgQ,aACzBC,QAASjQ,EAAWiQ,QACpBL,WAAY5P,EAAW4P,WACvBrC,cAAevN,EAAWuN,cAC1B8C,YAAa,GACbC,SAAU,KAId,OAAOb,EAAMe,KAAKxQ,EAAYuC,IAShCkN,EAAMxS,UAAUmT,UAAY,SAAUpQ,EAAYhB,GAChD,IAAI2Q,EAAQtS,KAUZ,QARmB,IAAf2C,IACFA,EAAa3C,KAAKY,YAGF,IAAde,IACFA,EAAY,KAGV2J,EAAS3I,GACX,MAAO,CAACA,GAGV,IAAI4Q,EAAYhE,EAAK5M,GACrB,OAAO4Q,EAAUnS,OAAOrB,MAAMwT,EAAW3O,EAAS2O,EAAU/O,KAAI,SAAUvC,GACxE,OAAOqQ,EAAMS,UAAUpQ,EAAWV,GAAMN,GAAW6C,KAAI,SAAUlF,GAC/D,OAAO2C,EAAMN,EAAYrC,WAK/B8S,EAAMxS,UAAU4T,OAAS,WACvB,IAAIhQ,EAAKxD,KACWwD,EAAG0M,cACL1M,EAAGwP,YAGrB,OAFiBS,EAAOjQ,EAAI,CAAC,gBAAiB,iBAUhD4O,EAAMxS,UAAUiT,QAAU,SAAUjR,GAClC,OAAO8R,EAAa9R,EAAkB5B,KAAKY,QAGtCwR,EAjLT,GCpDA,SAASuB,GAAgBjL,GACvB,MAAO,CACLA,GAAIA,EACJU,KAAM,aAGNnC,UAAW,WACT,MAAO,CACL2M,YAAa,eAKjBJ,OAAQ,WACN,MAAO,CACL9K,GAAIA,KAaZ,SAASmL,GAAqBC,EAAkB3L,EAASjD,EAASC,GAChE,IAAI3B,EAEAuQ,EAAYC,EAAeF,EAAiBlL,KAC5CqL,EAAuG,QAArFzQ,EAAK2E,MAAAA,OAAyC,EAASA,EAAQG,QAAQ4L,gBAA6B,IAAP1Q,OAAgB,EAASA,EAAGuQ,EAAU3R,MACrJ+R,EAAeL,EAAiBxO,KAAO8O,EAAWN,EAAiBxO,KAAMJ,EAASC,QAAUJ,EAC5FsP,EAAYJ,EAKlB,SAA6BK,EAAQ5L,EAAIpD,GACvC,IAAI+O,EAAYV,GAAgBjL,GAChC2L,EAAUE,UAAW,EAEjBC,EAAUF,KACZD,EAAUzR,OAAS0C,EAAOgP,EAAOG,YAAYnP,GAAQgP,GAAQI,cAG/D,OAAOL,EAb0BM,CAAoBV,EAAgBH,EAAiBpL,GAAIyL,GAAgBR,GAAgBG,EAAiBpL,IAE3I,OADA2L,EAAU7G,KAAOsG,EACVO,EAcT,SAASO,GAAQhR,GACf,IACE,MAA4B,mBAAdA,EAAKwF,KACnB,MAAOlJ,GACP,OAAO,GCpDX,SAASyI,GAAeC,GACtB,GAAmB,iBAARA,EAAkB,CAC3B,IAAIiM,EAAY,CACdzS,KAAMwG,EAGRiM,SAAqB,WACnB,OAAOjM,IAIT,OAAOiM,EAGT,OAAOjM,EAGT,SAASkM,GAAmBC,GAC1B,OAAOtN,EAASA,EAAS,CACvBrF,KAAI4S,GACHD,GAAe,CAChBvB,OAAQ,WACOuB,EAAaE,OACZF,EAAaG,QAD3B,IAEIC,EAAY1B,EAAOsB,EAAc,CAAC,SAAU,YAEhD,OAAOtN,EAASA,EAAS,GAAI0N,GAAY,CACvC/S,KAAI4S,EACJpM,IAAKD,GAAeoM,EAAanM,UCrBzC,IAEIwM,GAAW,IACXC,GAAe,GAEfC,GAAY,SAAUC,GACxB,MALqB,MAKdA,EAAI,IAqBTC,GAIJ,WACE,SAASA,EAITnD,EAAQ/J,EAIRpD,GACE,IAAIoN,EAAQtS,KAEZA,KAAKqS,OAASA,EACdrS,KAAKkF,QAAUA,EAKflF,KAAKyV,OAAS,EACdzV,KAAK0V,cAAe,EACpB1V,KAAK2V,QAAU,CACblD,YAAQ1N,EACR6Q,cAAe,IAAIvE,IACnBwE,uBAAmB9Q,EACnB2P,kBAAc3P,EACd+Q,QAAI/Q,EACJiO,iBAAajO,EACbgR,WAAY,GACZC,wBAAoBjR,GAEtB/E,KAAKiW,MAAQ,GACbjW,KAAKsI,QAAUnJ,OAAOC,OApDjB,CACL2N,QAAS,GACT1E,OAAQ,GACR6L,SAAU,GACV3B,WAAY,GACZjE,OAAQ,IA+C6ChG,GACrDtI,KAAKqQ,OAASrQ,KAAKsI,QAAQ4N,QAC3BlW,KAAKiC,IAAMjC,KAAKqS,OAAOpQ,KAAOjC,KAAKsI,QAAQ6N,MAAQnW,KAAKqS,OAAO3J,IAAM,YACrE1I,KAAKmI,QAAUnI,KAAKqQ,OAASrQ,KAAKqQ,OAAOlI,QAAUnI,KACnDA,KAAK+D,KAAO/D,KAAKqQ,OAASrQ,KAAKqQ,OAAOtM,KAAK3C,OAAOpB,KAAKiC,KAAO,GAC9DjC,KAAK2B,UAAY3B,KAAKqS,OAAO1Q,YAAc3B,KAAKqQ,OAASrQ,KAAKqQ,OAAO1O,UT9EnD,KS+ElB3B,KAAK0I,GAAK1I,KAAKqS,OAAO3J,IAAM9D,EAAS,CAAC5E,KAAKmI,QAAQlG,KAAMjC,KAAK+D,MAAMqS,KAAKpW,KAAK2B,WAC9E3B,KAAKqW,QAAUrW,KAAKqQ,OAASrQ,KAAKqQ,OAAOgG,QAAUrW,KAAKqS,OAAOgE,QAC/DrW,KAAKoC,KAAOpC,KAAKqS,OAAOjQ,OAASpC,KAAKqS,OAAOiE,SAAW,WAAatW,KAAKqS,OAAO9L,QAAUgJ,EAAKvP,KAAKqS,OAAO9L,QAAQ7G,OAAS,WAAaM,KAAKqS,OAAOO,QAAU,UAAY,UAM5K5S,KAAKuW,QAAUvW,KAAKqS,OAAOkE,QAC3BvW,KAAKuG,OAASvG,KAAKqS,OAAO9L,OAASiQ,EAAUxW,KAAKqS,OAAO9L,QAAQ,SAAUkQ,EAAaxU,GACtF,IAAIuB,EAEA6L,EAAY,IAAImG,EAAUiB,EAAa,CACzCP,QAAS5D,EACT6D,KAAMlU,IAGR,OADA9C,OAAOC,OAAOkT,EAAM2D,MAAOxO,IAAUjE,EAAK,IAAO6L,EAAU3G,IAAM2G,EAAW7L,GAAK6L,EAAU4G,QACpF5G,KACJgG,GAEL,IAAII,EAAQ,GAEZ,SAASiB,EAAIrH,GACX,IAAI9L,EAAKC,EAET6L,EAAUoG,MAAQA,IAElB,IACE,IAAK,IAAIhS,EAAKC,EAASiT,GAAYtH,IAAa1L,EAAKF,EAAG9C,QAASgD,EAAG9C,KAAM8C,EAAKF,EAAG9C,OAAQ,CAExF+V,EADY/S,EAAG/C,QAGjB,MAAOiD,GACPN,EAAM,CACJrC,MAAO2C,GAPX,QAUE,IACMF,IAAOA,EAAG9C,OAAS2C,EAAKC,EAAGK,SAASN,EAAG1D,KAAK2D,GADlD,QAGE,GAAIF,EAAK,MAAMA,EAAIrC,QAKzBwV,CAAI1W,MAEJA,KAAK4S,SAAkC,IAAxB5S,KAAKqS,OAAOO,QAAmB,UAAY5S,KAAKqS,OAAOO,UAAW,EACjF5S,KAAK4W,aAAe5W,KAAKqS,OAAOwE,UAAY7W,KAAKqS,OAAOyD,KAAapP,MAAMlE,QAAQxC,KAAKqS,OAAOyD,IAAM9V,KAAKqS,OAAOyD,GAAG7D,MAAK,SAAUzO,GAEjI,MAtHW,KAqHCA,EAAGrB,SArHJ,KAuHMnC,KAAKqS,OAAOyD,IAC/B9V,KAAK8W,SAAW9W,KAAKqS,OAAOyE,OAE5B9W,KAAK+W,QAAU9H,EAAQjP,KAAKqS,OAAO2E,OAAShX,KAAKqS,OAAO0E,SAASvS,KAAI,SAAU4G,GAC7E,OAAO6L,GAAe7L,MAGxBpL,KAAKkX,OAASjI,EAAQjP,KAAKqS,OAAO8E,MAAQnX,KAAKqS,OAAO6E,QAAQ1S,KAAI,SAAU4G,GAC1E,OAAO6L,GAAe7L,MAExBpL,KAAKwN,KAAOxN,KAAKqS,OAAO7E,KACxBxN,KAAKoX,SAAyB,UAAdpX,KAAKoC,KAAmBpC,KAAKqS,OAAO/M,UAAOP,EAC3D/E,KAAKiK,OAASgF,EAAQjP,KAAKqS,OAAOpI,QAAQzF,KAAI,SAAUuQ,EAAcxV,GACpE,IAAIiE,EAAIC,EAER,GAAI+Q,EAAUO,GAEZ,OADAzC,EAAMnK,QAAQG,QAAQ4L,SAAWzM,IAAUjE,EAAK,IAAOuR,EAAarM,IAAMqM,EAAcvR,GAAK8O,EAAMnK,QAAQG,QAAQ4L,UAC5GmD,GAAmB,CACxBzO,IAAKmM,EAAarM,GAClBA,GAAIqM,EAAarM,KAEd,GAAI4C,EAASyJ,EAAanM,KAC/B,OAAOyO,GAAmB5P,EAASA,EAAS,GAAIsN,GAAe,CAC7DrM,GAAIqM,EAAarM,IAAMqM,EAAanM,IACpCA,IAAKmM,EAAanM,OAEf,GAAI4L,EAAUO,EAAanM,MAAQ4C,EAAWuJ,EAAanM,KAAM,CACtE,IAAImL,EAAYzB,EAAM5J,GAAK,eAAiBnJ,EAAI,IAGhD,OADA+S,EAAMnK,QAAQG,QAAQ4L,SAAWzM,IAAUhE,EAAK,IAAOsQ,GAAagB,EAAanM,IAAKnF,GAAK6O,EAAMnK,QAAQG,QAAQ4L,UAC1GmD,GAAmB5P,EAASA,EAAS,CAC1CiB,GAAIqL,GACHgB,GAAe,CAChBnM,IAAKmL,KAGP,IAAIuD,EAAevC,EAAanM,IAChC,OAAOyO,GAAmB5P,EAASA,EAAS,CAC1CiB,GAAI4O,EAAalV,MAChB2S,GAAe,CAChBnM,IAAK0O,QAIXtX,KAAKuS,WAAatD,EAAQjP,KAAKqS,OAAOE,YAAYnR,OAAOpB,KAAKiK,QAAQzF,KAAI,SAAU+S,GAClF,OAAOC,GAAqBD,MAE9BvX,KAAKyX,WAAazX,KAAKyX,WAAW3E,KAAK9S,MAq1CzC,OA90CAwV,EAAU5V,UAAU8X,MAAQ,WACtB1X,KAAK2V,QAAQ3C,aAIjB2E,GAAiB3X,MAAM8Q,SAAQ,SAAUzB,GACvC,OAAOA,EAAUyG,OAWrBN,EAAU5V,UAAUgY,WAAa,SAAUtP,EAASpD,QAClC,IAAZA,IACFA,EAAUlF,KAAKkF,SAGjB,IAAI1B,EAAKxD,KAAKsI,QACVyE,EAAUvJ,EAAGuJ,QACbwF,EAAa/O,EAAG+O,WAChBlK,EAAS7E,EAAG6E,OACZ6L,EAAW1Q,EAAG0Q,SACd5F,EAAS9K,EAAG8K,OAChB,OAAO,IAAIkH,EAAUxV,KAAKqS,OAAQ,CAChCtF,QAAStF,EAASA,EAAS,GAAIsF,GAAUzE,EAAQyE,SACjDwF,WAAY9K,EAASA,EAAS,GAAI8K,GAAajK,EAAQiK,YACvDlK,OAAQZ,EAASA,EAAS,GAAIY,GAASC,EAAQD,QAC/C6L,SAAUzM,EAASA,EAAS,GAAIyM,GAAW5L,EAAQ4L,UACnD5F,OAAQ7G,EAASA,EAAS,GAAI6G,GAAShG,EAAQgG,SAC9CpJ,IASLsQ,EAAU5V,UAAU6U,YAAc,SAAUvP,GAC1C,OAAO,IAAIsQ,EAAUxV,KAAKqS,OAAQrS,KAAKsI,QAASpD,IAGlD/F,OAAOsM,eAAe+J,EAAU5V,UAAW,aAAc,CAIvDuP,IAAK,WACH,MAAO,CACLzG,GAAI1I,KAAK0I,GACTzG,IAAKjC,KAAKiC,IACVoU,QAASrW,KAAKqW,QACdnR,QAASlF,KAAKkF,QACd9C,KAAMpC,KAAKoC,KACXmU,QAASvW,KAAKuW,QACd3D,QAAS5S,KAAK4S,QACdrM,OAAQiQ,EAAUxW,KAAKuG,QAAQ,SAAU3D,GACvC,OAAOA,EAAMiV,cAEf/B,GAAI9V,KAAK8V,GACT9C,YAAahT,KAAKgT,YAClBgE,MAAOhX,KAAK+W,QACZI,KAAMnX,KAAKkX,OACX3E,WAAYvS,KAAKuS,YAAc,GAC/B/E,KAAMxN,KAAKwN,KACXiI,MAAOzV,KAAKyV,QAAU,EACtBnQ,KAAMtF,KAAKoX,SACXnN,OAAQjK,KAAKiK,SAGjByB,YAAY,EACZC,cAAc,IAGhB6J,EAAU5V,UAAU4T,OAAS,WAC3B,OAAOxT,KAAK6X,YAGd1Y,OAAOsM,eAAe+J,EAAU5V,UAAW,KAAM,CAI/CuP,IAAK,WACH,GAAInP,KAAK2V,QAAQG,GACf,OAAO9V,KAAK2V,QAAQG,GAGtB,IAAI9C,EAAchT,KAAKgT,YACvB,OAAOhT,KAAK2V,QAAQG,GAAK9C,EAAY5F,QAAO,SAAU5I,EAAKiT,GAGzD,OAFAjT,EAAIiT,EAAWK,WAAatT,EAAIiT,EAAWK,YAAc,GACzDtT,EAAIiT,EAAWK,WAAW7W,KAAKwW,GACxBjT,IACN,KAELkH,YAAY,EACZC,cAAc,IAEhBxM,OAAOsM,eAAe+J,EAAU5V,UAAW,QAAS,CAClDuP,IAAK,WACH,OAAOnP,KAAK2V,QAAQK,qBAAuBhW,KAAK2V,QAAQK,mBAAqBhW,KAAK+X,wBAAyB/X,KAAK2V,QAAQK,qBAE1HtK,YAAY,EACZC,cAAc,IAEhBxM,OAAOsM,eAAe+J,EAAU5V,UAAW,cAAe,CAIxDuP,IAAK,WACH,OAAOnP,KAAK2V,QAAQ3C,cAAgBhT,KAAK2V,QAAQ3C,YAAchT,KAAKgY,oBAAqBhY,KAAK2V,QAAQ3C,cAExGtH,YAAY,EACZC,cAAc,IAGhB6J,EAAU5V,UAAUqY,cAAgB,SAAUC,GAC5C,GAAIlY,KAAK2V,QAAQI,WAAWmC,GAC1B,OAAOlY,KAAK2V,QAAQI,WAAWmC,GAGjC,IAAIC,EAzSS,KAySGD,EACZnC,EAAa/V,KAAKgT,YAAYoF,QAAO,SAAUX,GACjD,IAAIY,EAAgBZ,EAAWK,YAAcI,EAE7C,OAAOC,EAAYE,EAAgBA,GAAiBZ,EAAWK,YAAc1C,MAG/E,OADApV,KAAK2V,QAAQI,WAAWmC,GAAanC,EAC9BA,GAOTP,EAAU5V,UAAUmY,sBAAwB,WAC1C,IAAIzF,EAAQtS,KAERsY,EAActY,KAAKqS,OAAOkG,MAE9B,IAAKD,EACH,MAAO,GAGT,IAAIE,EAAkB,SAAUlM,EAAO/M,GACrC,IACIuY,ELrCV,SAAeW,EAAU/P,GACvB,IAAIgQ,EAAWhQ,EAAK,IAAMA,EAAK,GAC/B,OAAOI,EAAYc,MAAQ,IAAM6O,EAAW,IAAMC,EKmC9BC,CADDnN,EAAWc,GAASgG,EAAM5J,GAAK,UAAYnJ,EAAI,IAAM+M,EACpCgG,EAAM5J,IAQtC,OANA4J,EAAMyE,QAAQ9V,KAAK2X,GAAKd,EAAW,CACjCxL,MAAOA,KAGTgG,EAAM4E,OAAOjW,KLpGV,CACLmB,KAAIyW,EACJC,OKkG2BhB,IAElBA,GAsBT,OAnByBjM,EAAQyM,GAAeA,EAAY9T,KAAI,SAAUiT,EAAYlY,GACpF,IAAIuY,EAAYU,EAAgBf,EAAWnL,MAAO/M,GAClD,OAAOkI,EAASA,EAAS,GAAIgQ,GAAa,CACxCtV,MAAO2V,OAENjK,EAAQ0B,EAAK+I,GAAa9T,KAAI,SAAU8H,EAAO/M,GAClD,IAAIwZ,EAAmBT,EAAYhM,GAC/B0M,EAAqB1N,EAASyN,GAAoB,CACpD9Q,OAAQ8Q,GACNA,EACA9K,EAAiBgL,OAAO3M,GAAkBA,GAARA,EAClCwL,EAAYU,EAAgBvK,EAAe1O,GAC/C,OAAO0P,EAAQ+J,GAAoBxU,KAAI,SAAUiT,GAC/C,OAAOhQ,EAASA,EAAS,GAAIgQ,GAAa,CACxCtV,MAAO2V,EACPxL,MAAO2B,YAIazJ,KAAI,SAAU0U,GACtC,IAAI5M,EAAQ4M,EAAkB5M,MAC9B,OAAO7E,EAASA,EAAS,GAAI6K,EAAM6G,iBAAiBD,IAAqB,CACvE5M,MAAOA,QAWbkJ,EAAU5V,UAAUwZ,cAAgB,SAAUxW,GAC5C,IAAIY,EAEA8O,EAAQtS,KAEZ,IAAK4C,EACH,MAAO,GAGT,IAAID,EAAaC,aAAKyW,GAAoBzW,EAAMhC,MAAQ0Y,EAAa1W,EAAO5C,KAAK2B,WAEjF,GAAI2J,EAAS3I,GAAa,CACxB,IAAIkT,EAAoB7V,KAAKuZ,aAAa5W,GAAY4T,QACtD,YAA6BxR,IAAtB8Q,EAAkC7V,KAAKoZ,gBAAe5V,EAAK,IAAOb,GAAckT,EAAmBrS,IAAO,CAACxD,KAAKuG,OAAO5D,IAGhI,IAAI6W,EAAejK,EAAK5M,GAIxB,OAHoB6W,EAAahV,KAAI,SAAUiV,GAC7C,OAAOnH,EAAMiH,aAAaE,MAEPrY,OAAOoY,EAAapM,QAAO,SAAUsM,EAAkBD,GAC1E,IAAIE,EAAerH,EAAMiH,aAAaE,GAAaL,cAAczW,EAAW8W,IAE5E,OAAOC,EAAiBtY,OAAOuY,KAC9B,MASLnE,EAAU5V,UAAUga,QAAU,SAAUzX,GACtC,IAAI2V,EAAYvL,EAAapK,GAC7B,OAAOnC,KAAKyS,OAAOoH,SAAS/B,IAW9BtC,EAAU5V,UAAUka,aAAe,SAAUlX,GAC3C,IAAIsN,EAAgBxJ,MAAMyM,KAAK4G,GAAiB,GAAI/Z,KAAKoZ,cAAcxW,EAAMhC,SAC7E,OAAO,IAAAyY,GAAU5R,EAASA,EAAS,GAAI7E,GAAQ,CAC7ChC,MAAOZ,KAAKga,QAAQpX,EAAMhC,OAC1BsP,cAAeA,MAInBsF,EAAU5V,UAAUqa,mBAAqB,SAAUtX,EAAYC,EAAOuC,GACpE,IACIxE,EADYX,KAAKuZ,aAAa5W,GACbhC,KAAKiC,EAAOuC,GAEjC,OAAKxE,GAASA,EAAKqS,YAAYtT,OAIxBiB,EAHEX,KAAKW,KAAKiC,EAAOuC,IAM5BqQ,EAAU5V,UAAUsa,uBAAyB,SAAUvX,EAAYC,EAAOuC,GACxE,IAAIqU,EAAejK,EAAK5M,GAGpBhC,EAFYX,KAAKuZ,aAAaC,EAAa,IAE1BW,YAAYxX,EAAW6W,EAAa,IAAK5W,EAAOuC,GAErE,OAAKxE,GAASA,EAAKqS,YAAYtT,OAIxBiB,EAHEX,KAAKW,KAAKiC,EAAOuC,IAM5BqQ,EAAU5V,UAAUwa,uBAAyB,SAAUzX,EAAYC,EAAOuC,GACxE,IAAIjB,EAAKV,EAEL6W,EAAgB,GAEpB,IACE,IAAK,IAAI5W,EAAKC,EAAS6L,EAAK5M,IAAcgB,EAAKF,EAAG9C,QAASgD,EAAG9C,KAAM8C,EAAKF,EAAG9C,OAAQ,CAClF,IAAI8Y,EAAc9V,EAAG/C,MACjB6D,EAAgB9B,EAAW8W,GAE/B,GAAKhV,EAAL,CAIA,IAEI9D,EAFeX,KAAKuZ,aAAaE,GAEbU,YAAY1V,EAAe7B,EAAOuC,GAEtDxE,IACF0Z,EAAcZ,GAAe9Y,KAGjC,MAAO0D,GACPH,EAAM,CACJhD,MAAOmD,GAnBX,QAsBE,IACMV,IAAOA,EAAG9C,OAAS2C,EAAKC,EAAGK,SAASN,EAAG1D,KAAK2D,GADlD,QAGE,GAAIS,EAAK,MAAMA,EAAIhD,OAIvB,IAAIoZ,EAAmB/K,EAAK8K,GAAe7V,KAAI,SAAUvC,GACvD,OAAOoY,EAAcpY,MAEnBsY,EAAqB1M,EAAQyM,EAAiB9V,KAAI,SAAUgW,GAC9D,OAAOA,EAAGxH,gBAMZ,IAJqBsH,EAAiBrI,MAAK,SAAUuI,GACnD,OAAOA,EAAGxH,YAAYtT,OAAS,KAI/B,OAAOM,KAAKW,KAAKiC,EAAOuC,GAG1B,IAAIsV,EAAa5M,EAAQyM,EAAiB9V,KAAI,SAAUnF,GACtD,OAAOA,EAAEqb,aAEPxK,EAAgBrC,EAAQ0B,EAAK8K,GAAe7V,KAAI,SAAUvC,GAC5D,OAAOoY,EAAcpY,GAAKiO,kBAE5B,MAAO,CACL8C,YAAauH,EACbG,SAAUD,EACVE,QAAS9M,EAAQyM,EAAiB9V,KAAI,SAAUnF,GAC9C,OAAOA,EAAEsb,YAEXzK,cAAeA,EACf0K,OAAQhY,EACRmK,QAASc,EAAQ0B,EAAK8K,GAAe7V,KAAI,SAAUvC,GACjD,OAAOoY,EAAcpY,GAAK8K,cAKhCyI,EAAU5V,UAAUua,YAAc,SAAUxX,EAAYC,EAAOuC,GAE7D,OAAImG,EAAS3I,GACJ3C,KAAKia,mBAAmBtX,EAAYC,EAAOuC,GAIpB,IAA5BoK,EAAK5M,GAAYjD,OACZM,KAAKka,uBAAuBvX,EAAYC,EAAOuC,GAIjDnF,KAAKoa,uBAAuBzX,EAAYC,EAAOuC,IAGxDqQ,EAAU5V,UAAUe,KAAO,SAAUiC,EAAOuC,GAC1C,IAAIyK,EAAKpM,EAOLqX,EALAvI,EAAQtS,KAERkY,EAAY/S,EAAO4B,KACnBgG,EAAU,GACV+N,EAAiB,GAGrB,IACE,IAAK,IAAIrX,EAAKC,EAAS1D,KAAKiY,cAAcC,IAAavU,EAAKF,EAAG9C,QAASgD,EAAG9C,KAAM8C,EAAKF,EAAG9C,OAAQ,CAC/F,IAAIoa,EAAYpX,EAAG/C,MACf4H,EAAOuS,EAAUvS,KACjBwS,EAAUD,EAAUE,GACpBC,EAAkBtY,EAAMsC,QACxBiW,GAAYH,IAAU1P,EAAS0P,IAAY1F,GAAU0F,GACzDpY,EAAMiQ,QAAQyG,EAAatZ,KAAKob,iBAAiBJ,GAASjX,KAAM/D,KAAK2B,YACrE+R,EAAa4F,EAAa0B,EAAShb,KAAK2B,WAAY0Z,EAAKrb,KAAK+D,KAAKuX,MAAM,GAAI,GAAzBD,CAA6BzY,EAAMhC,SACnF2a,GAAc,EAElB,IACEA,GAAe/S,GAAQuG,EAAc/O,KAAKmI,QAASK,EAAM0S,EAAiB/V,EAAQvC,GAClF,MAAO4Y,GACP,MAAM,IAAInZ,MAAM,8BAAgCmG,EAAKzB,MAAQyB,EAAKpG,MAAQ,8BAAgC8V,EAAY,oBAAsBlY,KAAK0I,GAAK,OAAS8S,EAAIC,SAGrK,GAAIF,GAAeJ,EAAW,MACHpW,IAArBgW,EAAU9S,SACZ6S,EAAiBC,EAAU9S,QAG7B8E,EAAQ9L,KAAKlB,MAAMgN,EAASnI,EAASmW,EAAUhO,UAC/C8N,EAAqBE,EACrB,QAGJ,MAAO9J,GACPrB,EAAM,CACJ1O,MAAO+P,GA7BX,QAgCE,IACMtN,IAAOA,EAAG9C,OAAS2C,EAAKC,EAAGK,SAASN,EAAG1D,KAAK2D,GADlD,QAGE,GAAImM,EAAK,MAAMA,EAAI1O,OAIvB,GAAK2Z,EAAL,CAIA,IAAKC,EAAepb,OAClB,MAAO,CACLsT,YAAa,CAAC6H,GACdH,SAAU,GACVC,QAAS,GACTzK,cAAetN,EAAMhC,MAAQ,CAACZ,MAAQ,GACtC4a,OAAQhY,EACRmK,QAASA,GAIb,IAAI2O,EAAoB7N,EAAQiN,EAAetW,KAAI,SAAU6K,GAC3D,OAAOiD,EAAMqJ,sBAAsBtM,EAAWzM,EAAM+P,kBAElDiJ,IAAef,EAAmBgB,SAItC,MAAO,CACL7I,YAAa,CAAC6H,GACdH,SALiBkB,EAAa,GAAK/N,EAAQ6N,EAAkBlX,KAAI,SAAUhF,GAC3E,OAAO8S,EAAMwJ,eAAetc,OAK5Bmb,QAASiB,EAAa,GAAK,CAAC5b,MAC5BkQ,cAAewL,EACfd,OAAQhY,EACRmK,QAASA,KAIbyI,EAAU5V,UAAUkc,eAAiB,SAAUhK,GAC7C,GAAIA,EAAeiK,QAAQ/b,MACzB,MAAO,GAMT,IAHA,IAAIgc,EAAQ,GACRjZ,EAAS+O,EAEN/O,GAAUA,IAAW/C,MAC1Bgc,EAAM/a,KAAK8B,GACXA,EAASA,EAAOsN,OAKlB,OAFA2L,EAAM/a,KAAKjB,MAEJgc,GAQTxG,EAAU5V,UAAUmc,QAAU,SAAU1M,GACtC,GAAIrP,OAASqP,EACX,OAAO,EAKT,IAFA,IAAIgB,EAASrQ,KAAKqQ,OAEXA,GAAQ,CACb,GAAIA,IAAWhB,EACb,OAAO,EAGTgB,EAASA,EAAOA,OAGlB,OAAO,GAGTmF,EAAU5V,UAAUqc,WAAa,SAAUxE,EAAY3K,EAAgB3H,EAAQ+W,GAC7E,IAAIrM,EAAKrM,EAAI4B,EAAK3B,EAEd0Y,EAAapC,GAAiB,GAAImC,EAAYlc,KAAKoZ,cAAc8C,EAAUtb,OAAS,CAACZ,OACrFoc,EAAiB3E,EAAWvH,cAAcxQ,OAASqa,GAAiBoC,EAAY1E,EAAWvH,eAAiBiM,EAEhH,IACE,IAAK,IAAIE,EAAmB3Y,EAAS0Y,GAAiBE,EAAqBD,EAAiB1b,QAAS2b,EAAmBzb,KAAMyb,EAAqBD,EAAiB1b,OAAQ,CAGrK4b,GAAIJ,EAFLpL,EAAKuL,EAAmB1b,QAG1B6W,EAAWiD,SAASzZ,KAAK8P,IAG7B,MAAOK,GACPvB,EAAM,CACJ3O,MAAOkQ,GAVX,QAaE,IACMkL,IAAuBA,EAAmBzb,OAAS2C,EAAK6Y,EAAiBvY,SAASN,EAAG1D,KAAKuc,GADhG,QAGE,GAAIxM,EAAK,MAAMA,EAAI3O,OAIvB,IACE,IAAK,IAAIsb,EAAe9Y,EAASyY,GAAaM,EAAiBD,EAAa7b,QAAS8b,EAAe5b,KAAM4b,EAAiBD,EAAa7b,OAAQ,CAC9I,IAAIoQ,EAECwL,GAAIH,EAFLrL,EAAK0L,EAAe7b,SAEQ2b,GAAI9E,EAAWkD,QAAS5J,EAAGV,SACzDoH,EAAWkD,QAAQ1Z,KAAK8P,IAG5B,MAAOvL,GACPJ,EAAM,CACJlE,MAAOsE,GAVX,QAaE,IACMiX,IAAmBA,EAAe5b,OAAS4C,EAAK+Y,EAAa1Y,SAASL,EAAG3D,KAAK0c,GADpF,QAGE,GAAIpX,EAAK,MAAMA,EAAIlE,OAIlBuW,EAAWmD,SACdnD,EAAWkD,QAAU,GAErBlD,EAAWiD,SAASzZ,KAAKjB,OAG3B,IAAI0c,EAAa7O,EAAQ4J,EAAWiD,SAASlW,KAAI,SAAUuM,GACzD,IAAI0B,EAAS,GAEb,GAAgB,UAAZ1B,EAAG3O,KACL,OAAOqQ,EAGT,IAAIpC,EAASU,EAAGV,OAEhB,IAAKA,EAAOA,OACV,OAAOoC,EAGTA,EAAOxR,KAAK0b,GAAK5L,EAAGrI,GAAIqI,EAAGqG,UAC3BuF,GAAKtM,EAAO3H,GAAIqI,EAAGqG,SAAWhD,EAAWrD,EAAGqG,SAAUtK,EAAgB3H,QAAUJ,IAChF,IAAI6X,EAAcvM,EAAOA,OAUzB,MARyB,aAArBuM,EAAYxa,MACVuU,GAAYiG,GAAa5a,OAAM,SAAU6a,GAC3C,OAAOC,GAAerF,EAAWvH,cAAe2M,OAEhDpK,EAAOxR,KAAK0b,GAAKC,EAAYlU,KAI1B+J,MAETgF,EAAWkD,QAAQoC,MAAK,SAAUC,EAAGC,GACnC,OAAOA,EAAExH,MAAQuH,EAAEvH,SAErBgC,EAAWiD,SAASqC,MAAK,SAAUC,EAAGC,GACpC,OAAOD,EAAEvH,MAAQwH,EAAExH,SAErB,IAAIyH,EAAc,IAAIjN,IAAIwH,EAAWiD,UACjCyC,EAAa,IAAIlN,IAAIwH,EAAWkD,SAEhChX,EAAKoC,EAAO,CAAC8H,EAAQnH,MAAMyM,KAAK+J,GAAa1Y,KAAI,SAAU6K,GAC7D,OAAOzK,EAASyK,EAAUkD,WAAW/N,KAAI,SAAU+S,GACjD,OLnfR,SAAeA,GACb,IAAI6F,EAAcrR,GAAqBwL,GACvC,MAAO,CACLnV,KAAM0G,EAAYC,MAClBwO,SAAU6F,EACV7R,UAAMxG,GK8eKsY,CAAM9F,MACXlI,EAAU0H,aACZ3V,OAAOsb,EAAWlY,IAAX8Y,KAAwBzP,EAAQnH,MAAMyM,KAAKgK,GAAY3Y,KAAI,SAAU6K,GAC9E,OAAOzK,EAASyK,EAAU6H,OAAQ7H,EAAUkD,WAAW/N,KAAI,SAAU+S,GACnE,OLxeR,SAAcA,GACZ,IAAI6F,EAAcrR,GAAqBwL,GACvC,MAAO,CACLnV,KAAM0G,EAAYG,KAClBsO,SAAU6F,EACV7R,UAAMxG,GKmeKwY,CAAKhG,YAEV,GACFiG,EAAe7Z,EAAG,GAClB8Z,EAAc9Z,EAAG,GAGrB,OADc+Z,GAAgBD,EAAYrc,OAAOqW,EAAW1K,SAAS3L,OAAOoc,GAAexd,KAAKmI,QAAQG,QAAQyE,UAYlHyI,EAAU5V,UAAU6X,WAAa,SAAU7U,EAAOT,EAAO+C,QACzC,IAAVtC,IACFA,EAAQ5C,KAAK0U,cAGf,IAEI7H,ER7egBiL,EQ2ehB3S,EAAS2F,EAAa3I,GAI1B,GAAIS,aAAKyW,GACPxM,OAA2B9H,IAAZG,EAAwBtC,EAAQ5C,KAAK8Z,aAAaT,GAAMlG,KAAKvQ,EAAOsC,QAC9E,CACL,IAAIyY,EAAqBrS,EAAS1I,GAAS5C,KAAKga,QAAQ4D,EAAiB5d,KAAK6d,gBAAgBjb,KAAW5C,KAAKga,QAAQpX,GAClHsY,EAAkBhW,GAAoBlF,KAAKmI,QAAQjD,QACvD2H,EAAe7M,KAAK8Z,aAAaT,GAAMlG,KAAKwK,EAAoBzC,IAOlE,GAAIlb,KAAK8W,SACF9W,KAAKyS,OAAOoH,SAAS1U,EAAO4B,QR5ff+Q,EQ4fwC3S,EAAO4B,MR3f9D,kBAAkB+W,KAAKhG,IQ4fxB,MAAM,IAAIzV,MAAM,YAAcrC,KAAK0I,GAAK,4BAA8BvD,EAAO4B,KAAO,KAIxF,IAAIgX,EAAkB/d,KAAKma,YAAYtN,EAAajM,MAAOiM,EAAc1H,IAAW,CAClF6N,YAAa,GACb9C,cAAe,GACfwK,SAAU,GACVC,QAAS,GACTC,OAAQ/N,EACRE,QAAS,IAEPoP,EAAapC,GAAiB,GAAI/Z,KAAKoZ,cAAcvM,EAAajM,QAClEwb,EAAiB2B,EAAgB7N,cAAcxQ,OAASqa,GAAiBoC,EAAY4B,EAAgB7N,eAAiBiM,EAE1H,OADA4B,EAAgB7N,cAAgBtL,EAASwX,GAClCpc,KAAKge,kBAAkBD,EAAiBlR,EAAc1H,IAG/DqQ,EAAU5V,UAAUqe,wBAA0B,SAAUrb,EAAOuC,EAAQ+Y,GACrE,IAAI1a,EAEA2a,EAAiBvb,EAAMmK,QAS3B,OARAnK,EAAQ5C,KAAKyX,WAAW7U,EAAOuC,IAGzBA,OAAS+Y,EACftb,EAAMT,MAAQ+b,EAAc5Y,MAE3B9B,EAAKZ,EAAMmK,SAASqR,QAAQre,MAAMyD,EAAIoB,EAASuZ,IAEzCvb,GAGT4S,EAAU5V,UAAUoe,kBAAoB,SAAUD,EAAiBlR,EAAc1H,EAAQD,GACvF,IAAIY,EAAKtC,EAEL8O,EAAQtS,UAEG,IAAXmF,IACFA,EAAMiO,SAGQ,IAAZlO,IACFA,EAAUlF,KAAKmI,QAAQjD,SAGzB,IAAIgL,EAAgB6N,EAAgB7N,cAKhCyN,GADkB9Q,GAAgBkR,EAAgB/K,YAAYtT,OAAS,EACjC2e,GAASre,KAAKmI,QAAS+H,QAAiBnL,EAC9E4N,EAAe9F,EAAeA,EAAa8F,aAAe9F,EAAa8F,aAAeoL,EAAgBnD,OAAS5a,KAAKmI,QAAQwK,aAAa9F,EAAajM,YAASmE,OAAYA,EAC3K+H,EAAiBD,EAAeA,EAAa3H,QAAUA,EACvD6H,EAAU/M,KAAKic,WAAW8B,EAAiBjR,EAAgB3H,EAAQ0H,GACnE0F,EAAa1F,EAAepF,EAAS,GAAIoF,EAAa0F,YAAc,GAExE,IACE,IAAK,IAAI+L,EAAY5a,EAASqJ,GAAUwR,EAAcD,EAAU3d,QAAS4d,EAAY1d,KAAM0d,EAAcD,EAAU3d,OAAQ,CACzH,IAAIyK,EAASmT,EAAY3d,MAErBwK,EAAOhJ,OAAPoc,EACFjM,EAAWnH,EAAOmM,SAAS7O,IAAM0C,EAAOmM,SAASnV,MAAQgJ,EAChDA,EAAOhJ,OAAPqc,IACTlM,EAAWnH,EAAOmM,SAAS7O,IAAM0C,EAAOmM,SAASnV,OAAQ,IAG7D,MAAOgE,GACPN,EAAM,CACJ5E,MAAOkF,GAZX,QAeE,IACMmY,IAAgBA,EAAY1d,OAAS2C,EAAK8a,EAAUxa,SAASN,EAAG1D,KAAKwe,GAD3E,QAGE,GAAIxY,EAAK,MAAMA,EAAI5E,OAIvB,IRxgBwBoF,EAAM3D,EQwgB1Bc,EAAKsC,EAAO2Y,GAAe1e,KAAM6M,EAAcC,EAAgB3H,EAAQ4H,GAAU,GACjF4R,EAAkBlb,EAAG,GACrB0J,EAAiB1J,EAAG,GAEpBE,EAAKoC,EAAOiH,EAAU2R,GAAiB,SAAUvT,GACnD,OAAOA,EAAOhJ,OAAP4J,GAA2BZ,EAAOhJ,OAAPgK,GAA0BhB,EAAOa,KAAOC,EAAeC,YACvF,GACAyS,EAAejb,EAAG,GAClBkb,EAAmBlb,EAAG,GAKtBsP,EAHgB0L,EAAgBvG,QAAO,SAAUhN,GACnD,OAAOA,EAAOhJ,OAAPoc,GAA2BpT,EAAOmM,SAASnV,OAAhB4S,KAEP5H,QAAO,SAAUC,EAAKjC,GAEjD,OADAiC,EAAIjC,EAAOmM,SAAS7O,IAAMoW,GAAqB1T,EAAOmM,SAAUjF,EAAMnK,QAASgF,EAAgBhI,GACxFkI,IACNR,EAAepF,EAAS,GAAIoF,EAAaoG,UAAY,IACpD8L,EAAwBpB,EAAqBI,EAAgB7N,cAAgBrD,EAAeA,EAAaqD,cAAgB,GACzH1C,EAAOuR,EAAsB3R,QAAO,SAAUC,EAAKgC,GAKrD,YAJuBtK,IAAnBsK,EAAU7B,OACZH,EAAIgC,EAAU3G,IAAM2G,EAAU7B,MAGzBH,IACN,IACC2R,EAASlC,GAAeiC,EAAuB/e,MAC/Cif,EAAY,IAAA5F,GAAU,CACxBzY,MAAO+c,GAAsB9Q,EAAajM,MAC1CsE,QAASiI,EACThI,OAAQA,EAERuN,WAAY7F,EAAeA,EAAa6F,WAAa,KACrDC,aAAcgL,EAAqBhL,GRxiBbrM,EQwiB+CqM,ERxiBzChQ,EQwiBuDgb,ERviBhF,CACLlX,QAAS9D,EACT4D,OAAQF,EAAoBC,EAAM3D,UQqiByEoC,EAAY8H,EAAeA,EAAa8F,kBAAe5N,EAChK6N,SAAU+K,GAAsBI,EAAgBnD,OAAS/N,OAAe9H,EACxEgI,QAAS4Q,EAAqBkB,EAAmB,GACjDtM,WAAYoL,EAAqBpL,EAAa1F,EAAeA,EAAa0F,WAAa,GACvF/E,KAAMmQ,EAAqBnQ,EAAOX,EAAeA,EAAaW,UAAOzI,EACrE0N,OAAQ,GACRvC,cAAe6O,EACf/L,YAAa+K,EAAgB/K,YAC7BC,SAAUA,EACVpS,KAAMme,IAEJE,EAAmBpS,IAAmBK,EAC1C8R,EAAUE,QAAUha,EAAO4B,OAAPqY,GAA0BF,EAE9C,IAAItM,EAAUqM,EAAUrM,QAMxB,GAJIA,UACKA,EAAQA,SAGZ+K,EACH,OAAOsB,EAGT,IAAII,EAAiBJ,EAErB,IAAKD,EAWH,KAVkBhf,KAAK4W,YAAc1G,EAAc+B,MAAK,SAAU5C,GAChE,OAAOA,EAAUuH,iBAIjByI,EAAiBrf,KAAKie,wBAAwBoB,EAAgB,CAC5Djd,KAAIkd,GACHna,IAGEyZ,EAAalf,QAAQ,CAC1B,IAAI6f,EAAcX,EAAaY,QAC/BH,EAAiBrf,KAAKie,wBAAwBoB,EAAgBE,EAAYpa,OAAQA,GAKtF,IAAIga,EAAUE,EAAeF,UAAYvM,IAAYyM,EAAetS,QAAQrN,QAAUwf,UAA2BtM,EAAQhS,cAAiBye,EAAeze,QHh7B7J,SAAS6e,EAAiBzC,EAAGC,GAC3B,GAAID,IAAMC,EACR,OAAO,EAGT,QAAUlY,IAANiY,QAAyBjY,IAANkY,EACrB,OAAO,EAGT,GAAI3R,EAAS0R,IAAM1R,EAAS2R,GAC1B,OAAOD,IAAMC,EAGf,IAAIyC,EAAQnQ,EAAKyN,GACb2C,EAAQpQ,EAAK0N,GACjB,OAAOyC,EAAMhgB,SAAWigB,EAAMjgB,QAAUggB,EAAM1d,OAAM,SAAUC,GAC5D,OAAOwd,EAAiBzC,EAAE/a,GAAMgb,EAAEhb,OGg6BiI2d,CAAiBP,EAAeze,MAAOgS,EAAQhS,YAASmE,GAK3N,OAJAsa,EAAeF,QAAUA,EAEzBE,EAAe1M,aAAesM,EAAUtM,aACxC0M,EAAezM,QAAUA,EAClByM,GAOT7J,EAAU5V,UAAU2Z,aAAe,SAAUsG,GAC3C,GAAIvK,GAAUuK,GACZ,OAAO7f,KAAKmI,QAAQiT,iBAAiByE,GAGvC,IAAK7f,KAAKuG,OACR,MAAM,IAAIlE,MAAM,mCAAqCwd,EAAW,WAAa7f,KAAK0I,GAAK,6BAGzF,IAAIvF,EAASnD,KAAKuG,OAAOsZ,GAEzB,IAAK1c,EACH,MAAM,IAAId,MAAM,gBAAkBwd,EAAW,wBAA0B7f,KAAK0I,GAAK,KAGnF,OAAOvF,GASTqS,EAAU5V,UAAUwb,iBAAmB,SAAU7Y,GAC/C,IAAIud,EAAkBxK,GAAU/S,GAAWA,EAAQ+Y,MA/8BhC,IA+8BuD5b,QAAU6C,EAEpF,GAAIud,IAAoB9f,KAAK0I,GAC3B,OAAO1I,KAGT,IAAIqP,EAAYrP,KAAKmI,QAAQ8N,MAAM6J,GAEnC,IAAKzQ,EACH,MAAM,IAAIhN,MAAM,sBAAwByd,EAAkB,gCAAkC9f,KAAK0I,GAAK,KAGxG,OAAO2G,GASTmG,EAAU5V,UAAUmgB,mBAAqB,SAAUjd,GACjD,GAAyB,iBAAdA,GAA0BwS,GAAUxS,GAC7C,IACE,OAAO9C,KAAKob,iBAAiBtY,EAAUwY,MAAM,IAC7C,MAAOpb,IAQX,IAHA,IAAI8f,EAAiBC,EAAYnd,EAAW9C,KAAK2B,WAAW2Z,QACxD4E,EAAmBlgB,KAEhBggB,EAAetgB,QAAQ,CAC5B,IAAIuC,EAAM+d,EAAeR,QAEzB,IAAKvd,EAAIvC,OACP,MAGFwgB,EAAmBA,EAAiB3G,aAAatX,GAGnD,OAAOie,GAST1K,EAAU5V,UAAUoa,QAAU,SAAUrX,GACtC,IAAIa,EAEA8O,EAAQtS,KAEZ,IAAK2C,EACH,OAAO3C,KAAK6V,mBAAqBR,GAGnC,OAAQrV,KAAKoC,MACX,IAAK,WACH,OAAOoU,EAAUxW,KAAK6V,mBAAmB,SAAUpR,EAAegV,GAChE,OAAOhV,EAAgB6N,EAAMiH,aAAaE,GAAaO,QAAQrX,EAAW8W,IAAgBhV,GAAiB4Q,MAG/G,IAAK,WACH,GAAI/J,EAAS3I,GAAa,CACxB,IAAIgX,EAAe3Z,KAAKuZ,aAAa5W,GAErC,MAA0B,aAAtBgX,EAAavX,MAA6C,aAAtBuX,EAAavX,OAC5CoB,EAAK,IAAOb,GAAcgX,EAAa9D,kBAAmBrS,GAG5Db,EAGT,OAAK4M,EAAK5M,GAAYjD,OAIf8W,EAAU7T,GAAY,SAAU8B,EAAegV,GACpD,OAAOhV,EAAgB6N,EAAMiH,aAAaE,GAAaO,QAAQvV,GAAiB4Q,MAJzErV,KAAK6V,mBAAqB,GAOrC,QACE,OAAOlT,GAAc0S,KAI3BG,EAAU5V,UAAUie,gBAAkB,SAAUsC,GAC9C,GAAI7K,GAAU6K,GAAkB,CAC9B,IAAI9Q,EAAYrP,KAAKmI,QAAQ8N,MAAMkK,EAAgB7E,MA5iClC,IA4iCyD5b,SAE1E,IAAK2P,EACH,MAAM,IAAIhN,MAAM,8BAAgC8d,EAAkB,KAGpE,OAAO9Q,EAAUtL,KAGnB,OAAOkc,EAAYE,EAAiBngB,KAAK2B,YAG3CxC,OAAOsM,eAAe+J,EAAU5V,UAAW,oBAAqB,CAC9DuP,IAAK,WACH,IAAI3L,EAMAqS,EAJJ,GAAI7V,KAAK2V,QAAQE,kBACf,OAAO7V,KAAK2V,QAAQE,kBAKtB,GAAkB,aAAd7V,KAAKoC,KACPyT,EAAoBuK,EAAgBpgB,KAAKuG,QAAQ,SAAU3D,GACzD,OAAOA,EAAMiT,mBAAqBR,MACjC,SAAUhG,GACX,QAA4B,YAAnBA,EAAUjN,cAEhB,QAAqB2C,IAAjB/E,KAAKuW,QAAuB,CACrC,IAAKvW,KAAKuG,OAAOvG,KAAKuW,SACpB,MAAM,IAAIlU,MAAM,kBAAoBrC,KAAKuW,QAAU,mBAAqBvW,KAAKiC,IAAM,KAGrF4T,EAAoBwK,GAAWrgB,KAAKuG,OAAOvG,KAAKuW,UAAYvW,KAAKuW,UAAW/S,EAAK,IAAOxD,KAAKuW,SAAWvW,KAAKuG,OAAOvG,KAAKuW,SAASV,kBAAmBrS,GAIvJ,OADAxD,KAAK2V,QAAQE,kBAAoBA,EAC1B7V,KAAK2V,QAAQE,mBAEtBnK,YAAY,EACZC,cAAc,IAGhB6J,EAAU5V,UAAU0gB,gBAAkB,SAAU3d,EAAYuC,GAC1D,IAAIgL,EAAgBlQ,KAAKoZ,cAAczW,GACvC,OAAO3C,KAAKge,kBAAkB,CAC5B9N,cAAeA,EACfwK,SAAUxK,EACVyK,QAAS,GACT3H,YAAa,GACb4H,YAAQ7V,EACRgI,QAAS,SACRhI,OAAWA,EAAWG,IAG3B/F,OAAOsM,eAAe+J,EAAU5V,UAAW,eAAgB,CAKzDuP,IAAK,WACHnP,KAAK0X,QAGL,IAAI7B,EAAoB7V,KAAK6V,kBAE7B,IAAKA,EACH,MAAM,IAAIxT,MAAM,oDAAsDrC,KAAK0I,GAAK,MAGlF,OAAO1I,KAAKsgB,gBAAgBzK,IAE9BnK,YAAY,EACZC,cAAc,IAEhBxM,OAAOsM,eAAe+J,EAAU5V,UAAW,SAAU,CAKnDuP,IAAK,WACH,IAAIlH,EAEJ,GAAkB,YAAdjI,KAAKoC,KAAoB,CAC3B,IAAIme,EAAgBvgB,KAAKqS,OAGvBpK,EADEqD,EAASiV,EAActY,SAChBqN,GAAUiL,EAActY,QAAU2V,EAAiB5d,KAAKmI,QAAQiT,iBAAiBmF,EAActY,QAAQlE,KAAKuX,MAAMtb,KAAK+D,KAAKrE,OAAS,IAErI6gB,EAActY,OAI3B,OAAOA,GAETyD,YAAY,EACZC,cAAc,IAUhB6J,EAAU5V,UAAU+b,sBAAwB,SAAU6E,EAAiB7N,EAAcqH,GAKnF,YAJgB,IAAZA,IACFA,GAAU,GAGLA,EAAmC,YAAzBwG,EAAgBpe,KAAqBoe,EAAgBC,eAAe9N,GAAgB6N,EAAgBxP,kBAAoB,CAACwP,IAG5IrhB,OAAOsM,eAAe+J,EAAU5V,UAAW,oBAAqB,CAC9DuP,IAAK,WACH,IAAImD,EAAQtS,KAEZ,OAAIqgB,GAAWrgB,MACN,CAACA,MAIQ,aAAdA,KAAKoC,MAAwBpC,KAAKuW,QAS/B1I,EADqB6S,EAAa1gB,KAAK6V,mBACTrR,KAAI,SAAUmc,GACjD,OAAOrO,EAAMsO,oBAAoBD,OAL1B,CAAC3gB,OAQZ0L,YAAY,EACZC,cAAc,IAShB6J,EAAU5V,UAAUghB,oBAAsB,SAAUC,GAClD,IAAKA,EAAanhB,OAChB,MAAO,CAACM,MAGV,IAAIwD,EAAKuC,EAAO8a,GACZhB,EAAWrc,EAAG,GACdsd,EAAiBtd,EAAG8X,MAAM,GAE9B,IAAKtb,KAAKuG,OACR,MAAM,IAAIlE,MAAM,4BAA8Bwd,EAAW,8BAG3D,IAAI/N,EAAiB9R,KAAKuZ,aAAasG,GAEvC,GAA4B,YAAxB/N,EAAe1P,KACjB,OAAO0P,EAAe2O,iBAGxB,IAAKzgB,KAAKuG,OAAOsZ,GACf,MAAM,IAAIxd,MAAM,gBAAkBwd,EAAW,wBAA0B7f,KAAK0I,GAAK,KAGnF,OAAO1I,KAAKuG,OAAOsZ,GAAUe,oBAAoBE,IAGnDtL,EAAU5V,UAAU+S,aAAe,SAAUoO,GAC3C,GAAKxR,EAAKvP,KAAKuG,QAAQ7G,OAIvB,MAAO,CACL+G,QAASsa,GAAsB/gB,KAAK6V,kBACpCtP,OAAQ6Z,EAAgBpgB,KAAKuG,QAAQ,SAAU8I,EAAWpN,GACxD,IAAK8e,EACH,OAAO1R,EAAUsD,eAGnB,IAAIlO,EAAgB6G,EAASyV,QAAsBhc,EAAYgc,EAAmB9e,GAClF,OAAOoN,EAAUsD,aAAalO,GAAiB4K,EAAUwG,sBACxD,SAAUxG,GACX,OAAQA,EAAUuD,aAYxB4C,EAAU5V,UAAU6gB,eAAiB,SAAU9N,GAC7C,IAAIL,EAAQtS,KAEZ,GAAkB,YAAdA,KAAKoC,KACP,MAAO,CAACpC,MAGV,IAAIqQ,EAASrQ,KAAKqQ,OAElB,IAAKsC,EAAc,CACjB,IAAIqO,EAAgBhhB,KAAKiI,OACzB,OAAO+Y,EAAgBnT,EAAQ6S,EAAaM,GAAexc,KAAI,SAAUyc,GACvE,OAAO5Q,EAAOuQ,oBAAoBK,OAC9B5Q,EAAOW,kBAGf,IR5lCgBhN,EAAOkd,EQ4lCnBC,GR5lCYnd,EQ4lCiBqM,EAAOtM,KR5lCjBmd,EQ4lCuB,SR3lCzC,SAAUjd,GACf,IAAI2L,EAAKpM,EAELL,EAASc,EAEb,IACE,IAAK,IAAImd,EAAU1d,EAASM,GAAQqd,EAAYD,EAAQzgB,QAAS0gB,EAAUxgB,KAAMwgB,EAAYD,EAAQzgB,OAAQ,CAC3G,IAAI2gB,EAAOD,EAAUzgB,MACrBuC,EAASA,EAAO+d,GAAcI,IAEhC,MAAOrQ,GACPrB,EAAM,CACJ1O,MAAO+P,GAPX,QAUE,IACMoQ,IAAcA,EAAUxgB,OAAS2C,EAAK4d,EAAQtd,SAASN,EAAG1D,KAAKshB,GADrE,QAGE,GAAIxR,EAAK,MAAMA,EAAI1O,OAIvB,OAAOiC,IQqkCiDwP,GAAclM,QAEtE,OAAI6E,EAAS6V,GACJ,CAAC9Q,EAAOkJ,aAAa4H,IAGvBtT,EAAQ6S,EAAaS,GAAiB3c,KAAI,SAAU+c,GACzD,MAAyB,SAAlBjP,EAAMM,QAAqBvC,EAAOuQ,oBAAoBW,GAAgB,CAAClR,EAAO9J,OAAOgb,EAAa,UAI7GpiB,OAAOsM,eAAe+J,EAAU5V,UAAW,WAAY,CAIrDuP,IAAK,WACH,IAAImD,EAAQtS,KAERwhB,EAAgB3T,EAAQ0B,EAAKvP,KAAKuG,QAAQ/B,KAAI,SAAUqb,GAC1D,OAAOvN,EAAM/L,OAAOsZ,GAAU4B,aAEhC,MAAO,CAACzhB,KAAK0I,IAAItH,OAAOogB,IAE1B9V,YAAY,EACZC,cAAc,IAEhBxM,OAAOsM,eAAe+J,EAAU5V,UAAW,SAAU,CAInDuP,IAAK,WACH,IAAI5B,EAAK/J,EAAIke,EAAKje,EAElB,GAAIzD,KAAK2V,QAAQlD,OACf,OAAOzS,KAAK2V,QAAQlD,OAGtB,IAAIlM,EAASvG,KAAKuG,OACdkM,EAAS,IAAIxC,IAAIjQ,KAAKkT,WAE1B,GAAI3M,EACF,IACE,IAAK,IAAI5C,EAAKD,EAAS6L,EAAKhJ,IAAUuJ,EAAKnM,EAAGhD,QAASmP,EAAGjP,KAAMiP,EAAKnM,EAAGhD,OAAQ,CAC9E,IACIiC,EAAQ2D,EADEuJ,EAAGlP,OAGjB,GAAIgC,EAAM2D,OACR,IACE,IAAK,IAAIoK,GAAM+Q,OAAM,EAAQhe,EAASd,EAAM6P,SAAU7B,EAAKD,EAAGhQ,QAASiQ,EAAG/P,KAAM+P,EAAKD,EAAGhQ,OAAQ,CAC9F,IAAIghB,EAAU/Q,EAAGhQ,MACjB6R,EAAOlC,IAAI,GAAKoR,IAElB,MAAOC,GACPF,EAAM,CACJxgB,MAAO0gB,GAPX,QAUE,IACMhR,IAAOA,EAAG/P,OAAS4C,EAAKkN,EAAG7M,SAASL,EAAG3D,KAAK6Q,GADlD,QAGE,GAAI+Q,EAAK,MAAMA,EAAIxgB,SAK3B,MAAOyM,GACPJ,EAAM,CACJrM,MAAOyM,GA1BX,QA6BE,IACMmC,IAAOA,EAAGjP,OAAS2C,EAAKG,EAAGG,SAASN,EAAG1D,KAAK6D,GADlD,QAGE,GAAI4J,EAAK,MAAMA,EAAIrM,OAKzB,OAAOlB,KAAK2V,QAAQlD,OAAS/L,MAAMyM,KAAKV,IAE1C/G,YAAY,EACZC,cAAc,IAEhBxM,OAAOsM,eAAe+J,EAAU5V,UAAW,YAAa,CAMtDuP,IAAK,WACH,IAAIsD,EAAS,IAAIxC,IAAIjQ,KAAKgT,YAAYoF,QAAO,SAAUX,GACrD,SAAUA,EAAWxP,SAAWwP,EAAW1K,QAAQrN,QAAU+X,EAAWoE,aACvErX,KAAI,SAAUiT,GACf,OAAOA,EAAWK,cAEpB,OAAOpR,MAAMyM,KAAKV,IAEpB/G,YAAY,EACZC,cAAc,IAGhB6J,EAAU5V,UAAUiiB,cAAgB,SAAUC,GAC5C,IAAIxP,EAAQtS,KAEZ,QAAgB+E,IAAZ+c,EAKJ,OAAOA,EAAQtd,KAAI,SAAUyD,GAC3B,IAAKqD,EAASrD,GACZ,OAAOA,EAGT,IAAI8Z,EAAmB9Z,EAAO,KAAOqK,EAAM3Q,UAG3C,GAAIogB,IAAqBzP,EAAMjC,OAC7B,OAAOiC,EAAMyN,mBAAmB9X,EAAOqT,MAAM,IAG/C,IAAIlN,EAAiB2T,EAAmBzP,EAAMrQ,IAAMgG,EAASA,EAE7D,IAAIqK,EAAMjC,OASR,OAAOiC,EAAMyN,mBAAmB3R,GARhC,IAGE,OAFsBkE,EAAMjC,OAAO0P,mBAAmB3R,GAGtD,MAAOoN,GACP,MAAM,IAAInZ,MAAM,iDAAmDiQ,EAAM5J,GAAK,OAAS8S,EAAIC,cAQnGjG,EAAU5V,UAAUuZ,iBAAmB,SAAU6I,GAC/C,IAAI1P,EAAQtS,KAERiiB,ER13BR,SAAyBha,GACvB,QAAelD,IAAXkD,GD/hBe,KC+hBSA,EAI5B,OAAOnD,EAAQmD,GQq3BUia,CAAgBF,EAAiB/Z,QACpD4T,EAAW,aAAcmG,EAAmBA,EAAiBnG,UAAWoG,GAAmBA,EAAiBhQ,MAAK,SAAU6P,GAC7H,OAAOxW,EAASwW,IAAYA,EAAQ,KAAOxP,EAAM3Q,aAE/C0G,EAASrI,KAAKmI,QAAQG,QAAQD,OAC9BJ,EAASjI,KAAK6hB,cAAcI,GAE5BxK,EAAahQ,EAASA,EAAS,GAAIua,GAAmB,CACxDjV,QAAS2Q,GAAgBzO,EAAQ+S,EAAiBjV,UAClDvE,KAAMsG,EAAQkT,EAAiBxZ,KAAMH,GACrCJ,OAAQA,EACR2S,OAAQ5a,KACR6b,SAAUA,EACV/D,UAAWkK,EAAiB7f,MAC5BqR,OAAQ,WACN,OAAO/L,EAASA,EAAS,GAAIgQ,GAAa,CACxCxP,OAAQwP,EAAWxP,OAASwP,EAAWxP,OAAOzD,KAAI,SAAUnF,GAC1D,MAAO,IAAMA,EAAEqJ,WACZ3D,EACL6V,OAAQ,IAAMtI,EAAM5J,QAK1B,OAAO+O,GAGTjC,EAAU5V,UAAUoY,kBAAoB,WACtC,IAAImK,EAAK3e,EAIL4e,EAFA9P,EAAQtS,KAIZ,GAAKA,KAAKqS,OAAOyD,GAEV,GAAIpP,MAAMlE,QAAQxC,KAAKqS,OAAOyD,IACnCsM,EAAWpiB,KAAKqS,OAAOyD,OAClB,CACL,IAAIrS,EAAKzD,KAAKqS,OAAOyD,GACjBnS,EAAKyR,GACLtF,EAAKrM,EAAGE,GACR0e,OAAyB,IAAPvS,EAAgB,GAAKA,EACvCwS,EAA4B7O,EAAOhQ,EAAI,CAA+BE,MAE1Eye,EAAWvU,EAAQ0B,EAAK+S,GAA2B9d,KAAI,SAAUvC,GAK/D,IAAIsgB,EAAwBC,EAAwBvgB,EAAKqgB,EAA0BrgB,IAMnF,OAAOsgB,KACNnhB,OAAOohB,EAAwBpN,GAAUiN,UAtB5CD,EAAW,GAyBb,IAAIK,EAAkBziB,KAAKqS,OAAOwE,OAAS2L,EAAwB,GAAIxiB,KAAKqS,OAAOwE,QAAU,GACzF6L,EAAa1iB,KAAKqS,OAAO4C,OAASuN,EAAwBG,OAAOhG,GAAK3c,KAAK0I,KAAM1I,KAAKqS,OAAO4C,QAAU,GAM3G,IAAIF,EAAelH,EAAQ7N,KAAKiK,OAAOzF,KAAI,SAAU2Q,GACnD,IAAIyN,EAAoB,GAUxB,OARIzN,EAAUF,QACZ2N,EAAkB3hB,KAAKlB,MAAM6iB,EAAmBhe,EAAS4d,EAAwBG,OAAOE,GAAW1N,EAAUzM,KAAMyM,EAAUF,UAG3HE,EAAUD,SACZ0N,EAAkB3hB,KAAKlB,MAAM6iB,EAAmBhe,EAAS4d,EAAwBG,OAAOG,GAAM3N,EAAUzM,KAAMyM,EAAUD,WAGnH0N,MAEL5M,EAAqBhW,KAAKuY,MAC1BwK,EAAuBlV,EAAQjJ,EAAS8d,EAAY3N,EAAcqN,EAAUK,GAAiBje,KAAI,SAAUwd,GAC7G,OAAO/S,EAAQ+S,GAAkBxd,KAAI,SAAUiT,GAC7C,OAAOnF,EAAM6G,iBAAiB1B,UAIlC,IACE,IAAK,IAAIuL,EAAuBtf,EAASsS,GAAqBiN,EAAyBD,EAAqBriB,QAASsiB,EAAuBpiB,KAAMoiB,EAAyBD,EAAqBriB,OAAQ,CACtM,IAAIuY,EAAoB+J,EAAuBriB,MAC/CmiB,EAAqB9hB,KAAKiY,IAE5B,MAAOgK,GACPf,EAAM,CACJjhB,MAAOgiB,GAPX,QAUE,IACMD,IAA2BA,EAAuBpiB,OAAS2C,EAAKwf,EAAqBlf,SAASN,EAAG1D,KAAKkjB,GAD5G,QAGE,GAAIb,EAAK,MAAMA,EAAIjhB,OAIvB,OAAO6hB,GAGFvN,EA59CT,GCzCA,IAAI2N,GAAiB,CACnBC,aAAa,GAGXC,GAIJ,WACE,SAASA,EAAU/a,GACjBtI,KAAKsjB,iBAAkB,EACvBtjB,KAAKujB,MAAQ,GACbvjB,KAAKwjB,aAAc,EACnBxjB,KAAKsI,QAAUb,EAASA,EAAS,GAAI0b,IAAiB7a,GA4DxD,OAzDA+a,EAAUzjB,UAAU6jB,WAAa,SAAUC,GAGzC,GAFA1jB,KAAKwjB,aAAc,EAEfE,EAAU,CACZ,IAAK1jB,KAAKsI,QAAQ8a,YAEhB,YADApjB,KAAK2jB,SAASD,GAIhB1jB,KAAK4jB,QAAQF,GAGf1jB,KAAK6jB,eAGPR,EAAUzjB,UAAU+jB,SAAW,SAAUG,GACvC,GAAK9jB,KAAKwjB,cAAexjB,KAAKsjB,gBAA9B,CAKA,GAA0B,IAAtBtjB,KAAKujB,MAAM7jB,OACb,MAAM,IAAI2C,MAAM,gEAGlBrC,KAAK4jB,QAAQE,GACb9jB,KAAK6jB,mBATH7jB,KAAKujB,MAAMtiB,KAAK6iB,IAYpBT,EAAUzjB,UAAUmkB,MAAQ,WAC1B/jB,KAAKujB,MAAQ,IAGfF,EAAUzjB,UAAUikB,YAAc,WAGhC,IAFA,IAAIG,EAAehkB,KAAKujB,MAAM/D,QAEvBwE,GACLhkB,KAAK4jB,QAAQI,GACbA,EAAehkB,KAAKujB,MAAM/D,SAI9B6D,EAAUzjB,UAAUgkB,QAAU,SAAUF,GACtC1jB,KAAKsjB,iBAAkB,EAEvB,IACEI,IACA,MAAOxjB,GAIP,MADAF,KAAK+jB,QACC7jB,EANR,QAQEF,KAAKsjB,iBAAkB,IAIpBD,EAjET,GCTIpQ,GAAwB,IAAI5B,IAC5B4S,GAAiB,EACjBC,GACM,WACN,MAAO,KAAOD,MAFdC,GAIQ,SAAUxb,EAAIyb,GAEtB,OADAlR,GAASzB,IAAI9I,EAAIyb,GACVzb,GANPwb,GAQG,SAAUxb,GACb,OAAOuK,GAAS9D,IAAIzG,IATpBwb,GAWI,SAAUxb,GACduK,GAASmR,OAAO1b,ICFpB,IAqBI2b,GAEOA,GAvBPC,GAAwB,CAC1BC,MAAM,EACNC,aAAa,GASXC,GAAgC,WAClC,IAAIC,EAAe,GACnB,OAAO,SAAUC,EAASC,GACxBD,GAAWD,EAAazjB,KAAK0jB,GAC7B,IAAIxhB,EAASyhB,EAAGD,GAAWD,EAAaA,EAAahlB,OAAS,IAE9D,OADAilB,GAAWD,EAAaG,MACjB1hB,GANyB,IAYzBkhB,GAIRA,KAAsBA,GAAoB,KAHzBA,GAAiB,WAAiB,GAAK,aACzDA,GAAkBA,GAAiB,QAAc,GAAK,UACtDA,GAAkBA,GAAiB,QAAc,GAAK,UAGxD,IAAIS,GAIJ,WAOE,SAASA,EAAY3c,EAASG,GAC5B,IAAIgK,EAAQtS,UAEI,IAAZsI,IACFA,EAAUwc,EAAY3B,gBAGxBnjB,KAAKmI,QAAUA,EACfnI,KAAK+kB,UAAY,IAAAC,GACjBhlB,KAAKilB,iBAAmB,GACxBjlB,KAAKklB,UAAY,IAAIjV,IACrBjQ,KAAKmlB,iBAAmB,IAAIlV,IAC5BjQ,KAAKolB,cAAgB,IAAInV,IACzBjQ,KAAKqlB,cAAgB,IAAIpV,IACzBjQ,KAAKslB,eAAiB,IAAIrV,IAC1BjQ,KAAKulB,cAAgB,IAAItV,IAKzBjQ,KAAKwjB,aAAc,EACnBxjB,KAAKwlB,QAAUnB,GAAkBoB,WACjCzlB,KAAKiT,SAAW,IAAI5B,IACpBrR,KAAK0lB,UAAY,IAAIzV,IAKrBjQ,KAAK+J,KAAO/J,KAAK6I,MAWjB7I,KAAKoJ,KAAO,SAAUjH,EAAOqF,GAC3B,GAAIqE,EAAQ1J,GAGV,OAFAmQ,EAAMqT,MAAMxjB,GAELmQ,EAAM1P,MAGf,IAAIuC,EAAS2F,EAAauB,EAAclK,EAAOqF,IAE/C,GAAI8K,EAAMkT,UAAYnB,GAAkBuB,QAMtC,OAAOtT,EAAM1P,MAGf,GAAI0P,EAAMkT,UAAYnB,GAAkBoB,YAAcnT,EAAMhK,QAAQ8a,YAE9D,OAGC,GAAI9Q,EAAMkT,UAAYnB,GAAkBwB,QAC7C,MAAM,IAAIxjB,MAAM,UAAa8C,EAAO4B,KAAO,wCAA4CuL,EAAMnK,QAAQO,GAAK,kHAAqHod,KAAKC,UAAU5gB,EAAOG,OAYvP,OATAgN,EAAMyS,UAAUpB,UAAS,WAEvBrR,EAAM0T,QAAQ7gB,GAEd,IAAI8Z,EAAY3M,EAAM2M,UAAU9Z,GAEhCmN,EAAM/H,OAAO0U,EAAW9Z,MAGnBmN,EAAM2T,QAIfjmB,KAAKkmB,OAAS,SAAU/jB,EAAO8J,GAC7B,IAAIka,EAAW7T,EAAMjC,SAAWpE,IAAOC,EAAeka,QAAU9T,EAAMjC,OAAO3H,KAAOuD,GAChFhE,EAASke,EAAW7T,EAAMjC,OAASgW,GAAQpa,GAAMA,EAAKqG,EAAMW,SAAS9D,IAAIlD,IAAOqa,GAAara,GAEjG,GAAKhE,EAaD,YAAaA,EAEfA,EAAOmB,KAAK3B,EAASA,EAAS,GAAItF,GAAQ,CACxC4E,KAAM5E,EAAM4E,OAANwf,EAAyB,GAAKzD,GAAMxQ,EAAM5J,IAAMvG,EAAM4E,KAC5Dyf,OAAQlU,EAAMmU,aAIhBxe,EAAOmB,KAAKjH,EAAMmD,WApBlB,IAAK6gB,EACH,MAAM,IAAI9jB,MAAM,kCAAoC4J,EAAK,mBAAqBqG,EAAM5J,GAAK,OAuB/F,IAAIge,EAAkBjf,EAASA,EAAS,GAAIqd,EAAY3B,gBAAiB7a,GAErEqe,EAAQD,EAAgBC,MACxBC,EAASF,EAAgBE,OACzBvW,EAASqW,EAAgBrW,OACzB3H,EAAKge,EAAgBhe,GACrBme,OAAoB9hB,IAAP2D,EAAmBA,EAAKP,EAAQO,GACjD1I,KAAK0I,GAAKme,EACV7mB,KAAK4mB,OAASA,EACd5mB,KAAK2mB,MAAQA,EACb3mB,KAAKqQ,OAASA,EACdrQ,KAAKsI,QAAUoe,EACf1mB,KAAK+kB,UAAY,IAAAC,GAAc,CAC7B5B,YAAapjB,KAAKsI,QAAQ8a,cAE5BpjB,KAAKymB,UAAYH,KAsjCnB,OAnjCAnnB,OAAOsM,eAAeqZ,EAAYllB,UAAW,eAAgB,CAC3DuP,IAAK,WACH,IAAImD,EAAQtS,KAEZ,OAAIA,KAAK8mB,cACA9mB,KAAK8mB,cAGPrC,GAAiBzkB,MAAM,WAE5B,OADAsS,EAAMwU,cAAgBxU,EAAMnK,QAAQuM,aAC7BpC,EAAMwU,kBAGjBpb,YAAY,EACZC,cAAc,IAEhBxM,OAAOsM,eAAeqZ,EAAYllB,UAAW,QAAS,CACpDuP,IAAK,WAKH,OAAOnP,KAAKimB,QAEdva,YAAY,EACZC,cAAc,IAShBmZ,EAAYllB,UAAUmnB,QAAU,SAAUnkB,EAAOokB,GAC/C,IAAIzjB,EAAKC,EAET,IACE,IAAK,IAAIC,EAAKC,EAASd,EAAMmK,SAAUpJ,EAAKF,EAAG9C,QAASgD,EAAG9C,KAAM8C,EAAKF,EAAG9C,OAAQ,CAC/E,IAAIyK,EAASzH,EAAG/C,MAChBZ,KAAKuL,KAAKH,EAAQxI,EAAOokB,IAE3B,MAAOnjB,GACPN,EAAM,CACJrC,MAAO2C,GAPX,QAUE,IACMF,IAAOA,EAAG9C,OAAS2C,EAAKC,EAAGK,SAASN,EAAG1D,KAAK2D,GADlD,QAGE,GAAIF,EAAK,MAAMA,EAAIrC,SAKzB4jB,EAAYllB,UAAU2K,OAAS,SAAU3H,EAAOuC,GAC9C,IAAIjB,EAAKV,EAAIoM,EAAKnM,EAAIoM,EAAKlM,EAAIyB,EAAK0K,EAEhCwC,EAAQtS,KAiBZ,GAdA4C,EAAM8P,WAAa1S,KAAKymB,UAExBzmB,KAAKimB,OAASrjB,EAEV5C,KAAKsI,QAAQye,SACf/mB,KAAK+mB,QAAQ/mB,KAAK4C,OAIhB5C,KAAKinB,UACPjnB,KAAKinB,SAAS7d,KAAKjE,EAAOG,KAAM1C,GAI9BA,EAAMT,MACR,IACE,IAAK,IAAIwO,EAAKjN,EAAS1D,KAAKslB,gBAAiB1U,EAAKD,EAAGhQ,QAASiQ,EAAG/P,KAAM+P,EAAKD,EAAGhQ,OAAQ,EACjFumB,EAAWtW,EAAGhQ,OACTgC,EAAMT,QAEjB,MAAOkC,GACPH,EAAM,CACJhD,MAAOmD,GAPX,QAUE,IACMuM,IAAOA,EAAG/P,OAAS2C,EAAKmN,EAAG7M,SAASN,EAAG1D,KAAK6Q,GADlD,QAGE,GAAIzM,EAAK,MAAMA,EAAIhD,OAKzB,IACE,IAAK,IAAIimB,EAAKzjB,EAAS1D,KAAKklB,WAAYkC,EAAKD,EAAGxmB,QAASymB,EAAGvmB,KAAMumB,EAAKD,EAAGxmB,OAAQ,EAC5EumB,EAAWE,EAAGxmB,OACTgC,EAAOA,EAAMT,QAExB,MAAO8O,GACPrB,EAAM,CACJ1O,MAAO+P,GAPX,QAUE,IACMmW,IAAOA,EAAGvmB,OAAS4C,EAAK0jB,EAAGrjB,SAASL,EAAG3D,KAAKqnB,GADlD,QAGE,GAAIvX,EAAK,MAAMA,EAAI1O,OAIvB,IACE,IAAK,IAAImmB,EAAK3jB,EAAS1D,KAAKmlB,kBAAmBmC,EAAKD,EAAG1mB,QAAS2mB,EAAGzmB,KAAMymB,EAAKD,EAAG1mB,OAAQ,EAEvF4mB,EADsBD,EAAG1mB,OACTZ,KAAK4C,MAAMsC,QAASlF,KAAK4C,MAAMgQ,QAAU5S,KAAK4C,MAAMgQ,QAAQ1N,aAAUH,IAExF,MAAOqM,GACPvB,EAAM,CACJ3O,MAAOkQ,GAPX,QAUE,IACMkW,IAAOA,EAAGzmB,OAAS8C,EAAK0jB,EAAGvjB,SAASH,EAAG7D,KAAKunB,GADlD,QAGE,GAAIxX,EAAK,MAAMA,EAAI3O,OAIvB,IAAI8d,EAASlC,GAAela,EAAMsN,eAAiB,GAAIlQ,KAAKmI,SAE5D,GAAInI,KAAK4C,MAAMsN,eAAiB8O,EAAQ,CAEtC,IAAIwI,EAAsB5kB,EAAMsN,cAAcrB,MAAK,SAAUkC,GAC3D,MAAmB,UAAZA,EAAG3O,MAAoB2O,EAAGV,SAAWiC,EAAMnK,WAEhDiP,EAAWoQ,GAAuBA,EAAoBpQ,SAAWhD,EAAWoT,EAAoBpQ,SAAUxU,EAAMsC,QAASC,QAAUJ,EAEvI,IACE,IAAK,IAAI0iB,EAAK/jB,EAAS1D,KAAKqlB,eAAgBqC,EAAKD,EAAG9mB,QAAS+mB,EAAG7mB,KAAM6mB,EAAKD,EAAG9mB,OAAQ,EAChFumB,EAAWQ,EAAG9mB,OACTiiB,GAAW7iB,KAAK0I,GAAI0O,KAE/B,MAAO5R,GACPJ,EAAM,CACJlE,MAAOsE,GAPX,QAUE,IACMkiB,IAAOA,EAAG7mB,OAASiP,EAAK2X,EAAG3jB,SAASgM,EAAGhQ,KAAK2nB,GADlD,QAGE,GAAIriB,EAAK,MAAMA,EAAIlE,OAIvBlB,KAAKgJ,SAWT8b,EAAYllB,UAAU+nB,aAAe,SAAUT,GAO7C,OANAlnB,KAAKklB,UAAU3U,IAAI2W,GAEflnB,KAAKwlB,UAAYnB,GAAkBwB,SACrCqB,EAASlnB,KAAK4C,MAAO5C,KAAK4C,MAAMT,OAG3BnC,MAGT8kB,EAAYllB,UAAUqH,UAAY,SAAU2gB,EAAwBC,EACpEC,GACE,IAUIZ,EAVA5U,EAAQtS,KAEZ,IAAK4nB,EACH,MAAO,CACLhU,YAAa,cAOjB,IAAImU,EAA2BD,EAmB/B,MAjBsC,mBAA3BF,EACTV,EAAWU,GAEXV,EAAWU,EAAuBjnB,KAAKmS,KAAK8U,GAC5CG,EAA2BH,EAAuBI,SAASlV,KAAK8U,IAGlE5nB,KAAKklB,UAAU3U,IAAI2W,GAEflnB,KAAKwlB,UAAYnB,GAAkBwB,SACrCqB,EAASlnB,KAAK4C,OAGZmlB,GACF/nB,KAAKiV,OAAO8S,GAGP,CACLnU,YAAa,WACXsT,GAAY5U,EAAM4S,UAAUd,OAAO8C,GACnCa,GAA4BzV,EAAM+S,cAAcjB,OAAO2D,MAU7DjD,EAAYllB,UAAUqoB,QAAU,SAAUf,GAExC,OADAlnB,KAAKslB,eAAe/U,IAAI2W,GACjBlnB,MAQT8kB,EAAYllB,UAAUsoB,OAAS,SAAUhB,GAEvC,OADAlnB,KAAKulB,cAAchV,IAAI2W,GAChBlnB,MAQT8kB,EAAYllB,UAAUuoB,SAAW,SAAUjB,GAEzC,OADAlnB,KAAKmlB,iBAAiB5U,IAAI2W,GACnBlnB,MAQT8kB,EAAYllB,UAAUwoB,OAAS,SAAUlB,GAEvC,OADAlnB,KAAKolB,cAAc7U,IAAI2W,GAChBlnB,MAQT8kB,EAAYllB,UAAUqV,OAAS,SAAUiS,GAEvC,OADAlnB,KAAKqlB,cAAc9U,IAAI2W,GAChBlnB,MAQT8kB,EAAYllB,UAAUyoB,IAAM,SAAUnB,GAOpC,OANAlnB,KAAKklB,UAAUd,OAAO8C,GACtBlnB,KAAKslB,eAAelB,OAAO8C,GAC3BlnB,KAAKulB,cAAcnB,OAAO8C,GAC1BlnB,KAAKolB,cAAchB,OAAO8C,GAC1BlnB,KAAKqlB,cAAcjB,OAAO8C,GAC1BlnB,KAAKmlB,iBAAiBf,OAAO8C,GACtBlnB,MAQT8kB,EAAYllB,UAAUiJ,MAAQ,SAAU6L,GACtC,IAAIpC,EAAQtS,KAEZ,GAAIA,KAAKwlB,UAAYnB,GAAkBwB,QAErC,OAAO7lB,KAGTsmB,GAAkBtmB,KAAKymB,UAAWzmB,MAClCA,KAAKwjB,aAAc,EACnBxjB,KAAKwlB,QAAUnB,GAAkBwB,QACjC,IAAIyC,OAAiCvjB,IAAjB2P,EAA6B1U,KAAK0U,aAAe+P,GAAiBzkB,MAAM,WAC1F,ONhcAsL,EADW1I,EMicI8R,IN5bZ,UAAW9R,GAAS,YAAaA,EM4bL0P,EAAMnK,QAAQ2R,aAAapF,GAAgBpC,EAAMnK,QAAQ2R,aAAaT,GAAMlG,KAAKuB,EAAcpC,EAAMnK,QAAQjD,UNjclJ,IAAiBtC,KM2cb,OAPI5C,KAAKsI,QAAQ2e,UACfjnB,KAAKuoB,YAGPvoB,KAAK+kB,UAAUtB,YAAW,WACxBnR,EAAM/H,OAAO+d,EAAblV,OAEKpT,MAST8kB,EAAYllB,UAAUoJ,KAAO,WAC3B,IAAIlD,EAAKtC,EAAI+J,EAAK9J,EAAIie,EAAK/d,EAAIwe,EAAKrS,EAAI0Y,EAAM7X,EAE9C,IACE,IAAK,IAAIC,EAAKlN,EAAS1D,KAAKklB,WAAYiC,EAAKvW,EAAGjQ,QAASwmB,EAAGtmB,KAAMsmB,EAAKvW,EAAGjQ,OAAQ,CAChF,IAAIumB,EAAWC,EAAGvmB,MAClBZ,KAAKklB,UAAUd,OAAO8C,IAExB,MAAO9gB,GACPN,EAAM,CACJ5E,MAAOkF,GAPX,QAUE,IACM+gB,IAAOA,EAAGtmB,OAAS2C,EAAKoN,EAAG9M,SAASN,EAAG1D,KAAK8Q,GADlD,QAGE,GAAI9K,EAAK,MAAMA,EAAI5E,OAIvB,IACE,IAAK,IAAIkmB,EAAK1jB,EAAS1D,KAAKolB,eAAgBiC,EAAKD,EAAGzmB,QAAS0mB,EAAGxmB,KAAMwmB,EAAKD,EAAGzmB,OAAQ,EAChFumB,EAAWG,EAAGzmB,SAGlBZ,KAAKolB,cAAchB,OAAO8C,IAE5B,MAAOvZ,GACPJ,EAAM,CACJrM,MAAOyM,GATX,QAYE,IACM0Z,IAAOA,EAAGxmB,OAAS4C,EAAK2jB,EAAGtjB,SAASL,EAAG3D,KAAKsnB,GADlD,QAGE,GAAI7Z,EAAK,MAAMA,EAAIrM,OAIvB,IACE,IAAK,IAAIomB,EAAK5jB,EAAS1D,KAAKmlB,kBAAmBsC,EAAKH,EAAG3mB,QAAS8mB,EAAG5mB,KAAM4mB,EAAKH,EAAG3mB,OAAQ,CACnFumB,EAAWO,EAAG7mB,MAClBZ,KAAKmlB,iBAAiBf,OAAO8C,IAE/B,MAAOtF,GACPF,EAAM,CACJxgB,MAAO0gB,GAPX,QAUE,IACM6F,IAAOA,EAAG5mB,OAAS8C,EAAK2jB,EAAGxjB,SAASH,EAAG7D,KAAKwnB,GADlD,QAGE,GAAI5F,EAAK,MAAMA,EAAIxgB,OAIvB,IACE,IAAK,IAAIwmB,EAAKhkB,EAAS1D,KAAKqlB,eAAgBoD,EAAKf,EAAG/mB,QAAS8nB,EAAG5nB,KAAM4nB,EAAKf,EAAG/mB,OAAQ,CAChFumB,EAAWuB,EAAG7nB,MAClBZ,KAAKqlB,cAAcjB,OAAO8C,IAE5B,MAAOhE,GACPf,EAAM,CACJjhB,MAAOgiB,GAPX,QAUE,IACMuF,IAAOA,EAAG5nB,OAASiP,EAAK4X,EAAG5jB,SAASgM,EAAGhQ,KAAK4nB,GADlD,QAGE,GAAIvF,EAAK,MAAMA,EAAIjhB,OAKvBlB,KAAKiT,SAASnC,SAAQ,SAAUD,GAC1BrF,EAAWqF,EAAM7H,OACnB6H,EAAM7H,UAIV,IAEE,IAAK,IAAI0f,EAAKhlB,EAAS6L,EAAKvP,KAAKilB,mBAAoB0D,EAAKD,EAAG/nB,QAASgoB,EAAG9nB,KAAM8nB,EAAKD,EAAG/nB,OAAQ,CAC7F,IAAIsB,EAAM0mB,EAAG/nB,MACbZ,KAAK2mB,MAAMiC,aAAa5oB,KAAKilB,iBAAiBhjB,KAEhD,MAAO4mB,GACPL,EAAO,CACLtnB,MAAO2nB,GARX,QAWE,IACMF,IAAOA,EAAG9nB,OAAS8P,EAAK+X,EAAG5kB,SAAS6M,EAAG7Q,KAAK4oB,GADlD,QAGE,GAAIF,EAAM,MAAMA,EAAKtnB,OAQzB,OAJAlB,KAAK+kB,UAAUhB,QACf/jB,KAAKwjB,aAAc,EACnBxjB,KAAKwlB,QAAUnB,GAAkBuB,QACjCU,GAActmB,KAAKymB,WACZzmB,MAGT8kB,EAAYllB,UAAU+lB,MAAQ,SAAUlT,GACtC,IAAIH,EAAQtS,KAEZ,GAAIA,KAAKwlB,UAAYnB,GAAkBoB,YAAczlB,KAAKsI,QAAQ8a,YAE5D,OAGC,GAAIpjB,KAAKwlB,UAAYnB,GAAkBwB,QAC5C,MAAM,IAAIxjB,MACVoQ,EAAO/S,OAAS,iDAAoDM,KAAKmI,QAAQO,GAAK,0GAGxF1I,KAAK+kB,UAAUpB,UAAS,WACtB,IAAImF,EAAMtlB,EAENyb,EAAY3M,EAAM1P,MAClBmmB,GAAe,EACfC,EAAiB,GAEjBC,EAAU,SAAUtH,GACtB,IAAIxc,EAAS2F,EAAa6W,GAE1BrP,EAAM0T,QAAQ7gB,GAEd8Z,EAAYwF,GAAiBnS,GAAO,WAClC,OAAOA,EAAMnK,QAAQsP,WAAWwH,EAAW9Z,MAE7C6jB,EAAe/nB,KAAKlB,MAAMipB,EAAgBpkB,EAASqa,EAAUlS,QAAQvI,KAAI,SAAUwY,GACjF,ONllByBpa,EMklBGqc,ENjlBhC1T,GADqBH,EMklBQ4R,GNjlBfzR,KAEA9D,EAASA,EAAS,GAAI2D,GAAS,CAC/CG,UAAexG,IAATwG,EAAqB,WACzB,OAAOA,EAAK3I,EAAMsC,QAAStC,EAAMT,MAAO,CACtCiJ,OAAQA,EACRxI,MAAOA,EACPuC,OAAQvC,EAAMuC,eAEdJ,IAVR,IAA2BqG,EAAQxI,EAC7B2I,OMmlBEwd,EAAeA,KAAkB9J,EAAUE,SAG7C,IACE,IAAK,IAAI+J,EAAWxlB,EAAS+O,GAAS0W,EAAaD,EAASvoB,QAASwoB,EAAWtoB,KAAMsoB,EAAaD,EAASvoB,OAAQ,CAGlHsoB,EAFcE,EAAWvoB,QAI3B,MAAOwoB,GACPN,EAAO,CACL5nB,MAAOkoB,GARX,QAWE,IACMD,IAAeA,EAAWtoB,OAAS2C,EAAK0lB,EAASplB,SAASN,EAAG1D,KAAKopB,GADxE,QAGE,GAAIJ,EAAM,MAAMA,EAAK5nB,OAIzB+d,EAAUE,QAAU4J,EACpB9J,EAAUlS,QAAUic,EAEpB1W,EAAM/H,OAAO0U,EAAWnU,EAAa2H,EAAOA,EAAO/S,OAAS,SAUhEolB,EAAYllB,UAAUypB,OAAS,SAAUlnB,GACvC,OAAOnC,KAAKoJ,KAAK0J,KAAK9S,KAAMmC,IAW9B2iB,EAAYllB,UAAUqf,UAAY,SAAU9c,GAC1C,IAAImQ,EAAQtS,KAERmF,EAAS2F,EAAa3I,GAE1B,GAA2C,IAAvCgD,EAAO4B,KAAK5G,QAAZmpB,KAA6CtpB,KAAK4C,MAAM2mB,WAAWtX,MAAK,SAAUuX,GACpF,OAA4C,IAArCA,EAAUrpB,QAAVmpB,MAEP,MAAMnkB,EAAOG,KAAKA,KAMpB,OAHgBmf,GAAiBzkB,MAAM,WACrC,OAAOsS,EAAMnK,QAAQsP,WAAWnF,EAAM1P,MAAOuC,OAKjD2f,EAAYllB,UAAUomB,QAAU,SAAU7jB,GACxC,IAAIsnB,EAAMjmB,EAEV,IACE,IAAK,IAAIC,EAAKC,EAAS1D,KAAK0lB,WAAY/hB,EAAKF,EAAG9C,QAASgD,EAAG9C,KAAM8C,EAAKF,EAAG9C,OAAQ,CAChF,IAAI+H,EAAK/E,EAAG/C,MACRiQ,EAAQ7Q,KAAKiT,SAAS9D,IAAIzG,GAE9B,IAAKmI,EACH,MAAM,IAAIxO,MAAM,4BAA8BF,EAAQ,uBAAyBnC,KAAK0I,GAAK,2BAA6BA,EAAK,MAG7HmI,EAAMzH,KAAKjH,IAEb,MAAOunB,GACPD,EAAO,CACLvoB,MAAOwoB,GAbX,QAgBE,IACM/lB,IAAOA,EAAG9C,OAAS2C,EAAKC,EAAGK,SAASN,EAAG1D,KAAK2D,GADlD,QAGE,GAAIgmB,EAAM,MAAMA,EAAKvoB,SAK3B4jB,EAAYllB,UAAU+pB,MAAQ,SAAU7b,GACtC,IAAIwE,EAAQtS,KAEZA,KAAKilB,iBAAiBnX,EAAWpF,IAAM1I,KAAK2mB,MAAMiD,YAAW,WACvD9b,EAAW7B,GACbqG,EAAM4T,OAAOpY,EAAW3I,OAAQ2I,EAAW7B,IAE3CqG,EAAMlJ,KAAK0E,EAAW3I,UAEvB2I,EAAWxB,QAGhBwY,EAAYllB,UAAU0J,OAAS,SAAUwP,GACvC9Y,KAAK2mB,MAAMiC,aAAa5oB,KAAKilB,iBAAiBnM,WACvC9Y,KAAKilB,iBAAiBnM,IAG/BgM,EAAYllB,UAAU2L,KAAO,SAAUH,EAAQxI,EAAOsI,QAC1B,IAAtBA,IACFA,EAAoBlL,KAAKmI,QAAQG,QAAQyE,SAG3C,IAAI7H,EAAUtC,EAAMsC,QAChBC,EAASvC,EAAMuC,OACf0kB,EAAeze,EAAOG,MAAQue,GAAkB1e,EAAOhJ,KAAM8I,GAC7DK,EAAOC,EAAWqe,GAAgBA,EAAeA,EAAeA,EAAate,KAAOH,EAAOG,KAE/F,GAAIA,EACF,IACE,OAAOA,EAAKrG,EAASC,EAAOG,KAAM,CAChC8F,OAAQA,EACRxI,MAAO5C,KAAK4C,MACZuC,OAAQA,IAEV,MAAOqW,GAQP,MAPIxb,KAAKqQ,QACPrQ,KAAKqQ,OAAOjH,KAAK,CACfhH,KAAM,eACNkD,KAAMkW,IAIJA,EAIV,OAAQpQ,EAAOhJ,MACb,KAAAgK,EACE,IAAI0B,EAAa1C,EAEjB,GAAgC,iBAArB0C,EAAWxB,MAEpB,YADAtM,KAAK2pB,MAAM7b,GAGPA,EAAW7B,GACbjM,KAAKkmB,OAAOpY,EAAW3I,OAAQ2I,EAAW7B,IAE1CjM,KAAKoJ,KAAK0E,EAAW3I,QAIzB,MAEF,KAAA0T,EACE7Y,KAAKsJ,OAAO8B,EAAO0N,QACnB,MAEF,KAAA0F,EAEI,IAAIjH,EAAWnM,EAAOmM,SAItB,IAAKvX,KAAK4C,MAAM2P,WAAWgF,EAAS7O,IAAM6O,EAASnV,MACjD,MAIF,GAAImV,EAASnV,OAAS0G,EAAYoB,OAAQ,CACxC,IAAIoN,EAAetD,EAAeuD,EAAS3O,KACvCqL,EAAiBjU,KAAKmI,QAAQG,QAAQ4L,SAAWlU,KAAKmI,QAAQG,QAAQ4L,SAASoD,EAAalV,WAAQ2C,EACpG2D,EAAK6O,EAAS7O,GACdpD,EAAOiS,EAASjS,KAEhB,EAKJ,IAAIkf,EAAc,gBAAiBjN,EAAWA,EAASiN,cAAgBjN,EAASyO,QAEhF,IAAK/R,EAMH,YAAA,EAGF,IAAIE,EAAe7O,EAAO8O,EAAW9O,EAAMJ,EAASC,QAAUJ,EAC1D6V,EAASpP,EAAWyI,GAAkBA,EAAe/O,EAASC,EAAOG,KAAM,CAC7EA,KAAM6O,EACNvL,IAAK0O,IACFrD,EAED8V,EAAcnP,GAChB5a,KAAK4C,MAAMqQ,SAASvK,GAAM1I,KAAKgqB,aAAatkB,QAAQsU,QAAQY,GAASlS,GAC5D8C,EAAWoP,GACpB5a,KAAK4C,MAAMqQ,SAASvK,GAAM1I,KAAKiqB,cAAcrP,EAAQlS,GAC5CwhB,EAAatP,GACtB5a,KAAK4C,MAAMqQ,SAASvK,GAAM1I,KAAKmqB,gBAAgBvP,EAAQlS,GAC9C8L,EAAUoG,KAEnB5a,KAAK4C,MAAMqQ,SAASvK,GAAM1I,KAAKoqB,aAAajW,EAAeyG,EAAOnG,YAAYN,GAAgByG,EAAQ,CACpGlS,GAAIA,EACJ8b,YAAaA,UAIjBxkB,KAAKqqB,cAAc9S,GAGrB,MAGJ,KAAAkH,EAEIze,KAAKsqB,UAAUlf,EAAOmM,SAAS7O,IAC/B,MAGJ,KAAA6F,EACE,IAAIgc,EAAQnf,EAAOmf,MACf3pB,EAAQwK,EAAOxK,MAEf2pB,EACFvqB,KAAK4mB,OAAO2D,EAAO3pB,GAEnBZ,KAAK4mB,OAAOhmB,GAGd,MAEF,QACM,IAUVkkB,EAAYllB,UAAU4qB,YAAc,SAAUC,GAC5CzqB,KAAKiT,SAASmR,OAAOqG,GACrBzqB,KAAK0lB,UAAUtB,OAAOqG,UACfzqB,KAAK4C,MAAMqQ,SAASwX,IAG7B3F,EAAYllB,UAAU0qB,UAAY,SAAUG,GAC1C,IAAI5Z,EAAQ7Q,KAAKiT,SAAS9D,IAAIsb,GAEzB5Z,IAIL7Q,KAAKwqB,YAAYC,GAEbjf,EAAWqF,EAAM7H,OACnB6H,EAAM7H,SAIV8b,EAAYllB,UAAU8qB,MAAQ,SAAUpW,EAAQvN,EAAMuB,GACpD,GAAIyhB,EAAczV,GAChB,OAAOtU,KAAKgqB,aAAatkB,QAAQsU,QAAQ1F,GAASvN,GAC7C,GAAIyE,EAAW8I,GACpB,OAAOtU,KAAKiqB,cAAc3V,EAAQvN,GAC7B,GAAIsf,GAAQ/R,GACjB,OAAOtU,KAAK2qB,WAAWrW,GAClB,GAAI4V,EAAa5V,GACtB,OAAOtU,KAAKmqB,gBAAgB7V,EAAQvN,GAC/B,GAAIyN,EAAUF,GACnB,OAAOtU,KAAKoqB,aAAa9V,EAAQ7M,EAASA,EAAS,GAAIa,GAAU,CAC/DI,GAAI3B,KAGN,MAAM,IAAI1E,MAAM,2BAA8B0E,EAAO,qBAAyBuN,EAAS,OAI3FwQ,EAAYllB,UAAUwqB,aAAe,SAAUjiB,EAASG,GACtD,IAAIgK,EAAQtS,UAEI,IAAZsI,IACFA,EAAU,IAGZ,IAAIsiB,EAAe,IAAI9F,EAAY3c,EAASV,EAASA,EAAS,GAAIzH,KAAKsI,SAAU,CAC/E+H,OAAQrQ,KACR0I,GAAIJ,EAAQI,IAAMP,EAAQO,MAGxBge,EAAkBjf,EAASA,EAAS,GAAI6c,IAAwBhc,GAEhEoe,EAAgBnC,MAClBqG,EAAajD,cAAa,SAAU/kB,GAClC0P,EAAMlJ,KAANgW,EAAmB,CACjBxc,MAAOA,EACP8F,GAAIkiB,EAAaliB,QAKvB,IAAIyb,EAAQyG,EAcZ,OAbA5qB,KAAKiT,SAASzB,IAAIoZ,EAAaliB,GAAIyb,GAE/BuC,EAAgBlC,aAClBxkB,KAAK0lB,UAAUnV,IAAIqa,EAAaliB,IAGlCkiB,EAAa3V,QAAO,SAAU4V,GAC5BvY,EAAMkY,YAAYI,EAAaliB,IAE/B4J,EAAMlJ,KAAK0B,EAAa+f,EAAW,CACjCrE,OAAQoE,EAAaliB,SAEtBG,QACIsb,GAGTW,EAAYllB,UAAUoqB,aAAe,SAAUc,EAASpiB,GACtD,IAAI4J,EAAQtS,KAER+qB,GAAW,EACfD,EAAQnlB,MAAK,SAAUqlB,GAChBD,IACHzY,EAAMkY,YAAY9hB,GAElB4J,EAAMlJ,KAAK0B,EAAa+X,GAAWna,EAAIsiB,GAAW,CAChDxE,OAAQ9d,SAGX,SAAUuiB,GACX,IAAKF,EAAU,CACbzY,EAAMkY,YAAY9hB,GAElB,IAAIwiB,EAAapI,GAAMpa,EAAIuiB,GAE3B,IAEE3Y,EAAMlJ,KAAK0B,EAAaogB,EAAY,CAClC1E,OAAQ9d,KAEV,MAAOxH,GAGHoR,EAAM2U,UACR3U,EAAM2U,SAAS7d,KAAK8hB,EAAY5Y,EAAM1P,OAGpC0P,EAAMnK,QAAQ2O,QAKhBxE,EAAMtJ,YAKd,IAAImb,EAAQ,CACVzb,GAAIA,EACJU,KAAM,aAGNnC,UAAW,SAAUtG,EAAMwqB,EAAanD,GACtC,IAAIoD,GAAe,EAoBnB,OAnBAN,EAAQnlB,MAAK,SAAUqlB,GACjBI,IAIJzqB,GAAQA,EAAKqqB,GAETI,GAIJpD,GAAYA,QACX,SAAUxM,GACP4P,GAIJD,EAAY3P,MAEP,CACL5H,YAAa,WACX,OAAOwX,GAAe,KAI5BpiB,KAAM,WACJ+hB,GAAW,GAEbvX,OAAQ,WACN,MAAO,CACL9K,GAAIA,KAKV,OADA1I,KAAKiT,SAASzB,IAAI9I,EAAIyb,GACfA,GAGTW,EAAYllB,UAAUqqB,cAAgB,SAAUvG,EAAUhb,GACxD,IAkBI2iB,EAlBA/Y,EAAQtS,KAER+qB,GAAW,EACXO,EAAY,IAAIrb,IAChBiV,EAAY,IAAIjV,IAgBpB,IACEob,EAAe3H,GAfH,SAAUxjB,GACtBglB,EAAUpU,SAAQ,SAAUoW,GAC1B,OAAOA,EAAShnB,MAGd6qB,GAIJzY,EAAMlJ,KAAKlJ,MAMsB,SAAUqrB,GACzCD,EAAU/a,IAAIgb,MAEhB,MAAO/P,GACPxb,KAAKoJ,KAAK0Z,GAAMpa,EAAI8S,IAGtB,GAAIuO,EAAcsB,GAGhB,OAAOrrB,KAAKgqB,aAAaqB,EAAc3iB,GAGzC,IAAIyb,EAAQ,CACVzb,GAAIA,EACJU,KAAM,SAAUjH,GACd,OAAOmpB,EAAUxa,SAAQ,SAAU0a,GACjC,OAAOA,EAASrpB,OAGpB8E,UAAW,SAAUtG,GAEnB,OADAukB,EAAU3U,IAAI5P,GACP,CACLiT,YAAa,WACXsR,EAAUd,OAAOzjB,MAIvBqI,KAAM,WACJ+hB,GAAW,EAEPvf,EAAW6f,IACbA,KAGJ7X,OAAQ,WACN,MAAO,CACL9K,GAAIA,KAKV,OADA1I,KAAKiT,SAASzB,IAAI9I,EAAIyb,GACfA,GAGTW,EAAYllB,UAAUuqB,gBAAkB,SAAUvP,EAAQlS,GACxD,IAAI4J,EAAQtS,KAERyrB,EAAe7Q,EAAO3T,WAAU,SAAUrG,GAC5C0R,EAAMlJ,KAAK0B,EAAalK,EAAO,CAC7B4lB,OAAQ9d,QAET,SAAU8S,GACXlJ,EAAMkY,YAAY9hB,GAElB4J,EAAMlJ,KAAK0B,EAAagY,GAAMpa,EAAI8S,GAAM,CACtCgL,OAAQ9d,QAET,WACD4J,EAAMkY,YAAY9hB,GAElB4J,EAAMlJ,KAAK0B,EAAa+X,GAAWna,GAAK,CACtC8d,OAAQ9d,QAGRyb,EAAQ,CACVzb,GAAIA,EACJU,KAAM,aAGNnC,UAAW,SAAUtG,EAAMwqB,EAAanD,GACtC,OAAOpN,EAAO3T,UAAUtG,EAAMwqB,EAAanD,IAE7Chf,KAAM,WACJ,OAAOyiB,EAAa7X,eAEtBJ,OAAQ,WACN,MAAO,CACL9K,GAAIA,KAKV,OADA1I,KAAKiT,SAASzB,IAAI9I,EAAIyb,GACfA,GAGTW,EAAYllB,UAAU+qB,WAAa,SAAUxG,GAE3C,OADAnkB,KAAKiT,SAASzB,IAAI2S,EAAMzb,GAAIyb,GACrBA,GAGTW,EAAYllB,UAAUyqB,cAAgB,SAAU9S,GAC9C,IAAImU,EAAiB1rB,KAAKmI,QAAQG,SAAWtI,KAAKmI,QAAQG,QAAQiK,WAAavS,KAAKmI,QAAQG,QAAQiK,WAAWgF,EAASnV,WAAQ2C,EAEhI,GAAK2mB,EAAL,CAUA,IAAIC,EAAUD,EAAe1rB,KAAK4C,MAAMsC,QAASqS,GACjDvX,KAAK4rB,YAAYrU,EAAS7O,GAAIijB,KAGhC7G,EAAYllB,UAAUgsB,YAAc,SAAUljB,EAAIijB,GAChD3rB,KAAKiT,SAASzB,IAAI9I,EAAI,CACpBA,GAAIA,EACJU,KAAM,aAGNnC,UAAW,WACT,MAAO,CACL2M,YAAa,eAKjB5K,KAAM2iB,QAAW5mB,EACjByO,OAAQ,WACN,MAAO,CACL9K,GAAIA,OAMZoc,EAAYllB,UAAU2oB,UAAY,WAChC,GAAIvoB,KAAKsI,QAAQ2e,UAA8B,oBAAXjoB,QAC9BA,OAAO6sB,6BAA8B,CACvC,IAAIC,EAAmD,iBAA1B9rB,KAAKsI,QAAQ2e,SAAwBjnB,KAAKsI,QAAQ2e,cAAWliB,EAC1F/E,KAAKinB,SAAWjoB,OAAO6sB,6BAA6BE,QAAQtkB,EAASA,EAAS,CAC5EV,KAAM/G,KAAK0I,GACXsjB,WAAW,EACXC,eAAgB,SAAUrpB,GACxB,MAAO,CACLhC,MAAOgC,EAAMhC,MACbsE,QAAStC,EAAMsC,QACf6H,QAASnK,EAAMmK,WAGlB+e,GAAkB,CACnBI,SAAUzkB,EAAS,CACjB0kB,MAAM,EACNC,MAAM,GACLN,EAAkBA,EAAgBI,cAAWnnB,KAC9C/E,KAAKmI,SACTnI,KAAKinB,SAASld,KAAK/J,KAAK4C,SAQ9BkiB,EAAYllB,UAAU4T,OAAS,WAC7B,MAAO,CACL9K,GAAI1I,KAAK0I,KAIboc,EAAYllB,UAAZysB,GAA0C,WACxC,OAAOrsB,MAUT8kB,EAAY3B,eAA8B,SAAUlkB,GAClD,MAAO,CACL8nB,SAAS,EACT3D,aAAa,EACbuD,MAAO,CACLiD,WAAY,SAAUhF,EAAI0H,GACxB,OAAOrtB,EAAO2qB,WAAW9pB,KAAK,KAAM8kB,EAAI0H,IAE1C1D,aAAc,SAAUlgB,GACtB,OAAOzJ,EAAO2pB,aAAa9oB,KAAK,KAAM4I,KAG1Cke,OAAQ3nB,EAAOstB,QAAQ5iB,IAAImJ,KAAKyZ,SAChCtF,UAAU,GAb4B,CAetB,oBAAXjoB,OAAPH,EAAyCG,QAE3C8lB,EAAY0H,UAAYA,GACjB1H,EAxrCT,GA8tCA,SAAS0H,GAAUrkB,EAASG,GAE1B,OADkB,IAAIwc,GAAY3c,EAASG,gsBClvC7C,ICfuB+J,GAAQ/J,GACzBmkB,GD8HAC,GAAqBC,IC/HJta,GDoBrB,CACEkE,QAAS,OACTrR,QAAS,CACPwD,GAAI,KACJkkB,WAAY,IAAIvb,IAChBoE,MAAO,GACPoX,GAAI,EACJC,GAAI,EACJC,GAAI,EACJC,GAAI,GAENzmB,OAAQ,CACN0mB,KAAM,CACJnX,GAAI,CACFoX,UAAW,CACTjlB,OAAQ,WACR8E,QAAS,CAAC,uBAIhBogB,SAAU,CACRnW,MAAO,CAAC,mBACRlB,GAAI,CACFsX,UAAW,CACTnlB,OAAQ,WACR8E,QAAS,CAAC,qBAEZsgB,QAAS,CACPplB,OAAQ,OACR8E,QAAS,CAAC,yBCjDSzE,GDuD7B,CACEyE,QAAS,CACPugB,iBAAkBC,IAChB,SAACroB,EAA6B/C,GAC5B,IAAM8F,EAAS9F,EAAM8F,OACfulB,EAAIC,WACRC,iBAAiBzlB,GAAQ0lB,iBAAiB,SAEtCC,EAAIH,WACRC,iBAAiBzlB,GAAQ0lB,iBAAiB,QAGtCE,EAAY3oB,EAAQ0nB,WAAWzd,IAAIlH,EAAOS,KAAO,CACrD8kB,EAAAA,EACAI,EAAAA,GAGF,OAAAE,GAAAA,GAAA,GACK5oB,GADL,GAAA,CAEEwD,GAAIT,EAAOS,GACXkkB,WAAY1nB,EAAQ0nB,WAAWpb,IAAIvJ,EAAOS,GAAImlB,GAC9ChB,GAAI1qB,EAAM4rB,QACVjB,GAAI3qB,EAAM6rB,aAIhBC,gBAAiBV,IACf,SAACroB,EAA6B/C,GAC5B,IAAM8F,EAASimB,SAASC,eAAejpB,EAAQwD,IAe/C,OAbAxD,EAAQuQ,MAAQvQ,EAAQuQ,MACrB2C,QAAO,SAAC1P,GAAD,OAAQA,IAAOT,EAAOS,MAC7BtH,OAAO6G,EAAOS,IAESwlB,SAASE,iBACjC,oBAEgBtd,SAAQ,SAAC+c,GACzB,IAAMQ,EAAYnpB,EAAQuQ,MAAMoE,SAASgU,EAAUnlB,IACnDmlB,EAAUS,MAAMC,OAAhB,GAAAntB,OACEitB,EAAYnpB,EAAQuQ,MAAMtV,QAAQ0tB,EAAUnlB,IAAM,EAAI,MAGnDxD,KAGXspB,iBAAkBjB,IAChB,SAACroB,EAA6B/C,GAC5B,OAAA2rB,GAAAA,GAAA,GACK5oB,GADL,GAAA,CAEE6nB,GAAI5qB,EAAM4rB,QAAU7oB,EAAQ2nB,GAC5BG,GAAI7qB,EAAM6rB,QAAU9oB,EAAQ4nB,QAIlC2B,iBAAkBlB,IAAO,SAACroB,GACxB,IAAM2oB,EAAY3oB,EAAQ0nB,WAAWzd,IAAIjK,EAAQwD,IAEjD,OAAAolB,GAAAA,GAAA,GACK5oB,GADL,GAAA,CAEE0nB,WAAY1nB,EAAQ0nB,WAAWpb,IAAItM,EAAQwD,GAAI,CAC7C8kB,EAAGtoB,EAAQ6nB,IAAMc,EAAYA,EAAUL,EAAI,GAC3CI,EAAG1oB,EAAQ8nB,IAAMa,EAAYA,EAAUD,EAAI,KAE7Cb,GAAI,EACJC,GAAI,SCvHRP,GAAmD,mBAAnBpa,GAAOnN,QAAyBmN,GAAOnN,UAAYmN,GAAOnN,QACvF,IAAAwpB,GAAcrc,GAAQ/J,GAASmkB,MD8HrC9E,cAAa,SAAC/kB,EAAOT,GACpB,GAAIS,EAAMuc,QAAS,CACjB,IAAMlX,EAASimB,SAASC,eAAevrB,EAAMsC,QAAQwD,IAErD,OAAQ9F,EAAMhC,OACZ,IAAK,WACH,IAAMitB,EAAYjrB,EAAMsC,QAAQ0nB,WAAWzd,IAAIvM,EAAMsC,QAAQwD,IAC7DT,EAAO0mB,QAAQxB,SAAW,OAC1BllB,EAAOqmB,MAAMM,YACX,OADF,GAAAxtB,OAEKysB,EAAUL,EAAI5qB,EAAMsC,QAAQ6nB,GAFjC,OAIA9kB,EAAOqmB,MAAMM,YACX,MADF,GAAAxtB,OAEKysB,EAAUD,EAAIhrB,EAAMsC,QAAQ8nB,GAFjC,OAIA,MAEF,IAAK,OACH/kB,EAAO0mB,QAAQxB,SAAW,aAMjCtkB,QAEHqlB,SAASW,iBAAiB,aAAa,SAAC1sB,GACtC,IAAM8F,EAAS9F,EAAM8F,OACf6mB,EAAc7mB,EAAO8mB,aAAa,kBAClCC,IAAU/mB,EAAOS,GAElBomB,IACAE,EAKLtC,GAAmBtjB,KAAKjH,GAJtBoqB,QAAQ5iB,IAAI,mDAOhBukB,SAASW,iBAAiB,aAAa,SAAC1sB,GACtCuqB,GAAmBtjB,KAAKjH,MAG1B+rB,SAASW,iBAAiB,WAAW,SAAC1sB,GACpCuqB,GAAmBtjB,KAAKjH","sources":["./Users/matheus.ligabue/Development/JavaScript/xstate-drag-and-drop-example/node_modules/@parcel/scope-hoisting/lib/helpers.js","./node_modules/xstate/es/_virtual/_tslib.js","./node_modules/xstate/es/constants.js","./node_modules/xstate/es/utils.js","./node_modules/xstate/es/types.js","./node_modules/xstate/es/actionTypes.js","./node_modules/xstate/es/actions.js","./node_modules/xstate/es/stateUtils.js","./node_modules/xstate/es/State.js","./node_modules/xstate/es/Actor.js","./node_modules/xstate/es/invokeUtils.js","./node_modules/xstate/es/StateNode.js","./node_modules/xstate/es/scheduler.js","./node_modules/xstate/es/registry.js","./node_modules/xstate/es/interpreter.js","./site/index.ts","./node_modules/xstate/es/Machine.js"],"sourcesContent":[null,"/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nfunction __rest(s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n}\n\nfunction __values(o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n      i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n}\n\nfunction __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n}\n\nfunction __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n}\n\nexport { __assign, __read, __rest, __spread, __values };","var STATE_DELIMITER = '.';\nvar EMPTY_ACTIVITY_MAP = {};\nvar DEFAULT_GUARD_TYPE = 'xstate.guard';\nvar TARGETLESS_KEY = '';\nexport { DEFAULT_GUARD_TYPE, EMPTY_ACTIVITY_MAP, STATE_DELIMITER, TARGETLESS_KEY };","import { __spread, __values, __read, __assign } from './_virtual/_tslib.js';\nimport { DEFAULT_GUARD_TYPE, TARGETLESS_KEY, STATE_DELIMITER } from './constants.js';\nimport { IS_PRODUCTION } from './environment.js';\n\nfunction keys(value) {\n  return Object.keys(value);\n}\n\nfunction matchesState(parentStateId, childStateId, delimiter) {\n  if (delimiter === void 0) {\n    delimiter = STATE_DELIMITER;\n  }\n\n  var parentStateValue = toStateValue(parentStateId, delimiter);\n  var childStateValue = toStateValue(childStateId, delimiter);\n\n  if (isString(childStateValue)) {\n    if (isString(parentStateValue)) {\n      return childStateValue === parentStateValue;\n    } // Parent more specific than child\n\n\n    return false;\n  }\n\n  if (isString(parentStateValue)) {\n    return parentStateValue in childStateValue;\n  }\n\n  return keys(parentStateValue).every(function (key) {\n    if (!(key in childStateValue)) {\n      return false;\n    }\n\n    return matchesState(parentStateValue[key], childStateValue[key]);\n  });\n}\n\nfunction getEventType(event) {\n  try {\n    return isString(event) || typeof event === 'number' ? \"\" + event : event.type;\n  } catch (e) {\n    throw new Error('Events must be strings or objects with a string event.type property.');\n  }\n}\n\nfunction toStatePath(stateId, delimiter) {\n  try {\n    if (isArray(stateId)) {\n      return stateId;\n    }\n\n    return stateId.toString().split(delimiter);\n  } catch (e) {\n    throw new Error(\"'\" + stateId + \"' is not a valid state path.\");\n  }\n}\n\nfunction isStateLike(state) {\n  return typeof state === 'object' && 'value' in state && 'context' in state && 'event' in state && '_event' in state;\n}\n\nfunction toStateValue(stateValue, delimiter) {\n  if (isStateLike(stateValue)) {\n    return stateValue.value;\n  }\n\n  if (isArray(stateValue)) {\n    return pathToStateValue(stateValue);\n  }\n\n  if (typeof stateValue !== 'string') {\n    return stateValue;\n  }\n\n  var statePath = toStatePath(stateValue, delimiter);\n  return pathToStateValue(statePath);\n}\n\nfunction pathToStateValue(statePath) {\n  if (statePath.length === 1) {\n    return statePath[0];\n  }\n\n  var value = {};\n  var marker = value;\n\n  for (var i = 0; i < statePath.length - 1; i++) {\n    if (i === statePath.length - 2) {\n      marker[statePath[i]] = statePath[i + 1];\n    } else {\n      marker[statePath[i]] = {};\n      marker = marker[statePath[i]];\n    }\n  }\n\n  return value;\n}\n\nfunction mapValues(collection, iteratee) {\n  var result = {};\n  var collectionKeys = keys(collection);\n\n  for (var i = 0; i < collectionKeys.length; i++) {\n    var key = collectionKeys[i];\n    result[key] = iteratee(collection[key], key, collection, i);\n  }\n\n  return result;\n}\n\nfunction mapFilterValues(collection, iteratee, predicate) {\n  var e_1, _a;\n\n  var result = {};\n\n  try {\n    for (var _b = __values(keys(collection)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var key = _c.value;\n      var item = collection[key];\n\n      if (!predicate(item)) {\n        continue;\n      }\n\n      result[key] = iteratee(item, key, collection);\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return result;\n}\n/**\r\n * Retrieves a value at the given path.\r\n * @param props The deep path to the prop of the desired value\r\n */\n\n\nvar path = function (props) {\n  return function (object) {\n    var e_2, _a;\n\n    var result = object;\n\n    try {\n      for (var props_1 = __values(props), props_1_1 = props_1.next(); !props_1_1.done; props_1_1 = props_1.next()) {\n        var prop = props_1_1.value;\n        result = result[prop];\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (props_1_1 && !props_1_1.done && (_a = props_1.return)) _a.call(props_1);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    return result;\n  };\n};\n/**\r\n * Retrieves a value at the given path via the nested accessor prop.\r\n * @param props The deep path to the prop of the desired value\r\n */\n\n\nfunction nestedPath(props, accessorProp) {\n  return function (object) {\n    var e_3, _a;\n\n    var result = object;\n\n    try {\n      for (var props_2 = __values(props), props_2_1 = props_2.next(); !props_2_1.done; props_2_1 = props_2.next()) {\n        var prop = props_2_1.value;\n        result = result[accessorProp][prop];\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (props_2_1 && !props_2_1.done && (_a = props_2.return)) _a.call(props_2);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    return result;\n  };\n}\n\nfunction toStatePaths(stateValue) {\n  if (!stateValue) {\n    return [[]];\n  }\n\n  if (isString(stateValue)) {\n    return [[stateValue]];\n  }\n\n  var result = flatten(keys(stateValue).map(function (key) {\n    var subStateValue = stateValue[key];\n\n    if (typeof subStateValue !== 'string' && (!subStateValue || !Object.keys(subStateValue).length)) {\n      return [[key]];\n    }\n\n    return toStatePaths(stateValue[key]).map(function (subPath) {\n      return [key].concat(subPath);\n    });\n  }));\n  return result;\n}\n\nfunction flatten(array) {\n  var _a;\n\n  return (_a = []).concat.apply(_a, __spread(array));\n}\n\nfunction toArrayStrict(value) {\n  if (isArray(value)) {\n    return value;\n  }\n\n  return [value];\n}\n\nfunction toArray(value) {\n  if (value === undefined) {\n    return [];\n  }\n\n  return toArrayStrict(value);\n}\n\nfunction mapContext(mapper, context, _event) {\n  var e_5, _a;\n\n  if (isFunction(mapper)) {\n    return mapper(context, _event.data);\n  }\n\n  var result = {};\n\n  try {\n    for (var _b = __values(Object.keys(mapper)), _c = _b.next(); !_c.done; _c = _b.next()) {\n      var key = _c.value;\n      var subMapper = mapper[key];\n\n      if (isFunction(subMapper)) {\n        result[key] = subMapper(context, _event.data);\n      } else {\n        result[key] = subMapper;\n      }\n    }\n  } catch (e_5_1) {\n    e_5 = {\n      error: e_5_1\n    };\n  } finally {\n    try {\n      if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n    } finally {\n      if (e_5) throw e_5.error;\n    }\n  }\n\n  return result;\n}\n\nfunction isBuiltInEvent(eventType) {\n  return /^(done|error)\\./.test(eventType);\n}\n\nfunction isPromiseLike(value) {\n  if (value instanceof Promise) {\n    return true;\n  } // Check if shape matches the Promise/A+ specification for a \"thenable\".\n\n\n  if (value !== null && (isFunction(value) || typeof value === 'object') && isFunction(value.then)) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction partition(items, predicate) {\n  var e_6, _a;\n\n  var _b = __read([[], []], 2),\n      truthy = _b[0],\n      falsy = _b[1];\n\n  try {\n    for (var items_1 = __values(items), items_1_1 = items_1.next(); !items_1_1.done; items_1_1 = items_1.next()) {\n      var item = items_1_1.value;\n\n      if (predicate(item)) {\n        truthy.push(item);\n      } else {\n        falsy.push(item);\n      }\n    }\n  } catch (e_6_1) {\n    e_6 = {\n      error: e_6_1\n    };\n  } finally {\n    try {\n      if (items_1_1 && !items_1_1.done && (_a = items_1.return)) _a.call(items_1);\n    } finally {\n      if (e_6) throw e_6.error;\n    }\n  }\n\n  return [truthy, falsy];\n}\n\nfunction updateHistoryStates(hist, stateValue) {\n  return mapValues(hist.states, function (subHist, key) {\n    if (!subHist) {\n      return undefined;\n    }\n\n    var subStateValue = (isString(stateValue) ? undefined : stateValue[key]) || (subHist ? subHist.current : undefined);\n\n    if (!subStateValue) {\n      return undefined;\n    }\n\n    return {\n      current: subStateValue,\n      states: updateHistoryStates(subHist, subStateValue)\n    };\n  });\n}\n\nfunction updateHistoryValue(hist, stateValue) {\n  return {\n    current: stateValue,\n    states: updateHistoryStates(hist, stateValue)\n  };\n}\n\nfunction updateContext(context, _event, assignActions, state) {\n  if (!IS_PRODUCTION) {\n    warn(!!context, 'Attempting to update undefined context');\n  }\n\n  var updatedContext = context ? assignActions.reduce(function (acc, assignAction) {\n    var e_7, _a;\n\n    var assignment = assignAction.assignment;\n    var meta = {\n      state: state,\n      action: assignAction,\n      _event: _event\n    };\n    var partialUpdate = {};\n\n    if (isFunction(assignment)) {\n      partialUpdate = assignment(acc, _event.data, meta);\n    } else {\n      try {\n        for (var _b = __values(keys(assignment)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var key = _c.value;\n          var propAssignment = assignment[key];\n          partialUpdate[key] = isFunction(propAssignment) ? propAssignment(acc, _event.data, meta) : propAssignment;\n        }\n      } catch (e_7_1) {\n        e_7 = {\n          error: e_7_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_7) throw e_7.error;\n        }\n      }\n    }\n\n    return Object.assign({}, acc, partialUpdate);\n  }, context) : context;\n  return updatedContext;\n} // tslint:disable-next-line:no-empty\n\n\nvar warn = function () {};\n\nif (!IS_PRODUCTION) {\n  warn = function (condition, message) {\n    var error = condition instanceof Error ? condition : undefined;\n\n    if (!error && condition) {\n      return;\n    }\n\n    if (console !== undefined) {\n      var args = [\"Warning: \" + message];\n\n      if (error) {\n        args.push(error);\n      } // tslint:disable-next-line:no-console\n\n\n      console.warn.apply(console, args);\n    }\n  };\n}\n\nfunction isArray(value) {\n  return Array.isArray(value);\n} // tslint:disable-next-line:ban-types\n\n\nfunction isFunction(value) {\n  return typeof value === 'function';\n}\n\nfunction isString(value) {\n  return typeof value === 'string';\n} // export function memoizedGetter<T, TP extends { prototype: object }>(\n//   o: TP,\n//   property: string,\n//   getter: () => T\n// ): void {\n//   Object.defineProperty(o.prototype, property, {\n//     get: getter,\n//     enumerable: false,\n//     configurable: false\n//   });\n// }\n\n\nfunction toGuard(condition, guardMap) {\n  if (!condition) {\n    return undefined;\n  }\n\n  if (isString(condition)) {\n    return {\n      type: DEFAULT_GUARD_TYPE,\n      name: condition,\n      predicate: guardMap ? guardMap[condition] : undefined\n    };\n  }\n\n  if (isFunction(condition)) {\n    return {\n      type: DEFAULT_GUARD_TYPE,\n      name: condition.name,\n      predicate: condition\n    };\n  }\n\n  return condition;\n}\n\nfunction isObservable(value) {\n  try {\n    return 'subscribe' in value && isFunction(value.subscribe);\n  } catch (e) {\n    return false;\n  }\n}\n\nvar symbolObservable = /*#__PURE__*/function () {\n  return typeof Symbol === 'function' && Symbol.observable || '@@observable';\n}();\n\nfunction isMachine(value) {\n  try {\n    return '__xstatenode' in value;\n  } catch (e) {\n    return false;\n  }\n}\n\nvar uniqueId = /*#__PURE__*/function () {\n  var currentId = 0;\n  return function () {\n    currentId++;\n    return currentId.toString(16);\n  };\n}();\n\nfunction toEventObject(event, payload // id?: TEvent['type']\n) {\n  if (isString(event) || typeof event === 'number') {\n    return __assign({\n      type: event\n    }, payload);\n  }\n\n  return event;\n}\n\nfunction toSCXMLEvent(event, scxmlEvent) {\n  if (!isString(event) && '$$type' in event && event.$$type === 'scxml') {\n    return event;\n  }\n\n  var eventObject = toEventObject(event);\n  return __assign({\n    name: eventObject.type,\n    data: eventObject,\n    $$type: 'scxml',\n    type: 'external'\n  }, scxmlEvent);\n}\n\nfunction toTransitionConfigArray(event, configLike) {\n  var transitions = toArrayStrict(configLike).map(function (transitionLike) {\n    if (typeof transitionLike === 'undefined' || typeof transitionLike === 'string' || isMachine(transitionLike)) {\n      return {\n        target: transitionLike,\n        event: event\n      };\n    }\n\n    return __assign(__assign({}, transitionLike), {\n      event: event\n    });\n  });\n  return transitions;\n}\n\nfunction normalizeTarget(target) {\n  if (target === undefined || target === TARGETLESS_KEY) {\n    return undefined;\n  }\n\n  return toArray(target);\n}\n\nfunction reportUnhandledExceptionOnInvocation(originalError, currentError, id) {\n  if (!IS_PRODUCTION) {\n    var originalStackTrace = originalError.stack ? \" Stacktrace was '\" + originalError.stack + \"'\" : '';\n\n    if (originalError === currentError) {\n      // tslint:disable-next-line:no-console\n      console.error(\"Missing onError handler for invocation '\" + id + \"', error was '\" + originalError + \"'.\" + originalStackTrace);\n    } else {\n      var stackTrace = currentError.stack ? \" Stacktrace was '\" + currentError.stack + \"'\" : ''; // tslint:disable-next-line:no-console\n\n      console.error(\"Missing onError handler and/or unhandled exception/promise rejection for invocation '\" + id + \"'. \" + (\"Original error: '\" + originalError + \"'. \" + originalStackTrace + \" Current error is '\" + currentError + \"'.\" + stackTrace));\n    }\n  }\n}\n\nfunction evaluateGuard(machine, guard, context, _event, state) {\n  var guards = machine.options.guards;\n  var guardMeta = {\n    state: state,\n    cond: guard,\n    _event: _event\n  }; // TODO: do not hardcode!\n\n  if (guard.type === DEFAULT_GUARD_TYPE) {\n    return guard.predicate(context, _event.data, guardMeta);\n  }\n\n  var condFn = guards[guard.type];\n\n  if (!condFn) {\n    throw new Error(\"Guard '\" + guard.type + \"' is not implemented on machine '\" + machine.id + \"'.\");\n  }\n\n  return condFn(context, _event.data, guardMeta);\n}\n\nfunction toInvokeSource(src) {\n  if (typeof src === 'string') {\n    return {\n      type: src\n    };\n  }\n\n  return src;\n}\n\nexport { evaluateGuard, flatten, getEventType, isArray, isBuiltInEvent, isFunction, isMachine, isObservable, isPromiseLike, isStateLike, isString, keys, mapContext, mapFilterValues, mapValues, matchesState, nestedPath, normalizeTarget, partition, path, pathToStateValue, reportUnhandledExceptionOnInvocation, symbolObservable, toArray, toArrayStrict, toEventObject, toGuard, toInvokeSource, toSCXMLEvent, toStatePath, toStatePaths, toStateValue, toTransitionConfigArray, uniqueId, updateContext, updateHistoryStates, updateHistoryValue, warn };","var ActionTypes;\n\n(function (ActionTypes) {\n  ActionTypes[\"Start\"] = \"xstate.start\";\n  ActionTypes[\"Stop\"] = \"xstate.stop\";\n  ActionTypes[\"Raise\"] = \"xstate.raise\";\n  ActionTypes[\"Send\"] = \"xstate.send\";\n  ActionTypes[\"Cancel\"] = \"xstate.cancel\";\n  ActionTypes[\"NullEvent\"] = \"\";\n  ActionTypes[\"Assign\"] = \"xstate.assign\";\n  ActionTypes[\"After\"] = \"xstate.after\";\n  ActionTypes[\"DoneState\"] = \"done.state\";\n  ActionTypes[\"DoneInvoke\"] = \"done.invoke\";\n  ActionTypes[\"Log\"] = \"xstate.log\";\n  ActionTypes[\"Init\"] = \"xstate.init\";\n  ActionTypes[\"Invoke\"] = \"xstate.invoke\";\n  ActionTypes[\"ErrorExecution\"] = \"error.execution\";\n  ActionTypes[\"ErrorCommunication\"] = \"error.communication\";\n  ActionTypes[\"ErrorPlatform\"] = \"error.platform\";\n  ActionTypes[\"ErrorCustom\"] = \"xstate.error\";\n  ActionTypes[\"Update\"] = \"xstate.update\";\n  ActionTypes[\"Pure\"] = \"xstate.pure\";\n  ActionTypes[\"Choose\"] = \"xstate.choose\";\n})(ActionTypes || (ActionTypes = {}));\n\nvar SpecialTargets;\n\n(function (SpecialTargets) {\n  SpecialTargets[\"Parent\"] = \"#_parent\";\n  SpecialTargets[\"Internal\"] = \"#_internal\";\n})(SpecialTargets || (SpecialTargets = {}));\n\nexport { ActionTypes, SpecialTargets };","import { ActionTypes } from './types.js'; // xstate-specific action types\n\nvar start = ActionTypes.Start;\nvar stop = ActionTypes.Stop;\nvar raise = ActionTypes.Raise;\nvar send = ActionTypes.Send;\nvar cancel = ActionTypes.Cancel;\nvar nullEvent = ActionTypes.NullEvent;\nvar assign = ActionTypes.Assign;\nvar after = ActionTypes.After;\nvar doneState = ActionTypes.DoneState;\nvar log = ActionTypes.Log;\nvar init = ActionTypes.Init;\nvar invoke = ActionTypes.Invoke;\nvar errorExecution = ActionTypes.ErrorExecution;\nvar errorPlatform = ActionTypes.ErrorPlatform;\nvar error = ActionTypes.ErrorCustom;\nvar update = ActionTypes.Update;\nvar choose = ActionTypes.Choose;\nvar pure = ActionTypes.Pure;\nexport { after, assign, cancel, choose, doneState, error, errorExecution, errorPlatform, init, invoke, log, nullEvent, pure, raise, send, start, stop, update };","import { __assign, __read } from './_virtual/_tslib.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { toSCXMLEvent, isFunction, toEventObject, getEventType, isString, partition, updateContext, flatten, toArray, toGuard, evaluateGuard, warn, isArray } from './utils.js';\nimport { SpecialTargets, ActionTypes } from './types.js';\nimport { send as send$1, update, assign as assign$1, init, raise as raise$1, log as log$1, cancel as cancel$1, error as error$1, pure as pure$1, choose as choose$1 } from './actionTypes.js';\nvar initEvent = /*#__PURE__*/toSCXMLEvent({\n  type: init\n});\n\nfunction getActionFunction(actionType, actionFunctionMap) {\n  return actionFunctionMap ? actionFunctionMap[actionType] || undefined : undefined;\n}\n\nfunction toActionObject(action, actionFunctionMap) {\n  var actionObject;\n\n  if (isString(action) || typeof action === 'number') {\n    var exec = getActionFunction(action, actionFunctionMap);\n\n    if (isFunction(exec)) {\n      actionObject = {\n        type: action,\n        exec: exec\n      };\n    } else if (exec) {\n      actionObject = exec;\n    } else {\n      actionObject = {\n        type: action,\n        exec: undefined\n      };\n    }\n  } else if (isFunction(action)) {\n    actionObject = {\n      // Convert action to string if unnamed\n      type: action.name || action.toString(),\n      exec: action\n    };\n  } else {\n    var exec = getActionFunction(action.type, actionFunctionMap);\n\n    if (isFunction(exec)) {\n      actionObject = __assign(__assign({}, action), {\n        exec: exec\n      });\n    } else if (exec) {\n      var actionType = exec.type || action.type;\n      actionObject = __assign(__assign(__assign({}, exec), action), {\n        type: actionType\n      });\n    } else {\n      actionObject = action;\n    }\n  }\n\n  Object.defineProperty(actionObject, 'toString', {\n    value: function () {\n      return actionObject.type;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return actionObject;\n}\n\nvar toActionObjects = function (action, actionFunctionMap) {\n  if (!action) {\n    return [];\n  }\n\n  var actions = isArray(action) ? action : [action];\n  return actions.map(function (subAction) {\n    return toActionObject(subAction, actionFunctionMap);\n  });\n};\n\nfunction toActivityDefinition(action) {\n  var actionObject = toActionObject(action);\n  return __assign(__assign({\n    id: isString(action) ? action : actionObject.id\n  }, actionObject), {\n    type: actionObject.type\n  });\n}\n/**\r\n * Raises an event. This places the event in the internal event queue, so that\r\n * the event is immediately consumed by the machine in the current step.\r\n *\r\n * @param eventType The event to raise.\r\n */\n\n\nfunction raise(event) {\n  if (!isString(event)) {\n    return send(event, {\n      to: SpecialTargets.Internal\n    });\n  }\n\n  return {\n    type: raise$1,\n    event: event\n  };\n}\n\nfunction resolveRaise(action) {\n  return {\n    type: raise$1,\n    _event: toSCXMLEvent(action.event)\n  };\n}\n/**\r\n * Sends an event. This returns an action that will be read by an interpreter to\r\n * send the event in the next step, after the current step is finished executing.\r\n *\r\n * @param event The event to send.\r\n * @param options Options to pass into the send event:\r\n *  - `id` - The unique send event identifier (used with `cancel()`).\r\n *  - `delay` - The number of milliseconds to delay the sending of the event.\r\n *  - `to` - The target of this event (by default, the machine the event was sent from).\r\n */\n\n\nfunction send(event, options) {\n  return {\n    to: options ? options.to : undefined,\n    type: send$1,\n    event: isFunction(event) ? event : toEventObject(event),\n    delay: options ? options.delay : undefined,\n    id: options && options.id !== undefined ? options.id : isFunction(event) ? event.name : getEventType(event)\n  };\n}\n\nfunction resolveSend(action, ctx, _event, delaysMap) {\n  var meta = {\n    _event: _event\n  }; // TODO: helper function for resolving Expr\n\n  var resolvedEvent = toSCXMLEvent(isFunction(action.event) ? action.event(ctx, _event.data, meta) : action.event);\n  var resolvedDelay;\n\n  if (isString(action.delay)) {\n    var configDelay = delaysMap && delaysMap[action.delay];\n    resolvedDelay = isFunction(configDelay) ? configDelay(ctx, _event.data, meta) : configDelay;\n  } else {\n    resolvedDelay = isFunction(action.delay) ? action.delay(ctx, _event.data, meta) : action.delay;\n  }\n\n  var resolvedTarget = isFunction(action.to) ? action.to(ctx, _event.data, meta) : action.to;\n  return __assign(__assign({}, action), {\n    to: resolvedTarget,\n    _event: resolvedEvent,\n    event: resolvedEvent.data,\n    delay: resolvedDelay\n  });\n}\n/**\r\n * Sends an event to this machine's parent.\r\n *\r\n * @param event The event to send to the parent machine.\r\n * @param options Options to pass into the send event.\r\n */\n\n\nfunction sendParent(event, options) {\n  return send(event, __assign(__assign({}, options), {\n    to: SpecialTargets.Parent\n  }));\n}\n/**\r\n * Sends an update event to this machine's parent.\r\n */\n\n\nfunction sendUpdate() {\n  return sendParent(update);\n}\n/**\r\n * Sends an event back to the sender of the original event.\r\n *\r\n * @param event The event to send back to the sender\r\n * @param options Options to pass into the send event\r\n */\n\n\nfunction respond(event, options) {\n  return send(event, __assign(__assign({}, options), {\n    to: function (_, __, _a) {\n      var _event = _a._event;\n      return _event.origin; // TODO: handle when _event.origin is undefined\n    }\n  }));\n}\n\nvar defaultLogExpr = function (context, event) {\n  return {\n    context: context,\n    event: event\n  };\n};\n/**\r\n *\r\n * @param expr The expression function to evaluate which will be logged.\r\n *  Takes in 2 arguments:\r\n *  - `ctx` - the current state context\r\n *  - `event` - the event that caused this action to be executed.\r\n * @param label The label to give to the logged expression.\r\n */\n\n\nfunction log(expr, label) {\n  if (expr === void 0) {\n    expr = defaultLogExpr;\n  }\n\n  return {\n    type: log$1,\n    label: label,\n    expr: expr\n  };\n}\n\nvar resolveLog = function (action, ctx, _event) {\n  return __assign(__assign({}, action), {\n    value: isString(action.expr) ? action.expr : action.expr(ctx, _event.data, {\n      _event: _event\n    })\n  });\n};\n/**\r\n * Cancels an in-flight `send(...)` action. A canceled sent action will not\r\n * be executed, nor will its event be sent, unless it has already been sent\r\n * (e.g., if `cancel(...)` is called after the `send(...)` action's `delay`).\r\n *\r\n * @param sendId The `id` of the `send(...)` action to cancel.\r\n */\n\n\nvar cancel = function (sendId) {\n  return {\n    type: cancel$1,\n    sendId: sendId\n  };\n};\n/**\r\n * Starts an activity.\r\n *\r\n * @param activity The activity to start.\r\n */\n\n\nfunction start(activity) {\n  var activityDef = toActivityDefinition(activity);\n  return {\n    type: ActionTypes.Start,\n    activity: activityDef,\n    exec: undefined\n  };\n}\n/**\r\n * Stops an activity.\r\n *\r\n * @param activity The activity to stop.\r\n */\n\n\nfunction stop(activity) {\n  var activityDef = toActivityDefinition(activity);\n  return {\n    type: ActionTypes.Stop,\n    activity: activityDef,\n    exec: undefined\n  };\n}\n/**\r\n * Updates the current context of the machine.\r\n *\r\n * @param assignment An object that represents the partial context to update.\r\n */\n\n\nvar assign = function (assignment) {\n  return {\n    type: assign$1,\n    assignment: assignment\n  };\n};\n/**\r\n * Returns an event type that represents an implicit event that\r\n * is sent after the specified `delay`.\r\n *\r\n * @param delayRef The delay in milliseconds\r\n * @param id The state node ID where this event is handled\r\n */\n\n\nfunction after(delayRef, id) {\n  var idSuffix = id ? \"#\" + id : '';\n  return ActionTypes.After + \"(\" + delayRef + \")\" + idSuffix;\n}\n/**\r\n * Returns an event that represents that a final state node\r\n * has been reached in the parent state node.\r\n *\r\n * @param id The final state node's parent state node `id`\r\n * @param data The data to pass into the event\r\n */\n\n\nfunction done(id, data) {\n  var type = ActionTypes.DoneState + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n/**\r\n * Returns an event that represents that an invoked service has terminated.\r\n *\r\n * An invoked service is terminated when it has reached a top-level final state node,\r\n * but not when it is canceled.\r\n *\r\n * @param id The final state node ID\r\n * @param data The data to pass into the event\r\n */\n\n\nfunction doneInvoke(id, data) {\n  var type = ActionTypes.DoneInvoke + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n\nfunction error(id, data) {\n  var type = ActionTypes.ErrorPlatform + \".\" + id;\n  var eventObject = {\n    type: type,\n    data: data\n  };\n\n  eventObject.toString = function () {\n    return type;\n  };\n\n  return eventObject;\n}\n\nfunction pure(getActions) {\n  return {\n    type: ActionTypes.Pure,\n    get: getActions\n  };\n}\n/**\r\n * Forwards (sends) an event to a specified service.\r\n *\r\n * @param target The target service to forward the event to.\r\n * @param options Options to pass into the send action creator.\r\n */\n\n\nfunction forwardTo(target, options) {\n  return send(function (_, event) {\n    return event;\n  }, __assign(__assign({}, options), {\n    to: target\n  }));\n}\n/**\r\n * Escalates an error by sending it as an event to this machine's parent.\r\n *\r\n * @param errorData The error data to send, or the expression function that\r\n * takes in the `context`, `event`, and `meta`, and returns the error data to send.\r\n * @param options Options to pass into the send action creator.\r\n */\n\n\nfunction escalate(errorData, options) {\n  return sendParent(function (context, event, meta) {\n    return {\n      type: error$1,\n      data: isFunction(errorData) ? errorData(context, event, meta) : errorData\n    };\n  }, __assign(__assign({}, options), {\n    to: SpecialTargets.Parent\n  }));\n}\n\nfunction choose(conds) {\n  return {\n    type: ActionTypes.Choose,\n    conds: conds\n  };\n}\n\nfunction resolveActions(machine, currentState, currentContext, _event, actions) {\n  var _a = __read(partition(actions, function (action) {\n    return action.type === assign$1;\n  }), 2),\n      assignActions = _a[0],\n      otherActions = _a[1];\n\n  var updatedContext = assignActions.length ? updateContext(currentContext, _event, assignActions, currentState) : currentContext;\n  var resolvedActions = flatten(otherActions.map(function (actionObject) {\n    var _a;\n\n    switch (actionObject.type) {\n      case raise$1:\n        return resolveRaise(actionObject);\n\n      case send$1:\n        var sendAction = resolveSend(actionObject, updatedContext, _event, machine.options.delays); // TODO: fix ActionTypes.Init\n\n        if (!IS_PRODUCTION) {\n          // warn after resolving as we can create better contextual message here\n          warn(!isString(actionObject.delay) || typeof sendAction.delay === 'number', // tslint:disable-next-line:max-line-length\n          \"No delay reference for delay expression '\" + actionObject.delay + \"' was found on machine '\" + machine.id + \"'\");\n        }\n\n        return sendAction;\n\n      case log$1:\n        return resolveLog(actionObject, updatedContext, _event);\n\n      case choose$1:\n        {\n          var chooseAction = actionObject;\n          var matchedActions = (_a = chooseAction.conds.find(function (condition) {\n            var guard = toGuard(condition.cond, machine.options.guards);\n            return !guard || evaluateGuard(machine, guard, updatedContext, _event, currentState);\n          })) === null || _a === void 0 ? void 0 : _a.actions;\n\n          if (!matchedActions) {\n            return [];\n          }\n\n          var resolved = resolveActions(machine, currentState, updatedContext, _event, toActionObjects(toArray(matchedActions), machine.options.actions));\n          updatedContext = resolved[1];\n          return resolved[0];\n        }\n\n      case pure$1:\n        {\n          var matchedActions = actionObject.get(updatedContext, _event.data);\n\n          if (!matchedActions) {\n            return [];\n          }\n\n          var resolved = resolveActions(machine, currentState, updatedContext, _event, toActionObjects(toArray(matchedActions), machine.options.actions));\n          updatedContext = resolved[1];\n          return resolved[0];\n        }\n\n      default:\n        return toActionObject(actionObject, machine.options.actions);\n    }\n  }));\n  return [resolvedActions, updatedContext];\n}\n\nexport { after, assign, cancel, choose, done, doneInvoke, error, escalate, forwardTo, getActionFunction, initEvent, log, pure, raise, resolveActions, resolveLog, resolveRaise, resolveSend, respond, send, sendParent, sendUpdate, start, stop, toActionObject, toActionObjects, toActivityDefinition };","import { __values, __spread } from './_virtual/_tslib.js';\nimport { keys, flatten } from './utils.js';\n\nvar isLeafNode = function (stateNode) {\n  return stateNode.type === 'atomic' || stateNode.type === 'final';\n};\n\nfunction getChildren(stateNode) {\n  return keys(stateNode.states).map(function (key) {\n    return stateNode.states[key];\n  });\n}\n\nfunction getAllStateNodes(stateNode) {\n  var stateNodes = [stateNode];\n\n  if (isLeafNode(stateNode)) {\n    return stateNodes;\n  }\n\n  return stateNodes.concat(flatten(getChildren(stateNode).map(getAllStateNodes)));\n}\n\nfunction getConfiguration(prevStateNodes, stateNodes) {\n  var e_1, _a, e_2, _b, e_3, _c, e_4, _d;\n\n  var prevConfiguration = new Set(prevStateNodes);\n  var prevAdjList = getAdjList(prevConfiguration);\n  var configuration = new Set(stateNodes);\n\n  try {\n    // add all ancestors\n    for (var configuration_1 = __values(configuration), configuration_1_1 = configuration_1.next(); !configuration_1_1.done; configuration_1_1 = configuration_1.next()) {\n      var s = configuration_1_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configuration_1_1 && !configuration_1_1.done && (_a = configuration_1.return)) _a.call(configuration_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  var adjList = getAdjList(configuration);\n\n  try {\n    // add descendants\n    for (var configuration_2 = __values(configuration), configuration_2_1 = configuration_2.next(); !configuration_2_1.done; configuration_2_1 = configuration_2.next()) {\n      var s = configuration_2_1.value; // if previously active, add existing child nodes\n\n      if (s.type === 'compound' && (!adjList.get(s) || !adjList.get(s).length)) {\n        if (prevAdjList.get(s)) {\n          prevAdjList.get(s).forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        } else {\n          s.initialStateNodes.forEach(function (sn) {\n            return configuration.add(sn);\n          });\n        }\n      } else {\n        if (s.type === 'parallel') {\n          try {\n            for (var _e = (e_3 = void 0, __values(getChildren(s))), _f = _e.next(); !_f.done; _f = _e.next()) {\n              var child = _f.value;\n\n              if (child.type === 'history') {\n                continue;\n              }\n\n              if (!configuration.has(child)) {\n                configuration.add(child);\n\n                if (prevAdjList.get(child)) {\n                  prevAdjList.get(child).forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                } else {\n                  child.initialStateNodes.forEach(function (sn) {\n                    return configuration.add(sn);\n                  });\n                }\n              }\n            }\n          } catch (e_3_1) {\n            e_3 = {\n              error: e_3_1\n            };\n          } finally {\n            try {\n              if (_f && !_f.done && (_c = _e.return)) _c.call(_e);\n            } finally {\n              if (e_3) throw e_3.error;\n            }\n          }\n        }\n      }\n    }\n  } catch (e_2_1) {\n    e_2 = {\n      error: e_2_1\n    };\n  } finally {\n    try {\n      if (configuration_2_1 && !configuration_2_1.done && (_b = configuration_2.return)) _b.call(configuration_2);\n    } finally {\n      if (e_2) throw e_2.error;\n    }\n  }\n\n  try {\n    // add all ancestors\n    for (var configuration_3 = __values(configuration), configuration_3_1 = configuration_3.next(); !configuration_3_1.done; configuration_3_1 = configuration_3.next()) {\n      var s = configuration_3_1.value;\n      var m = s.parent;\n\n      while (m && !configuration.has(m)) {\n        configuration.add(m);\n        m = m.parent;\n      }\n    }\n  } catch (e_4_1) {\n    e_4 = {\n      error: e_4_1\n    };\n  } finally {\n    try {\n      if (configuration_3_1 && !configuration_3_1.done && (_d = configuration_3.return)) _d.call(configuration_3);\n    } finally {\n      if (e_4) throw e_4.error;\n    }\n  }\n\n  return configuration;\n}\n\nfunction getValueFromAdj(baseNode, adjList) {\n  var childStateNodes = adjList.get(baseNode);\n\n  if (!childStateNodes) {\n    return {}; // todo: fix?\n  }\n\n  if (baseNode.type === 'compound') {\n    var childStateNode = childStateNodes[0];\n\n    if (childStateNode) {\n      if (isLeafNode(childStateNode)) {\n        return childStateNode.key;\n      }\n    } else {\n      return {};\n    }\n  }\n\n  var stateValue = {};\n  childStateNodes.forEach(function (csn) {\n    stateValue[csn.key] = getValueFromAdj(csn, adjList);\n  });\n  return stateValue;\n}\n\nfunction getAdjList(configuration) {\n  var e_5, _a;\n\n  var adjList = new Map();\n\n  try {\n    for (var configuration_4 = __values(configuration), configuration_4_1 = configuration_4.next(); !configuration_4_1.done; configuration_4_1 = configuration_4.next()) {\n      var s = configuration_4_1.value;\n\n      if (!adjList.has(s)) {\n        adjList.set(s, []);\n      }\n\n      if (s.parent) {\n        if (!adjList.has(s.parent)) {\n          adjList.set(s.parent, []);\n        }\n\n        adjList.get(s.parent).push(s);\n      }\n    }\n  } catch (e_5_1) {\n    e_5 = {\n      error: e_5_1\n    };\n  } finally {\n    try {\n      if (configuration_4_1 && !configuration_4_1.done && (_a = configuration_4.return)) _a.call(configuration_4);\n    } finally {\n      if (e_5) throw e_5.error;\n    }\n  }\n\n  return adjList;\n}\n\nfunction getValue(rootNode, configuration) {\n  var config = getConfiguration([rootNode], configuration);\n  return getValueFromAdj(rootNode, getAdjList(config));\n}\n\nfunction has(iterable, item) {\n  if (Array.isArray(iterable)) {\n    return iterable.some(function (member) {\n      return member === item;\n    });\n  }\n\n  if (iterable instanceof Set) {\n    return iterable.has(item);\n  }\n\n  return false; // TODO: fix\n}\n\nfunction nextEvents(configuration) {\n  return flatten(__spread(new Set(configuration.map(function (sn) {\n    return sn.ownEvents;\n  }))));\n}\n\nfunction isInFinalState(configuration, stateNode) {\n  if (stateNode.type === 'compound') {\n    return getChildren(stateNode).some(function (s) {\n      return s.type === 'final' && has(configuration, s);\n    });\n  }\n\n  if (stateNode.type === 'parallel') {\n    return getChildren(stateNode).every(function (sn) {\n      return isInFinalState(configuration, sn);\n    });\n  }\n\n  return false;\n}\n\nexport { getAdjList, getAllStateNodes, getChildren, getConfiguration, getValue, has, isInFinalState, isLeafNode, nextEvents };","import { __spread, __rest, __assign } from './_virtual/_tslib.js';\nimport { EMPTY_ACTIVITY_MAP } from './constants.js';\nimport { isString, matchesState, keys } from './utils.js';\nimport { nextEvents } from './stateUtils.js';\nimport { initEvent } from './actions.js';\n\nfunction stateValuesEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a === undefined || b === undefined) {\n    return false;\n  }\n\n  if (isString(a) || isString(b)) {\n    return a === b;\n  }\n\n  var aKeys = keys(a);\n  var bKeys = keys(b);\n  return aKeys.length === bKeys.length && aKeys.every(function (key) {\n    return stateValuesEqual(a[key], b[key]);\n  });\n}\n\nfunction isState(state) {\n  if (isString(state)) {\n    return false;\n  }\n\n  return 'value' in state && 'history' in state;\n}\n\nfunction bindActionToState(action, state) {\n  var exec = action.exec;\n\n  var boundAction = __assign(__assign({}, action), {\n    exec: exec !== undefined ? function () {\n      return exec(state.context, state.event, {\n        action: action,\n        state: state,\n        _event: state._event\n      });\n    } : undefined\n  });\n\n  return boundAction;\n}\n\nvar State =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  /**\r\n   * Creates a new State instance.\r\n   * @param value The state value\r\n   * @param context The extended state\r\n   * @param historyValue The tree representing historical values of the state nodes\r\n   * @param history The previous state\r\n   * @param actions An array of action objects to execute as side-effects\r\n   * @param activities A mapping of activities and whether they are started (`true`) or stopped (`false`).\r\n   * @param meta\r\n   * @param events Internal event queue. Should be empty with run-to-completion semantics.\r\n   * @param configuration\r\n   */\n  function State(config) {\n    var _this = this;\n\n    this.actions = [];\n    this.activities = EMPTY_ACTIVITY_MAP;\n    this.meta = {};\n    this.events = [];\n    this.value = config.value;\n    this.context = config.context;\n    this._event = config._event;\n    this._sessionid = config._sessionid;\n    this.event = this._event.data;\n    this.historyValue = config.historyValue;\n    this.history = config.history;\n    this.actions = config.actions || [];\n    this.activities = config.activities || EMPTY_ACTIVITY_MAP;\n    this.meta = config.meta || {};\n    this.events = config.events || [];\n    this.matches = this.matches.bind(this);\n    this.toStrings = this.toStrings.bind(this);\n    this.configuration = config.configuration;\n    this.transitions = config.transitions;\n    this.children = config.children;\n    this.done = !!config.done;\n    Object.defineProperty(this, 'nextEvents', {\n      get: function () {\n        return nextEvents(_this.configuration);\n      }\n    });\n  }\n  /**\r\n   * Creates a new State instance for the given `stateValue` and `context`.\r\n   * @param stateValue\r\n   * @param context\r\n   */\n\n\n  State.from = function (stateValue, context) {\n    if (stateValue instanceof State) {\n      if (stateValue.context !== context) {\n        return new State({\n          value: stateValue.value,\n          context: context,\n          _event: stateValue._event,\n          _sessionid: null,\n          historyValue: stateValue.historyValue,\n          history: stateValue.history,\n          actions: [],\n          activities: stateValue.activities,\n          meta: {},\n          events: [],\n          configuration: [],\n          transitions: [],\n          children: {}\n        });\n      }\n\n      return stateValue;\n    }\n\n    var _event = initEvent;\n    return new State({\n      value: stateValue,\n      context: context,\n      _event: _event,\n      _sessionid: null,\n      historyValue: undefined,\n      history: undefined,\n      actions: [],\n      activities: undefined,\n      meta: undefined,\n      events: [],\n      configuration: [],\n      transitions: [],\n      children: {}\n    });\n  };\n  /**\r\n   * Creates a new State instance for the given `config`.\r\n   * @param config The state config\r\n   */\n\n\n  State.create = function (config) {\n    return new State(config);\n  };\n  /**\r\n   * Creates a new `State` instance for the given `stateValue` and `context` with no actions (side-effects).\r\n   * @param stateValue\r\n   * @param context\r\n   */\n\n\n  State.inert = function (stateValue, context) {\n    if (stateValue instanceof State) {\n      if (!stateValue.actions.length) {\n        return stateValue;\n      }\n\n      var _event = initEvent;\n      return new State({\n        value: stateValue.value,\n        context: context,\n        _event: _event,\n        _sessionid: null,\n        historyValue: stateValue.historyValue,\n        history: stateValue.history,\n        activities: stateValue.activities,\n        configuration: stateValue.configuration,\n        transitions: [],\n        children: {}\n      });\n    }\n\n    return State.from(stateValue, context);\n  };\n  /**\r\n   * Returns an array of all the string leaf state node paths.\r\n   * @param stateValue\r\n   * @param delimiter The character(s) that separate each subpath in the string state node path.\r\n   */\n\n\n  State.prototype.toStrings = function (stateValue, delimiter) {\n    var _this = this;\n\n    if (stateValue === void 0) {\n      stateValue = this.value;\n    }\n\n    if (delimiter === void 0) {\n      delimiter = '.';\n    }\n\n    if (isString(stateValue)) {\n      return [stateValue];\n    }\n\n    var valueKeys = keys(stateValue);\n    return valueKeys.concat.apply(valueKeys, __spread(valueKeys.map(function (key) {\n      return _this.toStrings(stateValue[key], delimiter).map(function (s) {\n        return key + delimiter + s;\n      });\n    })));\n  };\n\n  State.prototype.toJSON = function () {\n    var _a = this,\n        configuration = _a.configuration,\n        transitions = _a.transitions,\n        jsonValues = __rest(_a, [\"configuration\", \"transitions\"]);\n\n    return jsonValues;\n  };\n  /**\r\n   * Whether the current state value is a subset of the given parent state value.\r\n   * @param parentStateValue\r\n   */\n\n\n  State.prototype.matches = function (parentStateValue) {\n    return matchesState(parentStateValue, this.value);\n  };\n\n  return State;\n}();\n\nexport { State, bindActionToState, isState, stateValuesEqual };","import { toInvokeSource, mapContext, isMachine } from './utils.js';\n\nfunction createNullActor(id) {\n  return {\n    id: id,\n    send: function () {\n      return void 0;\n    },\n    subscribe: function () {\n      return {\n        unsubscribe: function () {\n          return void 0;\n        }\n      };\n    },\n    toJSON: function () {\n      return {\n        id: id\n      };\n    }\n  };\n}\n/**\r\n * Creates a deferred actor that is able to be invoked given the provided\r\n * invocation information in its `.meta` value.\r\n *\r\n * @param invokeDefinition The meta information needed to invoke the actor.\r\n */\n\n\nfunction createInvocableActor(invokeDefinition, machine, context, _event) {\n  var _a;\n\n  var invokeSrc = toInvokeSource(invokeDefinition.src);\n  var serviceCreator = (_a = machine === null || machine === void 0 ? void 0 : machine.options.services) === null || _a === void 0 ? void 0 : _a[invokeSrc.type];\n  var resolvedData = invokeDefinition.data ? mapContext(invokeDefinition.data, context, _event) : undefined;\n  var tempActor = serviceCreator ? createDeferredActor(serviceCreator, invokeDefinition.id, resolvedData) : createNullActor(invokeDefinition.id);\n  tempActor.meta = invokeDefinition;\n  return tempActor;\n}\n\nfunction createDeferredActor(entity, id, data) {\n  var tempActor = createNullActor(id);\n  tempActor.deferred = true;\n\n  if (isMachine(entity)) {\n    tempActor.state = (data ? entity.withContext(data) : entity).initialState;\n  }\n\n  return tempActor;\n}\n\nfunction isActor(item) {\n  try {\n    return typeof item.send === 'function';\n  } catch (e) {\n    return false;\n  }\n}\n\nexport { createDeferredActor, createInvocableActor, createNullActor, isActor };","import { __assign, __rest } from './_virtual/_tslib.js';\nimport { invoke } from './actionTypes.js';\nimport './actions.js';\n\nfunction toInvokeSource(src) {\n  if (typeof src === 'string') {\n    var simpleSrc = {\n      type: src\n    };\n\n    simpleSrc.toString = function () {\n      return src;\n    }; // v4 compat - TODO: remove in v5\n\n\n    return simpleSrc;\n  }\n\n  return src;\n}\n\nfunction toInvokeDefinition(invokeConfig) {\n  return __assign(__assign({\n    type: invoke\n  }, invokeConfig), {\n    toJSON: function () {\n      var onDone = invokeConfig.onDone,\n          onError = invokeConfig.onError,\n          invokeDef = __rest(invokeConfig, [\"onDone\", \"onError\"]);\n\n      return __assign(__assign({}, invokeDef), {\n        type: invoke,\n        src: toInvokeSource(invokeConfig.src)\n      });\n    }\n  });\n}\n\nexport { toInvokeDefinition, toInvokeSource };","import { __assign, __values, __spread, __read, __rest } from './_virtual/_tslib.js';\nimport { STATE_DELIMITER } from './constants.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { mapValues, isArray, flatten, keys, toArray, toStateValue, isString, getEventType, matchesState, path, evaluateGuard, mapContext, toSCXMLEvent, pathToStateValue, isBuiltInEvent, partition, updateHistoryValue, toStatePath, mapFilterValues, warn, toStatePaths, nestedPath, normalizeTarget, toGuard, toTransitionConfigArray, isMachine, isFunction } from './utils.js';\nimport { SpecialTargets } from './types.js';\nimport { getAllStateNodes, getConfiguration, has, getChildren, isInFinalState, getValue, isLeafNode } from './stateUtils.js';\nimport { start as start$1, stop as stop$1, invoke, update, nullEvent, raise as raise$1, send as send$1 } from './actionTypes.js';\nimport { done, start, raise, stop, toActionObjects, resolveActions, doneInvoke, error, toActionObject, toActivityDefinition, after, send, cancel, initEvent } from './actions.js';\nimport { State, stateValuesEqual } from './State.js';\nimport { createInvocableActor } from './Actor.js';\nimport { toInvokeDefinition } from './invokeUtils.js';\nvar NULL_EVENT = '';\nvar STATE_IDENTIFIER = '#';\nvar WILDCARD = '*';\nvar EMPTY_OBJECT = {};\n\nvar isStateId = function (str) {\n  return str[0] === STATE_IDENTIFIER;\n};\n\nvar createDefaultOptions = function () {\n  return {\n    actions: {},\n    guards: {},\n    services: {},\n    activities: {},\n    delays: {}\n  };\n};\n\nvar validateArrayifiedTransitions = function (stateNode, event, transitions) {\n  var hasNonLastUnguardedTarget = transitions.slice(0, -1).some(function (transition) {\n    return !('cond' in transition) && !('in' in transition) && (isString(transition.target) || isMachine(transition.target));\n  });\n  var eventText = event === NULL_EVENT ? 'the transient event' : \"event '\" + event + \"'\";\n  warn(!hasNonLastUnguardedTarget, \"One or more transitions for \" + eventText + \" on state '\" + stateNode.id + \"' are unreachable. \" + \"Make sure that the default transition is the last one defined.\");\n};\n\nvar StateNode =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  function StateNode(\n  /**\r\n   * The raw config used to create the machine.\r\n   */\n  config, options,\n  /**\r\n   * The initial extended state\r\n   */\n  context) {\n    var _this = this;\n\n    this.config = config;\n    this.context = context;\n    /**\r\n     * The order this state node appears. Corresponds to the implicit SCXML document order.\r\n     */\n\n    this.order = -1;\n    this.__xstatenode = true;\n    this.__cache = {\n      events: undefined,\n      relativeValue: new Map(),\n      initialStateValue: undefined,\n      initialState: undefined,\n      on: undefined,\n      transitions: undefined,\n      candidates: {},\n      delayedTransitions: undefined\n    };\n    this.idMap = {};\n    this.options = Object.assign(createDefaultOptions(), options);\n    this.parent = this.options._parent;\n    this.key = this.config.key || this.options._key || this.config.id || '(machine)';\n    this.machine = this.parent ? this.parent.machine : this;\n    this.path = this.parent ? this.parent.path.concat(this.key) : [];\n    this.delimiter = this.config.delimiter || (this.parent ? this.parent.delimiter : STATE_DELIMITER);\n    this.id = this.config.id || __spread([this.machine.key], this.path).join(this.delimiter);\n    this.version = this.parent ? this.parent.version : this.config.version;\n    this.type = this.config.type || (this.config.parallel ? 'parallel' : this.config.states && keys(this.config.states).length ? 'compound' : this.config.history ? 'history' : 'atomic');\n\n    if (!IS_PRODUCTION) {\n      warn(!('parallel' in this.config), \"The \\\"parallel\\\" property is deprecated and will be removed in version 4.1. \" + (this.config.parallel ? \"Replace with `type: 'parallel'`\" : \"Use `type: '\" + this.type + \"'`\") + \" in the config for state node '\" + this.id + \"' instead.\");\n    }\n\n    this.initial = this.config.initial;\n    this.states = this.config.states ? mapValues(this.config.states, function (stateConfig, key) {\n      var _a;\n\n      var stateNode = new StateNode(stateConfig, {\n        _parent: _this,\n        _key: key\n      });\n      Object.assign(_this.idMap, __assign((_a = {}, _a[stateNode.id] = stateNode, _a), stateNode.idMap));\n      return stateNode;\n    }) : EMPTY_OBJECT; // Document order\n\n    var order = 0;\n\n    function dfs(stateNode) {\n      var e_1, _a;\n\n      stateNode.order = order++;\n\n      try {\n        for (var _b = __values(getChildren(stateNode)), _c = _b.next(); !_c.done; _c = _b.next()) {\n          var child = _c.value;\n          dfs(child);\n        }\n      } catch (e_1_1) {\n        e_1 = {\n          error: e_1_1\n        };\n      } finally {\n        try {\n          if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        } finally {\n          if (e_1) throw e_1.error;\n        }\n      }\n    }\n\n    dfs(this); // History config\n\n    this.history = this.config.history === true ? 'shallow' : this.config.history || false;\n    this._transient = !!this.config.always || (!this.config.on ? false : Array.isArray(this.config.on) ? this.config.on.some(function (_a) {\n      var event = _a.event;\n      return event === NULL_EVENT;\n    }) : NULL_EVENT in this.config.on);\n    this.strict = !!this.config.strict; // TODO: deprecate (entry)\n\n    this.onEntry = toArray(this.config.entry || this.config.onEntry).map(function (action) {\n      return toActionObject(action);\n    }); // TODO: deprecate (exit)\n\n    this.onExit = toArray(this.config.exit || this.config.onExit).map(function (action) {\n      return toActionObject(action);\n    });\n    this.meta = this.config.meta;\n    this.doneData = this.type === 'final' ? this.config.data : undefined;\n    this.invoke = toArray(this.config.invoke).map(function (invokeConfig, i) {\n      var _a, _b;\n\n      if (isMachine(invokeConfig)) {\n        _this.machine.options.services = __assign((_a = {}, _a[invokeConfig.id] = invokeConfig, _a), _this.machine.options.services);\n        return toInvokeDefinition({\n          src: invokeConfig.id,\n          id: invokeConfig.id\n        });\n      } else if (isString(invokeConfig.src)) {\n        return toInvokeDefinition(__assign(__assign({}, invokeConfig), {\n          id: invokeConfig.id || invokeConfig.src,\n          src: invokeConfig.src\n        }));\n      } else if (isMachine(invokeConfig.src) || isFunction(invokeConfig.src)) {\n        var invokeSrc = _this.id + \":invocation[\" + i + \"]\"; // TODO: util function\n\n        _this.machine.options.services = __assign((_b = {}, _b[invokeSrc] = invokeConfig.src, _b), _this.machine.options.services);\n        return toInvokeDefinition(__assign(__assign({\n          id: invokeSrc\n        }, invokeConfig), {\n          src: invokeSrc\n        }));\n      } else {\n        var invokeSource = invokeConfig.src;\n        return toInvokeDefinition(__assign(__assign({\n          id: invokeSource.type\n        }, invokeConfig), {\n          src: invokeSource\n        }));\n      }\n    });\n    this.activities = toArray(this.config.activities).concat(this.invoke).map(function (activity) {\n      return toActivityDefinition(activity);\n    });\n    this.transition = this.transition.bind(this); // TODO: this is the real fix for initialization once\n    // state node getters are deprecated\n    // if (!this.parent) {\n    //   this._init();\n    // }\n  }\n\n  StateNode.prototype._init = function () {\n    if (this.__cache.transitions) {\n      return;\n    }\n\n    getAllStateNodes(this).forEach(function (stateNode) {\n      return stateNode.on;\n    });\n  };\n  /**\r\n   * Clones this state machine with custom options and context.\r\n   *\r\n   * @param options Options (actions, guards, activities, services) to recursively merge with the existing options.\r\n   * @param context Custom context (will override predefined context)\r\n   */\n\n\n  StateNode.prototype.withConfig = function (options, context) {\n    if (context === void 0) {\n      context = this.context;\n    }\n\n    var _a = this.options,\n        actions = _a.actions,\n        activities = _a.activities,\n        guards = _a.guards,\n        services = _a.services,\n        delays = _a.delays;\n    return new StateNode(this.config, {\n      actions: __assign(__assign({}, actions), options.actions),\n      activities: __assign(__assign({}, activities), options.activities),\n      guards: __assign(__assign({}, guards), options.guards),\n      services: __assign(__assign({}, services), options.services),\n      delays: __assign(__assign({}, delays), options.delays)\n    }, context);\n  };\n  /**\r\n   * Clones this state machine with custom context.\r\n   *\r\n   * @param context Custom context (will override predefined context, not recursive)\r\n   */\n\n\n  StateNode.prototype.withContext = function (context) {\n    return new StateNode(this.config, this.options, context);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"definition\", {\n    /**\r\n     * The well-structured state node definition.\r\n     */\n    get: function () {\n      return {\n        id: this.id,\n        key: this.key,\n        version: this.version,\n        context: this.context,\n        type: this.type,\n        initial: this.initial,\n        history: this.history,\n        states: mapValues(this.states, function (state) {\n          return state.definition;\n        }),\n        on: this.on,\n        transitions: this.transitions,\n        entry: this.onEntry,\n        exit: this.onExit,\n        activities: this.activities || [],\n        meta: this.meta,\n        order: this.order || -1,\n        data: this.doneData,\n        invoke: this.invoke\n      };\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.toJSON = function () {\n    return this.definition;\n  };\n\n  Object.defineProperty(StateNode.prototype, \"on\", {\n    /**\r\n     * The mapping of events to transitions.\r\n     */\n    get: function () {\n      if (this.__cache.on) {\n        return this.__cache.on;\n      }\n\n      var transitions = this.transitions;\n      return this.__cache.on = transitions.reduce(function (map, transition) {\n        map[transition.eventType] = map[transition.eventType] || [];\n        map[transition.eventType].push(transition);\n        return map;\n      }, {});\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"after\", {\n    get: function () {\n      return this.__cache.delayedTransitions || (this.__cache.delayedTransitions = this.getDelayedTransitions(), this.__cache.delayedTransitions);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"transitions\", {\n    /**\r\n     * All the transitions that can be taken from this state node.\r\n     */\n    get: function () {\n      return this.__cache.transitions || (this.__cache.transitions = this.formatTransitions(), this.__cache.transitions);\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.getCandidates = function (eventName) {\n    if (this.__cache.candidates[eventName]) {\n      return this.__cache.candidates[eventName];\n    }\n\n    var transient = eventName === NULL_EVENT;\n    var candidates = this.transitions.filter(function (transition) {\n      var sameEventType = transition.eventType === eventName; // null events should only match against eventless transitions\n\n      return transient ? sameEventType : sameEventType || transition.eventType === WILDCARD;\n    });\n    this.__cache.candidates[eventName] = candidates;\n    return candidates;\n  };\n  /**\r\n   * All delayed transitions from the config.\r\n   */\n\n\n  StateNode.prototype.getDelayedTransitions = function () {\n    var _this = this;\n\n    var afterConfig = this.config.after;\n\n    if (!afterConfig) {\n      return [];\n    }\n\n    var mutateEntryExit = function (delay, i) {\n      var delayRef = isFunction(delay) ? _this.id + \":delay[\" + i + \"]\" : delay;\n      var eventType = after(delayRef, _this.id);\n\n      _this.onEntry.push(send(eventType, {\n        delay: delay\n      }));\n\n      _this.onExit.push(cancel(eventType));\n\n      return eventType;\n    };\n\n    var delayedTransitions = isArray(afterConfig) ? afterConfig.map(function (transition, i) {\n      var eventType = mutateEntryExit(transition.delay, i);\n      return __assign(__assign({}, transition), {\n        event: eventType\n      });\n    }) : flatten(keys(afterConfig).map(function (delay, i) {\n      var configTransition = afterConfig[delay];\n      var resolvedTransition = isString(configTransition) ? {\n        target: configTransition\n      } : configTransition;\n      var resolvedDelay = !isNaN(+delay) ? +delay : delay;\n      var eventType = mutateEntryExit(resolvedDelay, i);\n      return toArray(resolvedTransition).map(function (transition) {\n        return __assign(__assign({}, transition), {\n          event: eventType,\n          delay: resolvedDelay\n        });\n      });\n    }));\n    return delayedTransitions.map(function (delayedTransition) {\n      var delay = delayedTransition.delay;\n      return __assign(__assign({}, _this.formatTransition(delayedTransition)), {\n        delay: delay\n      });\n    });\n  };\n  /**\r\n   * Returns the state nodes represented by the current state value.\r\n   *\r\n   * @param state The state value or State instance\r\n   */\n\n\n  StateNode.prototype.getStateNodes = function (state) {\n    var _a;\n\n    var _this = this;\n\n    if (!state) {\n      return [];\n    }\n\n    var stateValue = state instanceof State ? state.value : toStateValue(state, this.delimiter);\n\n    if (isString(stateValue)) {\n      var initialStateValue = this.getStateNode(stateValue).initial;\n      return initialStateValue !== undefined ? this.getStateNodes((_a = {}, _a[stateValue] = initialStateValue, _a)) : [this.states[stateValue]];\n    }\n\n    var subStateKeys = keys(stateValue);\n    var subStateNodes = subStateKeys.map(function (subStateKey) {\n      return _this.getStateNode(subStateKey);\n    });\n    return subStateNodes.concat(subStateKeys.reduce(function (allSubStateNodes, subStateKey) {\n      var subStateNode = _this.getStateNode(subStateKey).getStateNodes(stateValue[subStateKey]);\n\n      return allSubStateNodes.concat(subStateNode);\n    }, []));\n  };\n  /**\r\n   * Returns `true` if this state node explicitly handles the given event.\r\n   *\r\n   * @param event The event in question\r\n   */\n\n\n  StateNode.prototype.handles = function (event) {\n    var eventType = getEventType(event);\n    return this.events.includes(eventType);\n  };\n  /**\r\n   * Resolves the given `state` to a new `State` instance relative to this machine.\r\n   *\r\n   * This ensures that `.events` and `.nextEvents` represent the correct values.\r\n   *\r\n   * @param state The state to resolve\r\n   */\n\n\n  StateNode.prototype.resolveState = function (state) {\n    var configuration = Array.from(getConfiguration([], this.getStateNodes(state.value)));\n    return new State(__assign(__assign({}, state), {\n      value: this.resolve(state.value),\n      configuration: configuration\n    }));\n  };\n\n  StateNode.prototype.transitionLeafNode = function (stateValue, state, _event) {\n    var stateNode = this.getStateNode(stateValue);\n    var next = stateNode.next(state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionCompoundNode = function (stateValue, state, _event) {\n    var subStateKeys = keys(stateValue);\n    var stateNode = this.getStateNode(subStateKeys[0]);\n\n    var next = stateNode._transition(stateValue[subStateKeys[0]], state, _event);\n\n    if (!next || !next.transitions.length) {\n      return this.next(state, _event);\n    }\n\n    return next;\n  };\n\n  StateNode.prototype.transitionParallelNode = function (stateValue, state, _event) {\n    var e_2, _a;\n\n    var transitionMap = {};\n\n    try {\n      for (var _b = __values(keys(stateValue)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var subStateKey = _c.value;\n        var subStateValue = stateValue[subStateKey];\n\n        if (!subStateValue) {\n          continue;\n        }\n\n        var subStateNode = this.getStateNode(subStateKey);\n\n        var next = subStateNode._transition(subStateValue, state, _event);\n\n        if (next) {\n          transitionMap[subStateKey] = next;\n        }\n      }\n    } catch (e_2_1) {\n      e_2 = {\n        error: e_2_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_2) throw e_2.error;\n      }\n    }\n\n    var stateTransitions = keys(transitionMap).map(function (key) {\n      return transitionMap[key];\n    });\n    var enabledTransitions = flatten(stateTransitions.map(function (st) {\n      return st.transitions;\n    }));\n    var willTransition = stateTransitions.some(function (st) {\n      return st.transitions.length > 0;\n    });\n\n    if (!willTransition) {\n      return this.next(state, _event);\n    }\n\n    var entryNodes = flatten(stateTransitions.map(function (t) {\n      return t.entrySet;\n    }));\n    var configuration = flatten(keys(transitionMap).map(function (key) {\n      return transitionMap[key].configuration;\n    }));\n    return {\n      transitions: enabledTransitions,\n      entrySet: entryNodes,\n      exitSet: flatten(stateTransitions.map(function (t) {\n        return t.exitSet;\n      })),\n      configuration: configuration,\n      source: state,\n      actions: flatten(keys(transitionMap).map(function (key) {\n        return transitionMap[key].actions;\n      }))\n    };\n  };\n\n  StateNode.prototype._transition = function (stateValue, state, _event) {\n    // leaf node\n    if (isString(stateValue)) {\n      return this.transitionLeafNode(stateValue, state, _event);\n    } // hierarchical node\n\n\n    if (keys(stateValue).length === 1) {\n      return this.transitionCompoundNode(stateValue, state, _event);\n    } // orthogonal node\n\n\n    return this.transitionParallelNode(stateValue, state, _event);\n  };\n\n  StateNode.prototype.next = function (state, _event) {\n    var e_3, _a;\n\n    var _this = this;\n\n    var eventName = _event.name;\n    var actions = [];\n    var nextStateNodes = [];\n    var selectedTransition;\n\n    try {\n      for (var _b = __values(this.getCandidates(eventName)), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var candidate = _c.value;\n        var cond = candidate.cond,\n            stateIn = candidate.in;\n        var resolvedContext = state.context;\n        var isInState = stateIn ? isString(stateIn) && isStateId(stateIn) ? // Check if in state by ID\n        state.matches(toStateValue(this.getStateNodeById(stateIn).path, this.delimiter)) : // Check if in state by relative grandparent\n        matchesState(toStateValue(stateIn, this.delimiter), path(this.path.slice(0, -2))(state.value)) : true;\n        var guardPassed = false;\n\n        try {\n          guardPassed = !cond || evaluateGuard(this.machine, cond, resolvedContext, _event, state);\n        } catch (err) {\n          throw new Error(\"Unable to evaluate guard '\" + (cond.name || cond.type) + \"' in transition for event '\" + eventName + \"' in state node '\" + this.id + \"':\\n\" + err.message);\n        }\n\n        if (guardPassed && isInState) {\n          if (candidate.target !== undefined) {\n            nextStateNodes = candidate.target;\n          }\n\n          actions.push.apply(actions, __spread(candidate.actions));\n          selectedTransition = candidate;\n          break;\n        }\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    if (!selectedTransition) {\n      return undefined;\n    }\n\n    if (!nextStateNodes.length) {\n      return {\n        transitions: [selectedTransition],\n        entrySet: [],\n        exitSet: [],\n        configuration: state.value ? [this] : [],\n        source: state,\n        actions: actions\n      };\n    }\n\n    var allNextStateNodes = flatten(nextStateNodes.map(function (stateNode) {\n      return _this.getRelativeStateNodes(stateNode, state.historyValue);\n    }));\n    var isInternal = !!selectedTransition.internal;\n    var reentryNodes = isInternal ? [] : flatten(allNextStateNodes.map(function (n) {\n      return _this.nodesFromChild(n);\n    }));\n    return {\n      transitions: [selectedTransition],\n      entrySet: reentryNodes,\n      exitSet: isInternal ? [] : [this],\n      configuration: allNextStateNodes,\n      source: state,\n      actions: actions\n    };\n  };\n\n  StateNode.prototype.nodesFromChild = function (childStateNode) {\n    if (childStateNode.escapes(this)) {\n      return [];\n    }\n\n    var nodes = [];\n    var marker = childStateNode;\n\n    while (marker && marker !== this) {\n      nodes.push(marker);\n      marker = marker.parent;\n    }\n\n    nodes.push(this); // inclusive\n\n    return nodes;\n  };\n  /**\r\n   * Whether the given state node \"escapes\" this state node. If the `stateNode` is equal to or the parent of\r\n   * this state node, it does not escape.\r\n   */\n\n\n  StateNode.prototype.escapes = function (stateNode) {\n    if (this === stateNode) {\n      return false;\n    }\n\n    var parent = this.parent;\n\n    while (parent) {\n      if (parent === stateNode) {\n        return false;\n      }\n\n      parent = parent.parent;\n    }\n\n    return true;\n  };\n\n  StateNode.prototype.getActions = function (transition, currentContext, _event, prevState) {\n    var e_4, _a, e_5, _b;\n\n    var prevConfig = getConfiguration([], prevState ? this.getStateNodes(prevState.value) : [this]);\n    var resolvedConfig = transition.configuration.length ? getConfiguration(prevConfig, transition.configuration) : prevConfig;\n\n    try {\n      for (var resolvedConfig_1 = __values(resolvedConfig), resolvedConfig_1_1 = resolvedConfig_1.next(); !resolvedConfig_1_1.done; resolvedConfig_1_1 = resolvedConfig_1.next()) {\n        var sn = resolvedConfig_1_1.value;\n\n        if (!has(prevConfig, sn)) {\n          transition.entrySet.push(sn);\n        }\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (resolvedConfig_1_1 && !resolvedConfig_1_1.done && (_a = resolvedConfig_1.return)) _a.call(resolvedConfig_1);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    try {\n      for (var prevConfig_1 = __values(prevConfig), prevConfig_1_1 = prevConfig_1.next(); !prevConfig_1_1.done; prevConfig_1_1 = prevConfig_1.next()) {\n        var sn = prevConfig_1_1.value;\n\n        if (!has(resolvedConfig, sn) || has(transition.exitSet, sn.parent)) {\n          transition.exitSet.push(sn);\n        }\n      }\n    } catch (e_5_1) {\n      e_5 = {\n        error: e_5_1\n      };\n    } finally {\n      try {\n        if (prevConfig_1_1 && !prevConfig_1_1.done && (_b = prevConfig_1.return)) _b.call(prevConfig_1);\n      } finally {\n        if (e_5) throw e_5.error;\n      }\n    }\n\n    if (!transition.source) {\n      transition.exitSet = []; // Ensure that root StateNode (machine) is entered\n\n      transition.entrySet.push(this);\n    }\n\n    var doneEvents = flatten(transition.entrySet.map(function (sn) {\n      var events = [];\n\n      if (sn.type !== 'final') {\n        return events;\n      }\n\n      var parent = sn.parent;\n\n      if (!parent.parent) {\n        return events;\n      }\n\n      events.push(done(sn.id, sn.doneData), // TODO: deprecate - final states should not emit done events for their own state.\n      done(parent.id, sn.doneData ? mapContext(sn.doneData, currentContext, _event) : undefined));\n      var grandparent = parent.parent;\n\n      if (grandparent.type === 'parallel') {\n        if (getChildren(grandparent).every(function (parentNode) {\n          return isInFinalState(transition.configuration, parentNode);\n        })) {\n          events.push(done(grandparent.id));\n        }\n      }\n\n      return events;\n    }));\n    transition.exitSet.sort(function (a, b) {\n      return b.order - a.order;\n    });\n    transition.entrySet.sort(function (a, b) {\n      return a.order - b.order;\n    });\n    var entryStates = new Set(transition.entrySet);\n    var exitStates = new Set(transition.exitSet);\n\n    var _c = __read([flatten(Array.from(entryStates).map(function (stateNode) {\n      return __spread(stateNode.activities.map(function (activity) {\n        return start(activity);\n      }), stateNode.onEntry);\n    })).concat(doneEvents.map(raise)), flatten(Array.from(exitStates).map(function (stateNode) {\n      return __spread(stateNode.onExit, stateNode.activities.map(function (activity) {\n        return stop(activity);\n      }));\n    }))], 2),\n        entryActions = _c[0],\n        exitActions = _c[1];\n\n    var actions = toActionObjects(exitActions.concat(transition.actions).concat(entryActions), this.machine.options.actions);\n    return actions;\n  };\n  /**\r\n   * Determines the next state given the current `state` and sent `event`.\r\n   *\r\n   * @param state The current State instance or state value\r\n   * @param event The event that was sent at the current state\r\n   * @param context The current context (extended state) of the current state\r\n   */\n\n\n  StateNode.prototype.transition = function (state, event, context) {\n    if (state === void 0) {\n      state = this.initialState;\n    }\n\n    var _event = toSCXMLEvent(event);\n\n    var currentState;\n\n    if (state instanceof State) {\n      currentState = context === undefined ? state : this.resolveState(State.from(state, context));\n    } else {\n      var resolvedStateValue = isString(state) ? this.resolve(pathToStateValue(this.getResolvedPath(state))) : this.resolve(state);\n      var resolvedContext = context ? context : this.machine.context;\n      currentState = this.resolveState(State.from(resolvedStateValue, resolvedContext));\n    }\n\n    if (!IS_PRODUCTION && _event.name === WILDCARD) {\n      throw new Error(\"An event cannot have the wildcard type ('\" + WILDCARD + \"')\");\n    }\n\n    if (this.strict) {\n      if (!this.events.includes(_event.name) && !isBuiltInEvent(_event.name)) {\n        throw new Error(\"Machine '\" + this.id + \"' does not accept event '\" + _event.name + \"'\");\n      }\n    }\n\n    var stateTransition = this._transition(currentState.value, currentState, _event) || {\n      transitions: [],\n      configuration: [],\n      entrySet: [],\n      exitSet: [],\n      source: currentState,\n      actions: []\n    };\n    var prevConfig = getConfiguration([], this.getStateNodes(currentState.value));\n    var resolvedConfig = stateTransition.configuration.length ? getConfiguration(prevConfig, stateTransition.configuration) : prevConfig;\n    stateTransition.configuration = __spread(resolvedConfig);\n    return this.resolveTransition(stateTransition, currentState, _event);\n  };\n\n  StateNode.prototype.resolveRaisedTransition = function (state, _event, originalEvent) {\n    var _a;\n\n    var currentActions = state.actions;\n    state = this.transition(state, _event); // Save original event to state\n    // TODO: this should be the raised event! Delete in V5 (breaking)\n\n    state._event = originalEvent;\n    state.event = originalEvent.data;\n\n    (_a = state.actions).unshift.apply(_a, __spread(currentActions));\n\n    return state;\n  };\n\n  StateNode.prototype.resolveTransition = function (stateTransition, currentState, _event, context) {\n    var e_6, _a;\n\n    var _this = this;\n\n    if (_event === void 0) {\n      _event = initEvent;\n    }\n\n    if (context === void 0) {\n      context = this.machine.context;\n    }\n\n    var configuration = stateTransition.configuration; // Transition will \"apply\" if:\n    // - this is the initial state (there is no current state)\n    // - OR there are transitions\n\n    var willTransition = !currentState || stateTransition.transitions.length > 0;\n    var resolvedStateValue = willTransition ? getValue(this.machine, configuration) : undefined;\n    var historyValue = currentState ? currentState.historyValue ? currentState.historyValue : stateTransition.source ? this.machine.historyValue(currentState.value) : undefined : undefined;\n    var currentContext = currentState ? currentState.context : context;\n    var actions = this.getActions(stateTransition, currentContext, _event, currentState);\n    var activities = currentState ? __assign({}, currentState.activities) : {};\n\n    try {\n      for (var actions_1 = __values(actions), actions_1_1 = actions_1.next(); !actions_1_1.done; actions_1_1 = actions_1.next()) {\n        var action = actions_1_1.value;\n\n        if (action.type === start$1) {\n          activities[action.activity.id || action.activity.type] = action;\n        } else if (action.type === stop$1) {\n          activities[action.activity.id || action.activity.type] = false;\n        }\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (actions_1_1 && !actions_1_1.done && (_a = actions_1.return)) _a.call(actions_1);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    var _b = __read(resolveActions(this, currentState, currentContext, _event, actions), 2),\n        resolvedActions = _b[0],\n        updatedContext = _b[1];\n\n    var _c = __read(partition(resolvedActions, function (action) {\n      return action.type === raise$1 || action.type === send$1 && action.to === SpecialTargets.Internal;\n    }), 2),\n        raisedEvents = _c[0],\n        nonRaisedActions = _c[1];\n\n    var invokeActions = resolvedActions.filter(function (action) {\n      return action.type === start$1 && action.activity.type === invoke;\n    });\n    var children = invokeActions.reduce(function (acc, action) {\n      acc[action.activity.id] = createInvocableActor(action.activity, _this.machine, updatedContext, _event);\n      return acc;\n    }, currentState ? __assign({}, currentState.children) : {});\n    var resolvedConfiguration = resolvedStateValue ? stateTransition.configuration : currentState ? currentState.configuration : [];\n    var meta = resolvedConfiguration.reduce(function (acc, stateNode) {\n      if (stateNode.meta !== undefined) {\n        acc[stateNode.id] = stateNode.meta;\n      }\n\n      return acc;\n    }, {});\n    var isDone = isInFinalState(resolvedConfiguration, this);\n    var nextState = new State({\n      value: resolvedStateValue || currentState.value,\n      context: updatedContext,\n      _event: _event,\n      // Persist _sessionid between states\n      _sessionid: currentState ? currentState._sessionid : null,\n      historyValue: resolvedStateValue ? historyValue ? updateHistoryValue(historyValue, resolvedStateValue) : undefined : currentState ? currentState.historyValue : undefined,\n      history: !resolvedStateValue || stateTransition.source ? currentState : undefined,\n      actions: resolvedStateValue ? nonRaisedActions : [],\n      activities: resolvedStateValue ? activities : currentState ? currentState.activities : {},\n      meta: resolvedStateValue ? meta : currentState ? currentState.meta : undefined,\n      events: [],\n      configuration: resolvedConfiguration,\n      transitions: stateTransition.transitions,\n      children: children,\n      done: isDone\n    });\n    var didUpdateContext = currentContext !== updatedContext;\n    nextState.changed = _event.name === update || didUpdateContext; // Dispose of penultimate histories to prevent memory leaks\n\n    var history = nextState.history;\n\n    if (history) {\n      delete history.history;\n    }\n\n    if (!resolvedStateValue) {\n      return nextState;\n    }\n\n    var maybeNextState = nextState;\n\n    if (!isDone) {\n      var isTransient = this._transient || configuration.some(function (stateNode) {\n        return stateNode._transient;\n      });\n\n      if (isTransient) {\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, {\n          type: nullEvent\n        }, _event);\n      }\n\n      while (raisedEvents.length) {\n        var raisedEvent = raisedEvents.shift();\n        maybeNextState = this.resolveRaisedTransition(maybeNextState, raisedEvent._event, _event);\n      }\n    } // Detect if state changed\n\n\n    var changed = maybeNextState.changed || (history ? !!maybeNextState.actions.length || didUpdateContext || typeof history.value !== typeof maybeNextState.value || !stateValuesEqual(maybeNextState.value, history.value) : undefined);\n    maybeNextState.changed = changed; // Preserve original history after raised events\n\n    maybeNextState.historyValue = nextState.historyValue;\n    maybeNextState.history = history;\n    return maybeNextState;\n  };\n  /**\r\n   * Returns the child state node from its relative `stateKey`, or throws.\r\n   */\n\n\n  StateNode.prototype.getStateNode = function (stateKey) {\n    if (isStateId(stateKey)) {\n      return this.machine.getStateNodeById(stateKey);\n    }\n\n    if (!this.states) {\n      throw new Error(\"Unable to retrieve child state '\" + stateKey + \"' from '\" + this.id + \"'; no child states exist.\");\n    }\n\n    var result = this.states[stateKey];\n\n    if (!result) {\n      throw new Error(\"Child state '\" + stateKey + \"' does not exist on '\" + this.id + \"'\");\n    }\n\n    return result;\n  };\n  /**\r\n   * Returns the state node with the given `stateId`, or throws.\r\n   *\r\n   * @param stateId The state ID. The prefix \"#\" is removed.\r\n   */\n\n\n  StateNode.prototype.getStateNodeById = function (stateId) {\n    var resolvedStateId = isStateId(stateId) ? stateId.slice(STATE_IDENTIFIER.length) : stateId;\n\n    if (resolvedStateId === this.id) {\n      return this;\n    }\n\n    var stateNode = this.machine.idMap[resolvedStateId];\n\n    if (!stateNode) {\n      throw new Error(\"Child state node '#\" + resolvedStateId + \"' does not exist on machine '\" + this.id + \"'\");\n    }\n\n    return stateNode;\n  };\n  /**\r\n   * Returns the relative state node from the given `statePath`, or throws.\r\n   *\r\n   * @param statePath The string or string array relative path to the state node.\r\n   */\n\n\n  StateNode.prototype.getStateNodeByPath = function (statePath) {\n    if (typeof statePath === 'string' && isStateId(statePath)) {\n      try {\n        return this.getStateNodeById(statePath.slice(1));\n      } catch (e) {// try individual paths\n        // throw e;\n      }\n    }\n\n    var arrayStatePath = toStatePath(statePath, this.delimiter).slice();\n    var currentStateNode = this;\n\n    while (arrayStatePath.length) {\n      var key = arrayStatePath.shift();\n\n      if (!key.length) {\n        break;\n      }\n\n      currentStateNode = currentStateNode.getStateNode(key);\n    }\n\n    return currentStateNode;\n  };\n  /**\r\n   * Resolves a partial state value with its full representation in this machine.\r\n   *\r\n   * @param stateValue The partial state value to resolve.\r\n   */\n\n\n  StateNode.prototype.resolve = function (stateValue) {\n    var _a;\n\n    var _this = this;\n\n    if (!stateValue) {\n      return this.initialStateValue || EMPTY_OBJECT; // TODO: type-specific properties\n    }\n\n    switch (this.type) {\n      case 'parallel':\n        return mapValues(this.initialStateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(stateValue[subStateKey] || subStateValue) : EMPTY_OBJECT;\n        });\n\n      case 'compound':\n        if (isString(stateValue)) {\n          var subStateNode = this.getStateNode(stateValue);\n\n          if (subStateNode.type === 'parallel' || subStateNode.type === 'compound') {\n            return _a = {}, _a[stateValue] = subStateNode.initialStateValue, _a;\n          }\n\n          return stateValue;\n        }\n\n        if (!keys(stateValue).length) {\n          return this.initialStateValue || {};\n        }\n\n        return mapValues(stateValue, function (subStateValue, subStateKey) {\n          return subStateValue ? _this.getStateNode(subStateKey).resolve(subStateValue) : EMPTY_OBJECT;\n        });\n\n      default:\n        return stateValue || EMPTY_OBJECT;\n    }\n  };\n\n  StateNode.prototype.getResolvedPath = function (stateIdentifier) {\n    if (isStateId(stateIdentifier)) {\n      var stateNode = this.machine.idMap[stateIdentifier.slice(STATE_IDENTIFIER.length)];\n\n      if (!stateNode) {\n        throw new Error(\"Unable to find state node '\" + stateIdentifier + \"'\");\n      }\n\n      return stateNode.path;\n    }\n\n    return toStatePath(stateIdentifier, this.delimiter);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateValue\", {\n    get: function () {\n      var _a;\n\n      if (this.__cache.initialStateValue) {\n        return this.__cache.initialStateValue;\n      }\n\n      var initialStateValue;\n\n      if (this.type === 'parallel') {\n        initialStateValue = mapFilterValues(this.states, function (state) {\n          return state.initialStateValue || EMPTY_OBJECT;\n        }, function (stateNode) {\n          return !(stateNode.type === 'history');\n        });\n      } else if (this.initial !== undefined) {\n        if (!this.states[this.initial]) {\n          throw new Error(\"Initial state '\" + this.initial + \"' not found on '\" + this.key + \"'\");\n        }\n\n        initialStateValue = isLeafNode(this.states[this.initial]) ? this.initial : (_a = {}, _a[this.initial] = this.states[this.initial].initialStateValue, _a);\n      }\n\n      this.__cache.initialStateValue = initialStateValue;\n      return this.__cache.initialStateValue;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.getInitialState = function (stateValue, context) {\n    var configuration = this.getStateNodes(stateValue);\n    return this.resolveTransition({\n      configuration: configuration,\n      entrySet: configuration,\n      exitSet: [],\n      transitions: [],\n      source: undefined,\n      actions: []\n    }, undefined, undefined, context);\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialState\", {\n    /**\r\n     * The initial State instance, which includes all actions to be executed from\r\n     * entering the initial state.\r\n     */\n    get: function () {\n      this._init(); // TODO: this should be in the constructor (see note in constructor)\n\n\n      var initialStateValue = this.initialStateValue;\n\n      if (!initialStateValue) {\n        throw new Error(\"Cannot retrieve initial state from simple state '\" + this.id + \"'.\");\n      }\n\n      return this.getInitialState(initialStateValue);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"target\", {\n    /**\r\n     * The target state value of the history state node, if it exists. This represents the\r\n     * default state value to transition to if no history value exists yet.\r\n     */\n    get: function () {\n      var target;\n\n      if (this.type === 'history') {\n        var historyConfig = this.config;\n\n        if (isString(historyConfig.target)) {\n          target = isStateId(historyConfig.target) ? pathToStateValue(this.machine.getStateNodeById(historyConfig.target).path.slice(this.path.length - 1)) : historyConfig.target;\n        } else {\n          target = historyConfig.target;\n        }\n      }\n\n      return target;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Returns the leaf nodes from a state path relative to this state node.\r\n   *\r\n   * @param relativeStateId The relative state path to retrieve the state nodes\r\n   * @param history The previous state to retrieve history\r\n   * @param resolve Whether state nodes should resolve to initial child state nodes\r\n   */\n\n  StateNode.prototype.getRelativeStateNodes = function (relativeStateId, historyValue, resolve) {\n    if (resolve === void 0) {\n      resolve = true;\n    }\n\n    return resolve ? relativeStateId.type === 'history' ? relativeStateId.resolveHistory(historyValue) : relativeStateId.initialStateNodes : [relativeStateId];\n  };\n\n  Object.defineProperty(StateNode.prototype, \"initialStateNodes\", {\n    get: function () {\n      var _this = this;\n\n      if (isLeafNode(this)) {\n        return [this];\n      } // Case when state node is compound but no initial state is defined\n\n\n      if (this.type === 'compound' && !this.initial) {\n        if (!IS_PRODUCTION) {\n          warn(false, \"Compound state node '\" + this.id + \"' has no initial state.\");\n        }\n\n        return [this];\n      }\n\n      var initialStateNodePaths = toStatePaths(this.initialStateValue);\n      return flatten(initialStateNodePaths.map(function (initialPath) {\n        return _this.getFromRelativePath(initialPath);\n      }));\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Retrieves state nodes from a relative path to this state node.\r\n   *\r\n   * @param relativePath The relative path from this state node\r\n   * @param historyValue\r\n   */\n\n  StateNode.prototype.getFromRelativePath = function (relativePath) {\n    if (!relativePath.length) {\n      return [this];\n    }\n\n    var _a = __read(relativePath),\n        stateKey = _a[0],\n        childStatePath = _a.slice(1);\n\n    if (!this.states) {\n      throw new Error(\"Cannot retrieve subPath '\" + stateKey + \"' from node with no states\");\n    }\n\n    var childStateNode = this.getStateNode(stateKey);\n\n    if (childStateNode.type === 'history') {\n      return childStateNode.resolveHistory();\n    }\n\n    if (!this.states[stateKey]) {\n      throw new Error(\"Child state '\" + stateKey + \"' does not exist on '\" + this.id + \"'\");\n    }\n\n    return this.states[stateKey].getFromRelativePath(childStatePath);\n  };\n\n  StateNode.prototype.historyValue = function (relativeStateValue) {\n    if (!keys(this.states).length) {\n      return undefined;\n    }\n\n    return {\n      current: relativeStateValue || this.initialStateValue,\n      states: mapFilterValues(this.states, function (stateNode, key) {\n        if (!relativeStateValue) {\n          return stateNode.historyValue();\n        }\n\n        var subStateValue = isString(relativeStateValue) ? undefined : relativeStateValue[key];\n        return stateNode.historyValue(subStateValue || stateNode.initialStateValue);\n      }, function (stateNode) {\n        return !stateNode.history;\n      })\n    };\n  };\n  /**\r\n   * Resolves to the historical value(s) of the parent state node,\r\n   * represented by state nodes.\r\n   *\r\n   * @param historyValue\r\n   */\n\n\n  StateNode.prototype.resolveHistory = function (historyValue) {\n    var _this = this;\n\n    if (this.type !== 'history') {\n      return [this];\n    }\n\n    var parent = this.parent;\n\n    if (!historyValue) {\n      var historyTarget = this.target;\n      return historyTarget ? flatten(toStatePaths(historyTarget).map(function (relativeChildPath) {\n        return parent.getFromRelativePath(relativeChildPath);\n      })) : parent.initialStateNodes;\n    }\n\n    var subHistoryValue = nestedPath(parent.path, 'states')(historyValue).current;\n\n    if (isString(subHistoryValue)) {\n      return [parent.getStateNode(subHistoryValue)];\n    }\n\n    return flatten(toStatePaths(subHistoryValue).map(function (subStatePath) {\n      return _this.history === 'deep' ? parent.getFromRelativePath(subStatePath) : [parent.states[subStatePath[0]]];\n    }));\n  };\n\n  Object.defineProperty(StateNode.prototype, \"stateIds\", {\n    /**\r\n     * All the state node IDs of this state node and its descendant state nodes.\r\n     */\n    get: function () {\n      var _this = this;\n\n      var childStateIds = flatten(keys(this.states).map(function (stateKey) {\n        return _this.states[stateKey].stateIds;\n      }));\n      return [this.id].concat(childStateIds);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"events\", {\n    /**\r\n     * All the event types accepted by this state node and its descendants.\r\n     */\n    get: function () {\n      var e_7, _a, e_8, _b;\n\n      if (this.__cache.events) {\n        return this.__cache.events;\n      }\n\n      var states = this.states;\n      var events = new Set(this.ownEvents);\n\n      if (states) {\n        try {\n          for (var _c = __values(keys(states)), _d = _c.next(); !_d.done; _d = _c.next()) {\n            var stateId = _d.value;\n            var state = states[stateId];\n\n            if (state.states) {\n              try {\n                for (var _e = (e_8 = void 0, __values(state.events)), _f = _e.next(); !_f.done; _f = _e.next()) {\n                  var event_1 = _f.value;\n                  events.add(\"\" + event_1);\n                }\n              } catch (e_8_1) {\n                e_8 = {\n                  error: e_8_1\n                };\n              } finally {\n                try {\n                  if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n                } finally {\n                  if (e_8) throw e_8.error;\n                }\n              }\n            }\n          }\n        } catch (e_7_1) {\n          e_7 = {\n            error: e_7_1\n          };\n        } finally {\n          try {\n            if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n          } finally {\n            if (e_7) throw e_7.error;\n          }\n        }\n      }\n\n      return this.__cache.events = Array.from(events);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(StateNode.prototype, \"ownEvents\", {\n    /**\r\n     * All the events that have transitions directly from this state node.\r\n     *\r\n     * Excludes any inert events.\r\n     */\n    get: function () {\n      var events = new Set(this.transitions.filter(function (transition) {\n        return !(!transition.target && !transition.actions.length && transition.internal);\n      }).map(function (transition) {\n        return transition.eventType;\n      }));\n      return Array.from(events);\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  StateNode.prototype.resolveTarget = function (_target) {\n    var _this = this;\n\n    if (_target === undefined) {\n      // an undefined target signals that the state node should not transition from that state when receiving that event\n      return undefined;\n    }\n\n    return _target.map(function (target) {\n      if (!isString(target)) {\n        return target;\n      }\n\n      var isInternalTarget = target[0] === _this.delimiter; // If internal target is defined on machine,\n      // do not include machine key on target\n\n      if (isInternalTarget && !_this.parent) {\n        return _this.getStateNodeByPath(target.slice(1));\n      }\n\n      var resolvedTarget = isInternalTarget ? _this.key + target : target;\n\n      if (_this.parent) {\n        try {\n          var targetStateNode = _this.parent.getStateNodeByPath(resolvedTarget);\n\n          return targetStateNode;\n        } catch (err) {\n          throw new Error(\"Invalid transition definition for state node '\" + _this.id + \"':\\n\" + err.message);\n        }\n      } else {\n        return _this.getStateNodeByPath(resolvedTarget);\n      }\n    });\n  };\n\n  StateNode.prototype.formatTransition = function (transitionConfig) {\n    var _this = this;\n\n    var normalizedTarget = normalizeTarget(transitionConfig.target);\n    var internal = 'internal' in transitionConfig ? transitionConfig.internal : normalizedTarget ? normalizedTarget.some(function (_target) {\n      return isString(_target) && _target[0] === _this.delimiter;\n    }) : true;\n    var guards = this.machine.options.guards;\n    var target = this.resolveTarget(normalizedTarget);\n\n    var transition = __assign(__assign({}, transitionConfig), {\n      actions: toActionObjects(toArray(transitionConfig.actions)),\n      cond: toGuard(transitionConfig.cond, guards),\n      target: target,\n      source: this,\n      internal: internal,\n      eventType: transitionConfig.event,\n      toJSON: function () {\n        return __assign(__assign({}, transition), {\n          target: transition.target ? transition.target.map(function (t) {\n            return \"#\" + t.id;\n          }) : undefined,\n          source: \"#\" + _this.id\n        });\n      }\n    });\n\n    return transition;\n  };\n\n  StateNode.prototype.formatTransitions = function () {\n    var e_9, _a;\n\n    var _this = this;\n\n    var onConfig;\n\n    if (!this.config.on) {\n      onConfig = [];\n    } else if (Array.isArray(this.config.on)) {\n      onConfig = this.config.on;\n    } else {\n      var _b = this.config.on,\n          _c = WILDCARD,\n          _d = _b[_c],\n          wildcardConfigs = _d === void 0 ? [] : _d,\n          strictTransitionConfigs_1 = __rest(_b, [typeof _c === \"symbol\" ? _c : _c + \"\"]);\n\n      onConfig = flatten(keys(strictTransitionConfigs_1).map(function (key) {\n        if (!IS_PRODUCTION && key === NULL_EVENT) {\n          warn(false, \"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. \" + (\"Please check the `on` configuration for \\\"#\" + _this.id + \"\\\".\"));\n        }\n\n        var transitionConfigArray = toTransitionConfigArray(key, strictTransitionConfigs_1[key]);\n\n        if (!IS_PRODUCTION) {\n          validateArrayifiedTransitions(_this, key, transitionConfigArray);\n        }\n\n        return transitionConfigArray;\n      }).concat(toTransitionConfigArray(WILDCARD, wildcardConfigs)));\n    }\n\n    var eventlessConfig = this.config.always ? toTransitionConfigArray('', this.config.always) : [];\n    var doneConfig = this.config.onDone ? toTransitionConfigArray(String(done(this.id)), this.config.onDone) : [];\n\n    if (!IS_PRODUCTION) {\n      warn(!(this.config.onDone && !this.parent), \"Root nodes cannot have an \\\".onDone\\\" transition. Please check the config of \\\"\" + this.id + \"\\\".\");\n    }\n\n    var invokeConfig = flatten(this.invoke.map(function (invokeDef) {\n      var settleTransitions = [];\n\n      if (invokeDef.onDone) {\n        settleTransitions.push.apply(settleTransitions, __spread(toTransitionConfigArray(String(doneInvoke(invokeDef.id)), invokeDef.onDone)));\n      }\n\n      if (invokeDef.onError) {\n        settleTransitions.push.apply(settleTransitions, __spread(toTransitionConfigArray(String(error(invokeDef.id)), invokeDef.onError)));\n      }\n\n      return settleTransitions;\n    }));\n    var delayedTransitions = this.after;\n    var formattedTransitions = flatten(__spread(doneConfig, invokeConfig, onConfig, eventlessConfig).map(function (transitionConfig) {\n      return toArray(transitionConfig).map(function (transition) {\n        return _this.formatTransition(transition);\n      });\n    }));\n\n    try {\n      for (var delayedTransitions_1 = __values(delayedTransitions), delayedTransitions_1_1 = delayedTransitions_1.next(); !delayedTransitions_1_1.done; delayedTransitions_1_1 = delayedTransitions_1.next()) {\n        var delayedTransition = delayedTransitions_1_1.value;\n        formattedTransitions.push(delayedTransition);\n      }\n    } catch (e_9_1) {\n      e_9 = {\n        error: e_9_1\n      };\n    } finally {\n      try {\n        if (delayedTransitions_1_1 && !delayedTransitions_1_1.done && (_a = delayedTransitions_1.return)) _a.call(delayedTransitions_1);\n      } finally {\n        if (e_9) throw e_9.error;\n      }\n    }\n\n    return formattedTransitions;\n  };\n\n  return StateNode;\n}();\n\nexport { StateNode };","import { __assign } from './_virtual/_tslib.js';\nvar defaultOptions = {\n  deferEvents: false\n};\n\nvar Scheduler =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  function Scheduler(options) {\n    this.processingEvent = false;\n    this.queue = [];\n    this.initialized = false;\n    this.options = __assign(__assign({}, defaultOptions), options);\n  }\n\n  Scheduler.prototype.initialize = function (callback) {\n    this.initialized = true;\n\n    if (callback) {\n      if (!this.options.deferEvents) {\n        this.schedule(callback);\n        return;\n      }\n\n      this.process(callback);\n    }\n\n    this.flushEvents();\n  };\n\n  Scheduler.prototype.schedule = function (task) {\n    if (!this.initialized || this.processingEvent) {\n      this.queue.push(task);\n      return;\n    }\n\n    if (this.queue.length !== 0) {\n      throw new Error('Event queue should be empty when it is not processing events');\n    }\n\n    this.process(task);\n    this.flushEvents();\n  };\n\n  Scheduler.prototype.clear = function () {\n    this.queue = [];\n  };\n\n  Scheduler.prototype.flushEvents = function () {\n    var nextCallback = this.queue.shift();\n\n    while (nextCallback) {\n      this.process(nextCallback);\n      nextCallback = this.queue.shift();\n    }\n  };\n\n  Scheduler.prototype.process = function (callback) {\n    this.processingEvent = true;\n\n    try {\n      callback();\n    } catch (e) {\n      // there is no use to keep the future events\n      // as the situation is not anymore the same\n      this.clear();\n      throw e;\n    } finally {\n      this.processingEvent = false;\n    }\n  };\n\n  return Scheduler;\n}();\n\nexport { Scheduler };","var children = /*#__PURE__*/new Map();\nvar sessionIdIndex = 0;\nvar registry = {\n  bookId: function () {\n    return \"x:\" + sessionIdIndex++;\n  },\n  register: function (id, actor) {\n    children.set(id, actor);\n    return id;\n  },\n  get: function (id) {\n    return children.get(id);\n  },\n  free: function (id) {\n    children.delete(id);\n  }\n};\nexport { registry };","import { __values, __assign, __spread } from './_virtual/_tslib.js';\nimport { IS_PRODUCTION } from './environment.js';\nimport { warn, mapContext, isFunction, keys, toSCXMLEvent, toInvokeSource, isPromiseLike, isObservable, isMachine, reportUnhandledExceptionOnInvocation, symbolObservable, isArray, toEventObject, isString, uniqueId } from './utils.js';\nimport { ActionTypes, SpecialTargets } from './types.js';\nimport { isInFinalState } from './stateUtils.js';\nimport { errorPlatform, log, stop, start, cancel, send, update, error as error$1 } from './actionTypes.js';\nimport { doneInvoke, initEvent, getActionFunction, error } from './actions.js';\nimport { isState, State, bindActionToState } from './State.js';\nimport { isActor, createDeferredActor } from './Actor.js';\nimport { Scheduler } from './scheduler.js';\nimport { registry } from './registry.js';\nimport { registerService } from './devTools.js';\nvar DEFAULT_SPAWN_OPTIONS = {\n  sync: false,\n  autoForward: false\n};\n/**\r\n * Maintains a stack of the current service in scope.\r\n * This is used to provide the correct service to spawn().\r\n *\r\n * @private\r\n */\n\nvar withServiceScope = /*#__PURE__*/function () {\n  var serviceStack = [];\n  return function (service, fn) {\n    service && serviceStack.push(service);\n    var result = fn(service || serviceStack[serviceStack.length - 1]);\n    service && serviceStack.pop();\n    return result;\n  };\n}();\n\nvar InterpreterStatus;\n\n(function (InterpreterStatus) {\n  InterpreterStatus[InterpreterStatus[\"NotStarted\"] = 0] = \"NotStarted\";\n  InterpreterStatus[InterpreterStatus[\"Running\"] = 1] = \"Running\";\n  InterpreterStatus[InterpreterStatus[\"Stopped\"] = 2] = \"Stopped\";\n})(InterpreterStatus || (InterpreterStatus = {}));\n\nvar Interpreter =\n/*#__PURE__*/\n\n/** @class */\nfunction () {\n  /**\r\n   * Creates a new Interpreter instance (i.e., service) for the given machine with the provided options, if any.\r\n   *\r\n   * @param machine The machine to be interpreted\r\n   * @param options Interpreter options\r\n   */\n  function Interpreter(machine, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = Interpreter.defaultOptions;\n    }\n\n    this.machine = machine;\n    this.scheduler = new Scheduler();\n    this.delayedEventsMap = {};\n    this.listeners = new Set();\n    this.contextListeners = new Set();\n    this.stopListeners = new Set();\n    this.doneListeners = new Set();\n    this.eventListeners = new Set();\n    this.sendListeners = new Set();\n    /**\r\n     * Whether the service is started.\r\n     */\n\n    this.initialized = false;\n    this._status = InterpreterStatus.NotStarted;\n    this.children = new Map();\n    this.forwardTo = new Set();\n    /**\r\n     * Alias for Interpreter.prototype.start\r\n     */\n\n    this.init = this.start;\n    /**\r\n     * Sends an event to the running interpreter to trigger a transition.\r\n     *\r\n     * An array of events (batched) can be sent as well, which will send all\r\n     * batched events to the running interpreter. The listeners will be\r\n     * notified only **once** when all events are processed.\r\n     *\r\n     * @param event The event(s) to send\r\n     */\n\n    this.send = function (event, payload) {\n      if (isArray(event)) {\n        _this.batch(event);\n\n        return _this.state;\n      }\n\n      var _event = toSCXMLEvent(toEventObject(event, payload));\n\n      if (_this._status === InterpreterStatus.Stopped) {\n        // do nothing\n        if (!IS_PRODUCTION) {\n          warn(false, \"Event \\\"\" + _event.name + \"\\\" was sent to stopped service \\\"\" + _this.machine.id + \"\\\". This service has already reached its final state, and will not transition.\\nEvent: \" + JSON.stringify(_event.data));\n        }\n\n        return _this.state;\n      }\n\n      if (_this._status === InterpreterStatus.NotStarted && _this.options.deferEvents) {\n        // tslint:disable-next-line:no-console\n        if (!IS_PRODUCTION) {\n          warn(false, \"Event \\\"\" + _event.name + \"\\\" was sent to uninitialized service \\\"\" + _this.machine.id + \"\\\" and is deferred. Make sure .start() is called for this service.\\nEvent: \" + JSON.stringify(_event.data));\n        }\n      } else if (_this._status !== InterpreterStatus.Running) {\n        throw new Error(\"Event \\\"\" + _event.name + \"\\\" was sent to uninitialized service \\\"\" + _this.machine.id + \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\\nEvent: \" + JSON.stringify(_event.data));\n      }\n\n      _this.scheduler.schedule(function () {\n        // Forward copy of event to child actors\n        _this.forward(_event);\n\n        var nextState = _this.nextState(_event);\n\n        _this.update(nextState, _event);\n      });\n\n      return _this._state; // TODO: deprecate (should return void)\n      // tslint:disable-next-line:semicolon\n    };\n\n    this.sendTo = function (event, to) {\n      var isParent = _this.parent && (to === SpecialTargets.Parent || _this.parent.id === to);\n      var target = isParent ? _this.parent : isActor(to) ? to : _this.children.get(to) || registry.get(to);\n\n      if (!target) {\n        if (!isParent) {\n          throw new Error(\"Unable to send event to child '\" + to + \"' from service '\" + _this.id + \"'.\");\n        } // tslint:disable-next-line:no-console\n\n\n        if (!IS_PRODUCTION) {\n          warn(false, \"Service '\" + _this.id + \"' has no parent: unable to send event \" + event.type);\n        }\n\n        return;\n      }\n\n      if ('machine' in target) {\n        // Send SCXML events to machines\n        target.send(__assign(__assign({}, event), {\n          name: event.name === error$1 ? \"\" + error(_this.id) : event.name,\n          origin: _this.sessionId\n        }));\n      } else {\n        // Send normal events to other targets\n        target.send(event.data);\n      }\n    };\n\n    var resolvedOptions = __assign(__assign({}, Interpreter.defaultOptions), options);\n\n    var clock = resolvedOptions.clock,\n        logger = resolvedOptions.logger,\n        parent = resolvedOptions.parent,\n        id = resolvedOptions.id;\n    var resolvedId = id !== undefined ? id : machine.id;\n    this.id = resolvedId;\n    this.logger = logger;\n    this.clock = clock;\n    this.parent = parent;\n    this.options = resolvedOptions;\n    this.scheduler = new Scheduler({\n      deferEvents: this.options.deferEvents\n    });\n    this.sessionId = registry.bookId();\n  }\n\n  Object.defineProperty(Interpreter.prototype, \"initialState\", {\n    get: function () {\n      var _this = this;\n\n      if (this._initialState) {\n        return this._initialState;\n      }\n\n      return withServiceScope(this, function () {\n        _this._initialState = _this.machine.initialState;\n        return _this._initialState;\n      });\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Interpreter.prototype, \"state\", {\n    get: function () {\n      if (!IS_PRODUCTION) {\n        warn(this._status !== InterpreterStatus.NotStarted, \"Attempted to read state from uninitialized service '\" + this.id + \"'. Make sure the service is started first.\");\n      }\n\n      return this._state;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  /**\r\n   * Executes the actions of the given state, with that state's `context` and `event`.\r\n   *\r\n   * @param state The state whose actions will be executed\r\n   * @param actionsConfig The action implementations to use\r\n   */\n\n  Interpreter.prototype.execute = function (state, actionsConfig) {\n    var e_1, _a;\n\n    try {\n      for (var _b = __values(state.actions), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var action = _c.value;\n        this.exec(action, state, actionsConfig);\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.update = function (state, _event) {\n    var e_2, _a, e_3, _b, e_4, _c, e_5, _d;\n\n    var _this = this; // Attach session ID to state\n\n\n    state._sessionid = this.sessionId; // Update state\n\n    this._state = state; // Execute actions\n\n    if (this.options.execute) {\n      this.execute(this.state);\n    } // Dev tools\n\n\n    if (this.devTools) {\n      this.devTools.send(_event.data, state);\n    } // Execute listeners\n\n\n    if (state.event) {\n      try {\n        for (var _e = __values(this.eventListeners), _f = _e.next(); !_f.done; _f = _e.next()) {\n          var listener = _f.value;\n          listener(state.event);\n        }\n      } catch (e_2_1) {\n        e_2 = {\n          error: e_2_1\n        };\n      } finally {\n        try {\n          if (_f && !_f.done && (_a = _e.return)) _a.call(_e);\n        } finally {\n          if (e_2) throw e_2.error;\n        }\n      }\n    }\n\n    try {\n      for (var _g = __values(this.listeners), _h = _g.next(); !_h.done; _h = _g.next()) {\n        var listener = _h.value;\n        listener(state, state.event);\n      }\n    } catch (e_3_1) {\n      e_3 = {\n        error: e_3_1\n      };\n    } finally {\n      try {\n        if (_h && !_h.done && (_b = _g.return)) _b.call(_g);\n      } finally {\n        if (e_3) throw e_3.error;\n      }\n    }\n\n    try {\n      for (var _j = __values(this.contextListeners), _k = _j.next(); !_k.done; _k = _j.next()) {\n        var contextListener = _k.value;\n        contextListener(this.state.context, this.state.history ? this.state.history.context : undefined);\n      }\n    } catch (e_4_1) {\n      e_4 = {\n        error: e_4_1\n      };\n    } finally {\n      try {\n        if (_k && !_k.done && (_c = _j.return)) _c.call(_j);\n      } finally {\n        if (e_4) throw e_4.error;\n      }\n    }\n\n    var isDone = isInFinalState(state.configuration || [], this.machine);\n\n    if (this.state.configuration && isDone) {\n      // get final child state node\n      var finalChildStateNode = state.configuration.find(function (sn) {\n        return sn.type === 'final' && sn.parent === _this.machine;\n      });\n      var doneData = finalChildStateNode && finalChildStateNode.doneData ? mapContext(finalChildStateNode.doneData, state.context, _event) : undefined;\n\n      try {\n        for (var _l = __values(this.doneListeners), _m = _l.next(); !_m.done; _m = _l.next()) {\n          var listener = _m.value;\n          listener(doneInvoke(this.id, doneData));\n        }\n      } catch (e_5_1) {\n        e_5 = {\n          error: e_5_1\n        };\n      } finally {\n        try {\n          if (_m && !_m.done && (_d = _l.return)) _d.call(_l);\n        } finally {\n          if (e_5) throw e_5.error;\n        }\n      }\n\n      this.stop();\n    }\n  };\n  /*\r\n   * Adds a listener that is notified whenever a state transition happens. The listener is called with\r\n   * the next state and the event object that caused the state transition.\r\n   *\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onTransition = function (listener) {\n    this.listeners.add(listener); // Send current state to listener\n\n    if (this._status === InterpreterStatus.Running) {\n      listener(this.state, this.state.event);\n    }\n\n    return this;\n  };\n\n  Interpreter.prototype.subscribe = function (nextListenerOrObserver, _, // TODO: error listener\n  completeListener) {\n    var _this = this;\n\n    if (!nextListenerOrObserver) {\n      return {\n        unsubscribe: function () {\n          return void 0;\n        }\n      };\n    }\n\n    var listener;\n    var resolvedCompleteListener = completeListener;\n\n    if (typeof nextListenerOrObserver === 'function') {\n      listener = nextListenerOrObserver;\n    } else {\n      listener = nextListenerOrObserver.next.bind(nextListenerOrObserver);\n      resolvedCompleteListener = nextListenerOrObserver.complete.bind(nextListenerOrObserver);\n    }\n\n    this.listeners.add(listener); // Send current state to listener\n\n    if (this._status === InterpreterStatus.Running) {\n      listener(this.state);\n    }\n\n    if (resolvedCompleteListener) {\n      this.onDone(resolvedCompleteListener);\n    }\n\n    return {\n      unsubscribe: function () {\n        listener && _this.listeners.delete(listener);\n        resolvedCompleteListener && _this.doneListeners.delete(resolvedCompleteListener);\n      }\n    };\n  };\n  /**\r\n   * Adds an event listener that is notified whenever an event is sent to the running interpreter.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onEvent = function (listener) {\n    this.eventListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds an event listener that is notified whenever a `send` event occurs.\r\n   * @param listener The event listener\r\n   */\n\n\n  Interpreter.prototype.onSend = function (listener) {\n    this.sendListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a context listener that is notified whenever the state context changes.\r\n   * @param listener The context listener\r\n   */\n\n\n  Interpreter.prototype.onChange = function (listener) {\n    this.contextListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a listener that is notified when the machine is stopped.\r\n   * @param listener The listener\r\n   */\n\n\n  Interpreter.prototype.onStop = function (listener) {\n    this.stopListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Adds a state listener that is notified when the statechart has reached its final state.\r\n   * @param listener The state listener\r\n   */\n\n\n  Interpreter.prototype.onDone = function (listener) {\n    this.doneListeners.add(listener);\n    return this;\n  };\n  /**\r\n   * Removes a listener.\r\n   * @param listener The listener to remove\r\n   */\n\n\n  Interpreter.prototype.off = function (listener) {\n    this.listeners.delete(listener);\n    this.eventListeners.delete(listener);\n    this.sendListeners.delete(listener);\n    this.stopListeners.delete(listener);\n    this.doneListeners.delete(listener);\n    this.contextListeners.delete(listener);\n    return this;\n  };\n  /**\r\n   * Starts the interpreter from the given state, or the initial state.\r\n   * @param initialState The state to start the statechart from\r\n   */\n\n\n  Interpreter.prototype.start = function (initialState) {\n    var _this = this;\n\n    if (this._status === InterpreterStatus.Running) {\n      // Do not restart the service if it is already started\n      return this;\n    }\n\n    registry.register(this.sessionId, this);\n    this.initialized = true;\n    this._status = InterpreterStatus.Running;\n    var resolvedState = initialState === undefined ? this.initialState : withServiceScope(this, function () {\n      return isState(initialState) ? _this.machine.resolveState(initialState) : _this.machine.resolveState(State.from(initialState, _this.machine.context));\n    });\n\n    if (this.options.devTools) {\n      this.attachDev();\n    }\n\n    this.scheduler.initialize(function () {\n      _this.update(resolvedState, initEvent);\n    });\n    return this;\n  };\n  /**\r\n   * Stops the interpreter and unsubscribe all listeners.\r\n   *\r\n   * This will also notify the `onStop` listeners.\r\n   */\n\n\n  Interpreter.prototype.stop = function () {\n    var e_6, _a, e_7, _b, e_8, _c, e_9, _d, e_10, _e;\n\n    try {\n      for (var _f = __values(this.listeners), _g = _f.next(); !_g.done; _g = _f.next()) {\n        var listener = _g.value;\n        this.listeners.delete(listener);\n      }\n    } catch (e_6_1) {\n      e_6 = {\n        error: e_6_1\n      };\n    } finally {\n      try {\n        if (_g && !_g.done && (_a = _f.return)) _a.call(_f);\n      } finally {\n        if (e_6) throw e_6.error;\n      }\n    }\n\n    try {\n      for (var _h = __values(this.stopListeners), _j = _h.next(); !_j.done; _j = _h.next()) {\n        var listener = _j.value; // call listener, then remove\n\n        listener();\n        this.stopListeners.delete(listener);\n      }\n    } catch (e_7_1) {\n      e_7 = {\n        error: e_7_1\n      };\n    } finally {\n      try {\n        if (_j && !_j.done && (_b = _h.return)) _b.call(_h);\n      } finally {\n        if (e_7) throw e_7.error;\n      }\n    }\n\n    try {\n      for (var _k = __values(this.contextListeners), _l = _k.next(); !_l.done; _l = _k.next()) {\n        var listener = _l.value;\n        this.contextListeners.delete(listener);\n      }\n    } catch (e_8_1) {\n      e_8 = {\n        error: e_8_1\n      };\n    } finally {\n      try {\n        if (_l && !_l.done && (_c = _k.return)) _c.call(_k);\n      } finally {\n        if (e_8) throw e_8.error;\n      }\n    }\n\n    try {\n      for (var _m = __values(this.doneListeners), _o = _m.next(); !_o.done; _o = _m.next()) {\n        var listener = _o.value;\n        this.doneListeners.delete(listener);\n      }\n    } catch (e_9_1) {\n      e_9 = {\n        error: e_9_1\n      };\n    } finally {\n      try {\n        if (_o && !_o.done && (_d = _m.return)) _d.call(_m);\n      } finally {\n        if (e_9) throw e_9.error;\n      }\n    } // Stop all children\n\n\n    this.children.forEach(function (child) {\n      if (isFunction(child.stop)) {\n        child.stop();\n      }\n    });\n\n    try {\n      // Cancel all delayed events\n      for (var _p = __values(keys(this.delayedEventsMap)), _q = _p.next(); !_q.done; _q = _p.next()) {\n        var key = _q.value;\n        this.clock.clearTimeout(this.delayedEventsMap[key]);\n      }\n    } catch (e_10_1) {\n      e_10 = {\n        error: e_10_1\n      };\n    } finally {\n      try {\n        if (_q && !_q.done && (_e = _p.return)) _e.call(_p);\n      } finally {\n        if (e_10) throw e_10.error;\n      }\n    }\n\n    this.scheduler.clear();\n    this.initialized = false;\n    this._status = InterpreterStatus.Stopped;\n    registry.free(this.sessionId);\n    return this;\n  };\n\n  Interpreter.prototype.batch = function (events) {\n    var _this = this;\n\n    if (this._status === InterpreterStatus.NotStarted && this.options.deferEvents) {\n      // tslint:disable-next-line:no-console\n      if (!IS_PRODUCTION) {\n        warn(false, events.length + \" event(s) were sent to uninitialized service \\\"\" + this.machine.id + \"\\\" and are deferred. Make sure .start() is called for this service.\\nEvent: \" + JSON.stringify(event));\n      }\n    } else if (this._status !== InterpreterStatus.Running) {\n      throw new Error( // tslint:disable-next-line:max-line-length\n      events.length + \" event(s) were sent to uninitialized service \\\"\" + this.machine.id + \"\\\". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\");\n    }\n\n    this.scheduler.schedule(function () {\n      var e_11, _a;\n\n      var nextState = _this.state;\n      var batchChanged = false;\n      var batchedActions = [];\n\n      var _loop_1 = function (event_1) {\n        var _event = toSCXMLEvent(event_1);\n\n        _this.forward(_event);\n\n        nextState = withServiceScope(_this, function () {\n          return _this.machine.transition(nextState, _event);\n        });\n        batchedActions.push.apply(batchedActions, __spread(nextState.actions.map(function (a) {\n          return bindActionToState(a, nextState);\n        })));\n        batchChanged = batchChanged || !!nextState.changed;\n      };\n\n      try {\n        for (var events_1 = __values(events), events_1_1 = events_1.next(); !events_1_1.done; events_1_1 = events_1.next()) {\n          var event_1 = events_1_1.value;\n\n          _loop_1(event_1);\n        }\n      } catch (e_11_1) {\n        e_11 = {\n          error: e_11_1\n        };\n      } finally {\n        try {\n          if (events_1_1 && !events_1_1.done && (_a = events_1.return)) _a.call(events_1);\n        } finally {\n          if (e_11) throw e_11.error;\n        }\n      }\n\n      nextState.changed = batchChanged;\n      nextState.actions = batchedActions;\n\n      _this.update(nextState, toSCXMLEvent(events[events.length - 1]));\n    });\n  };\n  /**\r\n   * Returns a send function bound to this interpreter instance.\r\n   *\r\n   * @param event The event to be sent by the sender.\r\n   */\n\n\n  Interpreter.prototype.sender = function (event) {\n    return this.send.bind(this, event);\n  };\n  /**\r\n   * Returns the next state given the interpreter's current state and the event.\r\n   *\r\n   * This is a pure method that does _not_ update the interpreter's state.\r\n   *\r\n   * @param event The event to determine the next state\r\n   */\n\n\n  Interpreter.prototype.nextState = function (event) {\n    var _this = this;\n\n    var _event = toSCXMLEvent(event);\n\n    if (_event.name.indexOf(errorPlatform) === 0 && !this.state.nextEvents.some(function (nextEvent) {\n      return nextEvent.indexOf(errorPlatform) === 0;\n    })) {\n      throw _event.data.data;\n    }\n\n    var nextState = withServiceScope(this, function () {\n      return _this.machine.transition(_this.state, _event);\n    });\n    return nextState;\n  };\n\n  Interpreter.prototype.forward = function (event) {\n    var e_12, _a;\n\n    try {\n      for (var _b = __values(this.forwardTo), _c = _b.next(); !_c.done; _c = _b.next()) {\n        var id = _c.value;\n        var child = this.children.get(id);\n\n        if (!child) {\n          throw new Error(\"Unable to forward event '\" + event + \"' from interpreter '\" + this.id + \"' to nonexistant child '\" + id + \"'.\");\n        }\n\n        child.send(event);\n      }\n    } catch (e_12_1) {\n      e_12 = {\n        error: e_12_1\n      };\n    } finally {\n      try {\n        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n      } finally {\n        if (e_12) throw e_12.error;\n      }\n    }\n  };\n\n  Interpreter.prototype.defer = function (sendAction) {\n    var _this = this;\n\n    this.delayedEventsMap[sendAction.id] = this.clock.setTimeout(function () {\n      if (sendAction.to) {\n        _this.sendTo(sendAction._event, sendAction.to);\n      } else {\n        _this.send(sendAction._event);\n      }\n    }, sendAction.delay);\n  };\n\n  Interpreter.prototype.cancel = function (sendId) {\n    this.clock.clearTimeout(this.delayedEventsMap[sendId]);\n    delete this.delayedEventsMap[sendId];\n  };\n\n  Interpreter.prototype.exec = function (action, state, actionFunctionMap) {\n    if (actionFunctionMap === void 0) {\n      actionFunctionMap = this.machine.options.actions;\n    }\n\n    var context = state.context,\n        _event = state._event;\n    var actionOrExec = action.exec || getActionFunction(action.type, actionFunctionMap);\n    var exec = isFunction(actionOrExec) ? actionOrExec : actionOrExec ? actionOrExec.exec : action.exec;\n\n    if (exec) {\n      try {\n        return exec(context, _event.data, {\n          action: action,\n          state: this.state,\n          _event: _event\n        });\n      } catch (err) {\n        if (this.parent) {\n          this.parent.send({\n            type: 'xstate.error',\n            data: err\n          });\n        }\n\n        throw err;\n      }\n    }\n\n    switch (action.type) {\n      case send:\n        var sendAction = action;\n\n        if (typeof sendAction.delay === 'number') {\n          this.defer(sendAction);\n          return;\n        } else {\n          if (sendAction.to) {\n            this.sendTo(sendAction._event, sendAction.to);\n          } else {\n            this.send(sendAction._event);\n          }\n        }\n\n        break;\n\n      case cancel:\n        this.cancel(action.sendId);\n        break;\n\n      case start:\n        {\n          var activity = action.activity; // If the activity will be stopped right after it's started\n          // (such as in transient states)\n          // don't bother starting the activity.\n\n          if (!this.state.activities[activity.id || activity.type]) {\n            break;\n          } // Invoked services\n\n\n          if (activity.type === ActionTypes.Invoke) {\n            var invokeSource = toInvokeSource(activity.src);\n            var serviceCreator = this.machine.options.services ? this.machine.options.services[invokeSource.type] : undefined;\n            var id = activity.id,\n                data = activity.data;\n\n            if (!IS_PRODUCTION) {\n              warn(!('forward' in activity), // tslint:disable-next-line:max-line-length\n              \"`forward` property is deprecated (found in invocation of '\" + activity.src + \"' in in machine '\" + this.machine.id + \"'). \" + \"Please use `autoForward` instead.\");\n            }\n\n            var autoForward = 'autoForward' in activity ? activity.autoForward : !!activity.forward;\n\n            if (!serviceCreator) {\n              // tslint:disable-next-line:no-console\n              if (!IS_PRODUCTION) {\n                warn(false, \"No service found for invocation '\" + activity.src + \"' in machine '\" + this.machine.id + \"'.\");\n              }\n\n              return;\n            }\n\n            var resolvedData = data ? mapContext(data, context, _event) : undefined;\n            var source = isFunction(serviceCreator) ? serviceCreator(context, _event.data, {\n              data: resolvedData,\n              src: invokeSource\n            }) : serviceCreator;\n\n            if (isPromiseLike(source)) {\n              this.state.children[id] = this.spawnPromise(Promise.resolve(source), id);\n            } else if (isFunction(source)) {\n              this.state.children[id] = this.spawnCallback(source, id);\n            } else if (isObservable(source)) {\n              this.state.children[id] = this.spawnObservable(source, id);\n            } else if (isMachine(source)) {\n              // TODO: try/catch here\n              this.state.children[id] = this.spawnMachine(resolvedData ? source.withContext(resolvedData) : source, {\n                id: id,\n                autoForward: autoForward\n              });\n            }\n          } else {\n            this.spawnActivity(activity);\n          }\n\n          break;\n        }\n\n      case stop:\n        {\n          this.stopChild(action.activity.id);\n          break;\n        }\n\n      case log:\n        var label = action.label,\n            value = action.value;\n\n        if (label) {\n          this.logger(label, value);\n        } else {\n          this.logger(value);\n        }\n\n        break;\n\n      default:\n        if (!IS_PRODUCTION) {\n          warn(false, \"No implementation found for action type '\" + action.type + \"'\");\n        }\n\n        break;\n    }\n\n    return undefined;\n  };\n\n  Interpreter.prototype.removeChild = function (childId) {\n    this.children.delete(childId);\n    this.forwardTo.delete(childId);\n    delete this.state.children[childId];\n  };\n\n  Interpreter.prototype.stopChild = function (childId) {\n    var child = this.children.get(childId);\n\n    if (!child) {\n      return;\n    }\n\n    this.removeChild(childId);\n\n    if (isFunction(child.stop)) {\n      child.stop();\n    }\n  };\n\n  Interpreter.prototype.spawn = function (entity, name, options) {\n    if (isPromiseLike(entity)) {\n      return this.spawnPromise(Promise.resolve(entity), name);\n    } else if (isFunction(entity)) {\n      return this.spawnCallback(entity, name);\n    } else if (isActor(entity)) {\n      return this.spawnActor(entity);\n    } else if (isObservable(entity)) {\n      return this.spawnObservable(entity, name);\n    } else if (isMachine(entity)) {\n      return this.spawnMachine(entity, __assign(__assign({}, options), {\n        id: name\n      }));\n    } else {\n      throw new Error(\"Unable to spawn entity \\\"\" + name + \"\\\" of type \\\"\" + typeof entity + \"\\\".\");\n    }\n  };\n\n  Interpreter.prototype.spawnMachine = function (machine, options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    var childService = new Interpreter(machine, __assign(__assign({}, this.options), {\n      parent: this,\n      id: options.id || machine.id\n    }));\n\n    var resolvedOptions = __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), options);\n\n    if (resolvedOptions.sync) {\n      childService.onTransition(function (state) {\n        _this.send(update, {\n          state: state,\n          id: childService.id\n        });\n      });\n    }\n\n    var actor = childService;\n    this.children.set(childService.id, actor);\n\n    if (resolvedOptions.autoForward) {\n      this.forwardTo.add(childService.id);\n    }\n\n    childService.onDone(function (doneEvent) {\n      _this.removeChild(childService.id);\n\n      _this.send(toSCXMLEvent(doneEvent, {\n        origin: childService.id\n      }));\n    }).start();\n    return actor;\n  };\n\n  Interpreter.prototype.spawnPromise = function (promise, id) {\n    var _this = this;\n\n    var canceled = false;\n    promise.then(function (response) {\n      if (!canceled) {\n        _this.removeChild(id);\n\n        _this.send(toSCXMLEvent(doneInvoke(id, response), {\n          origin: id\n        }));\n      }\n    }, function (errorData) {\n      if (!canceled) {\n        _this.removeChild(id);\n\n        var errorEvent = error(id, errorData);\n\n        try {\n          // Send \"error.platform.id\" to this (parent).\n          _this.send(toSCXMLEvent(errorEvent, {\n            origin: id\n          }));\n        } catch (error) {\n          reportUnhandledExceptionOnInvocation(errorData, error, id);\n\n          if (_this.devTools) {\n            _this.devTools.send(errorEvent, _this.state);\n          }\n\n          if (_this.machine.strict) {\n            // it would be better to always stop the state machine if unhandled\n            // exception/promise rejection happens but because we don't want to\n            // break existing code so enforce it on strict mode only especially so\n            // because documentation says that onError is optional\n            _this.stop();\n          }\n        }\n      }\n    });\n    var actor = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        var unsubscribed = false;\n        promise.then(function (response) {\n          if (unsubscribed) {\n            return;\n          }\n\n          next && next(response);\n\n          if (unsubscribed) {\n            return;\n          }\n\n          complete && complete();\n        }, function (err) {\n          if (unsubscribed) {\n            return;\n          }\n\n          handleError(err);\n        });\n        return {\n          unsubscribe: function () {\n            return unsubscribed = true;\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnCallback = function (callback, id) {\n    var _this = this;\n\n    var canceled = false;\n    var receivers = new Set();\n    var listeners = new Set();\n\n    var receive = function (e) {\n      listeners.forEach(function (listener) {\n        return listener(e);\n      });\n\n      if (canceled) {\n        return;\n      }\n\n      _this.send(e);\n    };\n\n    var callbackStop;\n\n    try {\n      callbackStop = callback(receive, function (newListener) {\n        receivers.add(newListener);\n      });\n    } catch (err) {\n      this.send(error(id, err));\n    }\n\n    if (isPromiseLike(callbackStop)) {\n      // it turned out to be an async function, can't reliably check this before calling `callback`\n      // because transpiled async functions are not recognizable\n      return this.spawnPromise(callbackStop, id);\n    }\n\n    var actor = {\n      id: id,\n      send: function (event) {\n        return receivers.forEach(function (receiver) {\n          return receiver(event);\n        });\n      },\n      subscribe: function (next) {\n        listeners.add(next);\n        return {\n          unsubscribe: function () {\n            listeners.delete(next);\n          }\n        };\n      },\n      stop: function () {\n        canceled = true;\n\n        if (isFunction(callbackStop)) {\n          callbackStop();\n        }\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnObservable = function (source, id) {\n    var _this = this;\n\n    var subscription = source.subscribe(function (value) {\n      _this.send(toSCXMLEvent(value, {\n        origin: id\n      }));\n    }, function (err) {\n      _this.removeChild(id);\n\n      _this.send(toSCXMLEvent(error(id, err), {\n        origin: id\n      }));\n    }, function () {\n      _this.removeChild(id);\n\n      _this.send(toSCXMLEvent(doneInvoke(id), {\n        origin: id\n      }));\n    });\n    var actor = {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function (next, handleError, complete) {\n        return source.subscribe(next, handleError, complete);\n      },\n      stop: function () {\n        return subscription.unsubscribe();\n      },\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    };\n    this.children.set(id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActor = function (actor) {\n    this.children.set(actor.id, actor);\n    return actor;\n  };\n\n  Interpreter.prototype.spawnActivity = function (activity) {\n    var implementation = this.machine.options && this.machine.options.activities ? this.machine.options.activities[activity.type] : undefined;\n\n    if (!implementation) {\n      if (!IS_PRODUCTION) {\n        warn(false, \"No implementation found for activity '\" + activity.type + \"'\");\n      } // tslint:disable-next-line:no-console\n\n\n      return;\n    } // Start implementation\n\n\n    var dispose = implementation(this.state.context, activity);\n    this.spawnEffect(activity.id, dispose);\n  };\n\n  Interpreter.prototype.spawnEffect = function (id, dispose) {\n    this.children.set(id, {\n      id: id,\n      send: function () {\n        return void 0;\n      },\n      subscribe: function () {\n        return {\n          unsubscribe: function () {\n            return void 0;\n          }\n        };\n      },\n      stop: dispose || undefined,\n      toJSON: function () {\n        return {\n          id: id\n        };\n      }\n    });\n  };\n\n  Interpreter.prototype.attachDev = function () {\n    if (this.options.devTools && typeof window !== 'undefined') {\n      if (window.__REDUX_DEVTOOLS_EXTENSION__) {\n        var devToolsOptions = typeof this.options.devTools === 'object' ? this.options.devTools : undefined;\n        this.devTools = window.__REDUX_DEVTOOLS_EXTENSION__.connect(__assign(__assign({\n          name: this.id,\n          autoPause: true,\n          stateSanitizer: function (state) {\n            return {\n              value: state.value,\n              context: state.context,\n              actions: state.actions\n            };\n          }\n        }, devToolsOptions), {\n          features: __assign({\n            jump: false,\n            skip: false\n          }, devToolsOptions ? devToolsOptions.features : undefined)\n        }), this.machine);\n        this.devTools.init(this.state);\n      } // add XState-specific dev tooling hook\n\n\n      registerService(this);\n    }\n  };\n\n  Interpreter.prototype.toJSON = function () {\n    return {\n      id: this.id\n    };\n  };\n\n  Interpreter.prototype[symbolObservable] = function () {\n    return this;\n  };\n  /**\r\n   * The default interpreter options:\r\n   *\r\n   * - `clock` uses the global `setTimeout` and `clearTimeout` functions\r\n   * - `logger` uses the global `console.log()` method\r\n   */\n\n\n  Interpreter.defaultOptions = /*#__PURE__*/function (global) {\n    return {\n      execute: true,\n      deferEvents: true,\n      clock: {\n        setTimeout: function (fn, ms) {\n          return global.setTimeout.call(null, fn, ms);\n        },\n        clearTimeout: function (id) {\n          return global.clearTimeout.call(null, id);\n        }\n      },\n      logger: global.console.log.bind(console),\n      devTools: false\n    };\n  }(typeof window === 'undefined' ? global : window);\n\n  Interpreter.interpret = interpret;\n  return Interpreter;\n}();\n\nvar resolveSpawnOptions = function (nameOrOptions) {\n  if (isString(nameOrOptions)) {\n    return __assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n      name: nameOrOptions\n    });\n  }\n\n  return __assign(__assign(__assign({}, DEFAULT_SPAWN_OPTIONS), {\n    name: uniqueId()\n  }), nameOrOptions);\n};\n\nfunction spawn(entity, nameOrOptions) {\n  var resolvedOptions = resolveSpawnOptions(nameOrOptions);\n  return withServiceScope(undefined, function (service) {\n    if (!IS_PRODUCTION) {\n      var isLazyEntity = isMachine(entity) || isFunction(entity);\n      warn(!!service || isLazyEntity, \"Attempted to spawn an Actor (ID: \\\"\" + (isMachine(entity) ? entity.id : 'undefined') + \"\\\") outside of a service. This will have no effect.\");\n    }\n\n    if (service) {\n      return service.spawn(entity, resolvedOptions.name, resolvedOptions);\n    } else {\n      return createDeferredActor(entity, resolvedOptions.name);\n    }\n  });\n}\n/**\r\n * Creates a new Interpreter instance for the given machine with the provided options, if any.\r\n *\r\n * @param machine The machine to interpret\r\n * @param options Interpreter options\r\n */\n\n\nfunction interpret(machine, options) {\n  var interpreter = new Interpreter(machine, options);\n  return interpreter;\n}\n\nexport { Interpreter, interpret, spawn };","import { interpret, createMachine, assign } from \"xstate\";\n\ninterface DragAndDropContext {\n  id: string;\n  draggables: Map<string, { x: number; y: number }>;\n  order: Array<string>;\n  px: number;\n  py: number;\n  dx: number;\n  dy: number;\n}\n\ntype DragAndDropState =\n  | {\n    value: \"idle\";\n    context: DragAndDropContext & {\n      target: null;\n    };\n  }\n  | {\n    value: \"dragging\";\n    context: DragAndDropContext & {\n      target: EventTarget | null;\n    };\n  };\n\nconst dragAndDropMachine = createMachine<\n  DragAndDropContext,\n  MouseEvent,\n  DragAndDropState\n>(\n  {\n    initial: \"idle\",\n    context: {\n      id: null,\n      draggables: new Map(),\n      order: [],\n      px: 0,\n      py: 0,\n      dx: 0,\n      dy: 0,\n    },\n    states: {\n      idle: {\n        on: {\n          mousedown: {\n            target: \"dragging\",\n            actions: [\"onIdleToDragging\"],\n          },\n        },\n      },\n      dragging: {\n        entry: [\"onDraggingStart\"],\n        on: {\n          mousemove: {\n            target: \"dragging\",\n            actions: [\"onDraggingUpdate\"],\n          },\n          mouseup: {\n            target: \"idle\",\n            actions: [\"onDraggingToIdle\"],\n          },\n        },\n      },\n    },\n  },\n  {\n    actions: {\n      onIdleToDragging: assign(\n        (context: DragAndDropContext, event: MouseEvent) => {\n          const target = event.target as HTMLElement;\n          const x = parseFloat(\n            getComputedStyle(target).getPropertyValue(\"left\")\n          );\n          const y = parseFloat(\n            getComputedStyle(target).getPropertyValue(\"top\")\n          );\n\n          const draggable = context.draggables.get(target.id) || {\n            x,\n            y,\n          };\n\n          return {\n            ...context,\n            id: target.id,\n            draggables: context.draggables.set(target.id, draggable),\n            px: event.clientX,\n            py: event.clientY,\n          };\n        }\n      ),\n      onDraggingStart: assign(\n        (context: DragAndDropContext, event: MouseEvent) => {\n          const target = document.getElementById(context.id) as HTMLElement;\n\n          context.order = context.order\n            .filter((id) => id !== target.id)\n            .concat(target.id);\n\n          const draggableElements = document.querySelectorAll(\n            \"[data-draggable]\"\n          );\n          draggableElements.forEach((draggable: HTMLElement) => {\n            const isOrdered = context.order.includes(draggable.id);\n            draggable.style.zIndex = `${\n              isOrdered ? context.order.indexOf(draggable.id) + 1 : 0\n              }`;\n          });\n          return context;\n        }\n      ),\n      onDraggingUpdate: assign(\n        (context: DragAndDropContext, event: MouseEvent) => {\n          return {\n            ...context,\n            dx: event.clientX - context.px,\n            dy: event.clientY - context.py,\n          };\n        }\n      ),\n      onDraggingToIdle: assign((context: DragAndDropContext) => {\n        const draggable = context.draggables.get(context.id);\n\n        return {\n          ...context,\n          draggables: context.draggables.set(context.id, {\n            x: context.dx + (draggable ? draggable.x : 0),\n            y: context.dy + (draggable ? draggable.y : 0),\n          }),\n          dx: 0,\n          dy: 0,\n        };\n      }),\n    },\n  }\n);\n\nconst dragAndDropService = interpret(dragAndDropMachine)\n  .onTransition((state, event) => {\n    if (state.changed) {\n      const target = document.getElementById(state.context.id);\n\n      switch (state.value) {\n        case \"dragging\": {\n          const draggable = state.context.draggables.get(state.context.id);\n          target.dataset.dragging = \"true\";\n          target.style.setProperty(\n            \"left\",\n            `${draggable.x + state.context.dx}px`\n          );\n          target.style.setProperty(\n            \"top\",\n            `${draggable.y + state.context.dy}px`\n          );\n          break;\n        }\n        case \"idle\": {\n          target.dataset.dragging = \"false\";\n          break;\n        }\n      }\n    }\n  })\n  .start();\n\ndocument.addEventListener(\"mousedown\", (event) => {\n  const target = event.target as HTMLElement;\n  const isDraggable = target.hasAttribute(\"data-draggable\");\n  const hasId = !!target.id;\n\n  if (!isDraggable) return;\n  if (!hasId) {\n    console.log(\"Sorry, draggable elements need to have IDs!\");\n    return;\n  }\n\n  dragAndDropService.send(event);\n});\n\ndocument.addEventListener(\"mousemove\", (event) => {\n  dragAndDropService.send(event);\n});\n\ndocument.addEventListener(\"mouseup\", (event) => {\n  dragAndDropService.send(event);\n});\n","import { StateNode } from './StateNode.js';\n\nfunction Machine(config, options, initialContext) {\n  if (initialContext === void 0) {\n    initialContext = config.context;\n  }\n\n  var resolvedInitialContext = typeof initialContext === 'function' ? initialContext() : initialContext;\n  return new StateNode(config, options, resolvedInitialContext);\n}\n\nfunction createMachine(config, options) {\n  var resolvedInitialContext = typeof config.context === 'function' ? config.context() : config.context;\n  return new StateNode(config, options, resolvedInitialContext);\n}\n\nexport { Machine, createMachine };"],"names":["$parcel$global","globalThis","self","window","global","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__values","o","m","Symbol","iterator","next","value","done","__read","r","ar","push","error","__spread","concat","EMPTY_ACTIVITY_MAP","DEFAULT_GUARD_TYPE","keys","matchesState","parentStateId","childStateId","delimiter","parentStateValue","toStateValue","childStateValue","isString","every","key","getEventType","event","type","Error","toStatePath","stateId","isArray","toString","split","stateValue","state","pathToStateValue","statePath","marker","mapValues","collection","iteratee","result","collectionKeys","mapFilterValues","predicate","e_1","_a","_b","$e76ab36b09a8718e1552889d4ab07fcb$export$__values","_c","item","e_1_1","return","path","props","object","e_2","props_1","props_1_1","e_2_1","toStatePaths","flatten","map","subStateValue","subPath","array","$e76ab36b09a8718e1552889d4ab07fcb$export$__spread","toArrayStrict","toArray","undefined","mapContext","mapper","context","_event","e_5","isFunction","data","subMapper","e_5_1","isPromiseLike","Promise","then","partition","items","e_6","$e76ab36b09a8718e1552889d4ab07fcb$export$__read","truthy","falsy","items_1","items_1_1","e_6_1","updateHistoryStates","hist","states","subHist","current","Array","toGuard","condition","guardMap","$a17ea9546e54d9cbd5f0f03c78bfa6a8$export$DEFAULT_GUARD_TYPE","name","isObservable","subscribe","symbolObservable","observable","isMachine","ActionTypes","SpecialTargets","toEventObject","payload","$e76ab36b09a8718e1552889d4ab07fcb$export$__assign","toSCXMLEvent","scxmlEvent","$$type","eventObject","toTransitionConfigArray","configLike","transitionLike","target","evaluateGuard","machine","guard","guards","options","guardMeta","cond","condFn","id","toInvokeSource","src","start","$d14557a22a03ce36fdd280ab29dcba1a$export$ActionTypes","Start","stop","Stop","raise","Raise","send","Send","cancel","Cancel","nullEvent","NullEvent","Assign","log","After","DoneState","Log","init","Init","invoke","Invoke","errorPlatform","ErrorExecution","ErrorPlatform","ErrorCustom","update","Update","choose","Choose","pure","Pure","initEvent","$f79613619d297856284422bd1$export$toSCXMLEvent","$bb631d942638e1078dc8f2831de1c82d$export$init","getActionFunction","actionType","actionFunctionMap","toActionObject","action","actionObject","$f79613619d297856284422bd1$export$isString","exec","$f79613619d297856284422bd1$export$isFunction","defineProperty","enumerable","configurable","toActionObjects","$f79613619d297856284422bd1$export$isArray","subAction","toActivityDefinition","$bb631d942638e1078dc8f2831de1c82d$export$raise","to","$d14557a22a03ce36fdd280ab29dcba1a$export$SpecialTargets","Internal","$bb631d942638e1078dc8f2831de1c82d$export$send","$f79613619d297856284422bd1$export$toEventObject","delay","$f79613619d297856284422bd1$export$getEventType","assignment","$bb631d942638e1078dc8f2831de1c82d$export$assign","doneInvoke","DoneInvoke","resolveActions","currentState","currentContext","actions","$f79613619d297856284422bd1$export$partition","assignActions","otherActions","updatedContext","reduce","acc","assignAction","e_7","meta","partialUpdate","propAssignment","e_7_1","$f79613619d297856284422bd1$export$updateContext","$f79613619d297856284422bd1$export$flatten","sendAction","ctx","delaysMap","resolvedDelay","resolvedEvent","configDelay","resolvedTarget","resolveSend","delays","$bb631d942638e1078dc8f2831de1c82d$export$log","expr","resolveLog","$bb631d942638e1078dc8f2831de1c82d$export$choose","matchedActions","conds","find","$f79613619d297856284422bd1$export$toGuard","$f79613619d297856284422bd1$export$evaluateGuard","resolved","$f79613619d297856284422bd1$export$toArray","$bb631d942638e1078dc8f2831de1c82d$export$pure","get","isLeafNode","stateNode","getChildren","$f79613619d297856284422bd1$export$keys","getAllStateNodes","stateNodes","getConfiguration","prevStateNodes","e_3","e_4","_d","prevAdjList","getAdjList","Set","configuration","configuration_1","configuration_1_1","parent","has","add","adjList","configuration_2","configuration_2_1","_e","_f","child","forEach","sn","initialStateNodes","e_3_1","configuration_3","configuration_3_1","e_4_1","Map","configuration_4","configuration_4_1","set","getValue","rootNode","getValueFromAdj","baseNode","childStateNodes","childStateNode","csn","iterable","some","member","isInFinalState","State","config","_this","activities","$a17ea9546e54d9cbd5f0f03c78bfa6a8$export$EMPTY_ACTIVITY_MAP","events","_sessionid","historyValue","history","matches","bind","toStrings","transitions","children","ownEvents","from","$a7643e117cf2f6208a2fbc0dfa2accc5$export$initEvent","create","inert","valueKeys","toJSON","$e76ab36b09a8718e1552889d4ab07fcb$export$__rest","$f79613619d297856284422bd1$export$matchesState","createNullActor","unsubscribe","createInvocableActor","invokeDefinition","invokeSrc","$f79613619d297856284422bd1$export$toInvokeSource","serviceCreator","services","resolvedData","$f79613619d297856284422bd1$export$mapContext","tempActor","entity","deferred","$f79613619d297856284422bd1$export$isMachine","withContext","initialState","createDeferredActor","isActor","simpleSrc","toInvokeDefinition","invokeConfig","$bb631d942638e1078dc8f2831de1c82d$export$invoke","onDone","onError","invokeDef","WILDCARD","EMPTY_OBJECT","isStateId","str","StateNode","order","__xstatenode","__cache","relativeValue","initialStateValue","on","candidates","delayedTransitions","idMap","_parent","_key","join","version","parallel","initial","$f79613619d297856284422bd1$export$mapValues","stateConfig","dfs","$f51378992d2e96fae0$export$getChildren","_transient","always","strict","onEntry","entry","$a7643e117cf2f6208a2fbc0dfa2accc5$export$toActionObject","onExit","exit","doneData","$f36d56f030d3dd55f171213bff1f7$export$toInvokeDefinition","invokeSource","activity","$a7643e117cf2f6208a2fbc0dfa2accc5$export$toActivityDefinition","transition","_init","$f51378992d2e96fae0$export$getAllStateNodes","withConfig","definition","eventType","getDelayedTransitions","formatTransitions","getCandidates","eventName","transient","filter","sameEventType","afterConfig","after","mutateEntryExit","delayRef","idSuffix","$a7643e117cf2f6208a2fbc0dfa2accc5$export$after","$a7643e117cf2f6208a2fbc0dfa2accc5$export$send","$bb631d942638e1078dc8f2831de1c82d$export$cancel","sendId","configTransition","resolvedTransition","isNaN","delayedTransition","formatTransition","getStateNodes","$a772d792b6dee25e31d27dfb4144$export$State","$f79613619d297856284422bd1$export$toStateValue","getStateNode","subStateKeys","subStateKey","allSubStateNodes","subStateNode","handles","includes","resolveState","$f51378992d2e96fae0$export$getConfiguration","resolve","transitionLeafNode","transitionCompoundNode","_transition","transitionParallelNode","transitionMap","stateTransitions","enabledTransitions","st","entryNodes","entrySet","exitSet","source","selectedTransition","nextStateNodes","candidate","stateIn","in","resolvedContext","isInState","getStateNodeById","$f79613619d297856284422bd1$export$path","slice","guardPassed","err","message","allNextStateNodes","getRelativeStateNodes","isInternal","internal","nodesFromChild","escapes","nodes","getActions","prevState","prevConfig","resolvedConfig","resolvedConfig_1","resolvedConfig_1_1","$f51378992d2e96fae0$export$has","prevConfig_1","prevConfig_1_1","doneEvents","$a7643e117cf2f6208a2fbc0dfa2accc5$export$done","grandparent","parentNode","$f51378992d2e96fae0$export$isInFinalState","sort","a","b","entryStates","exitStates","activityDef","$a7643e117cf2f6208a2fbc0dfa2accc5$export$start","$a7643e117cf2f6208a2fbc0dfa2accc5$export$raise","$a7643e117cf2f6208a2fbc0dfa2accc5$export$stop","entryActions","exitActions","$a7643e117cf2f6208a2fbc0dfa2accc5$export$toActionObjects","resolvedStateValue","$f79613619d297856284422bd1$export$pathToStateValue","getResolvedPath","test","stateTransition","resolveTransition","resolveRaisedTransition","originalEvent","currentActions","unshift","$f51378992d2e96fae0$export$getValue","actions_1","actions_1_1","$bb631d942638e1078dc8f2831de1c82d$export$start","$bb631d942638e1078dc8f2831de1c82d$export$stop","$a7643e117cf2f6208a2fbc0dfa2accc5$export$resolveActions","resolvedActions","raisedEvents","nonRaisedActions","$cfa820db7e7a6770bb9d8c6c02f6f50$export$createInvocableActor","resolvedConfiguration","isDone","nextState","didUpdateContext","changed","$bb631d942638e1078dc8f2831de1c82d$export$update","maybeNextState","$bb631d942638e1078dc8f2831de1c82d$export$nullEvent","raisedEvent","shift","stateValuesEqual","aKeys","bKeys","$a772d792b6dee25e31d27dfb4144$export$stateValuesEqual","stateKey","resolvedStateId","getStateNodeByPath","arrayStatePath","$f79613619d297856284422bd1$export$toStatePath","currentStateNode","stateIdentifier","$f79613619d297856284422bd1$export$mapFilterValues","$f51378992d2e96fae0$export$isLeafNode","getInitialState","historyConfig","relativeStateId","resolveHistory","$f79613619d297856284422bd1$export$toStatePaths","initialPath","getFromRelativePath","relativePath","childStatePath","relativeStateValue","historyTarget","relativeChildPath","accessorProp","subHistoryValue","props_2","props_2_1","prop","subStatePath","childStateIds","stateIds","e_8","event_1","e_8_1","resolveTarget","_target","isInternalTarget","transitionConfig","normalizedTarget","$f79613619d297856284422bd1$export$normalizeTarget","e_9","onConfig","wildcardConfigs","strictTransitionConfigs_1","transitionConfigArray","$f79613619d297856284422bd1$export$toTransitionConfigArray","eventlessConfig","doneConfig","String","settleTransitions","$a7643e117cf2f6208a2fbc0dfa2accc5$export$doneInvoke","$a7643e117cf2f6208a2fbc0dfa2accc5$export$error","formattedTransitions","delayedTransitions_1","delayedTransitions_1_1","e_9_1","defaultOptions","deferEvents","Scheduler","processingEvent","queue","initialized","initialize","callback","schedule","process","flushEvents","task","clear","nextCallback","sessionIdIndex","registry","actor","delete","InterpreterStatus","DEFAULT_SPAWN_OPTIONS","sync","autoForward","withServiceScope","serviceStack","service","fn","pop","Interpreter","scheduler","$badbe1af1b550d8969cd11182c6df5$export$Scheduler","delayedEventsMap","listeners","contextListeners","stopListeners","doneListeners","eventListeners","sendListeners","_status","NotStarted","forwardTo","batch","Stopped","Running","JSON","stringify","forward","_state","sendTo","isParent","Parent","$cfa820db7e7a6770bb9d8c6c02f6f50$export$isActor","$f2dbabc5d9b6489eef5fcbd7ec499d$export$registry","$bb631d942638e1078dc8f2831de1c82d$export$error","origin","sessionId","resolvedOptions","clock","logger","resolvedId","_initialState","execute","actionsConfig","devTools","listener","_g","_h","_j","_k","contextListener","finalChildStateNode","_l","_m","onTransition","nextListenerOrObserver","_","completeListener","resolvedCompleteListener","complete","onEvent","onSend","onChange","onStop","off","resolvedState","attachDev","e_10","_o","_p","_q","clearTimeout","e_10_1","e_11","batchChanged","batchedActions","_loop_1","events_1","events_1_1","e_11_1","sender","$bb631d942638e1078dc8f2831de1c82d$export$errorPlatform","nextEvents","nextEvent","e_12","e_12_1","defer","setTimeout","actionOrExec","$a7643e117cf2f6208a2fbc0dfa2accc5$export$getActionFunction","$f79613619d297856284422bd1$export$isPromiseLike","spawnPromise","spawnCallback","$f79613619d297856284422bd1$export$isObservable","spawnObservable","spawnMachine","spawnActivity","stopChild","label","removeChild","childId","spawn","spawnActor","childService","doneEvent","promise","canceled","response","errorData","errorEvent","handleError","unsubscribed","callbackStop","receivers","newListener","receiver","subscription","implementation","dispose","spawnEffect","__REDUX_DEVTOOLS_EXTENSION__","devToolsOptions","connect","autoPause","stateSanitizer","features","jump","skip","$f79613619d297856284422bd1$export$symbolObservable","ms","console","interpret","resolvedInitialContext","dragAndDropService","$ac0a9a8235054a666d3a1e6624496b9a$export$interpret","draggables","px","py","dx","dy","idle","mousedown","dragging","mousemove","mouseup","onIdleToDragging","$a7643e117cf2f6208a2fbc0dfa2accc5$export$assign","x","parseFloat","getComputedStyle","getPropertyValue","y","draggable","$d735dc183ee13bb77e3773ab0e1e11f$var$_objectSpread","clientX","clientY","onDraggingStart","document","getElementById","querySelectorAll","isOrdered","style","zIndex","onDraggingUpdate","onDraggingToIdle","$dc98e599035dc2bf78421dd3d3ee$export$StateNode","dataset","setProperty","addEventListener","isDraggable","hasAttribute","hasId"],"version":3,"file":"index.6c6da31e.js.map"}